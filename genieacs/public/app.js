import{a as me,b as nt,c as Ue}from"./chunk-CDG7S4P5.js";var xt=me((uf,ii)=>{"use strict";function Wt(e,t,n,r,s,i){return{tag:e,key:t,attrs:n,children:r,text:s,dom:i,domSize:void 0,state:void 0,events:void 0,instance:void 0}}Wt.normalize=function(e){return Array.isArray(e)?Wt("[",void 0,void 0,Wt.normalizeChildren(e),void 0,void 0):e==null||typeof e=="boolean"?null:typeof e=="object"?e:Wt("#",void 0,void 0,String(e),void 0,void 0)};Wt.normalizeChildren=function(e){var t=[];if(e.length){for(var n=e[0]!=null&&e[0].key!=null,r=1;r<e.length;r++)if((e[r]!=null&&e[r].key!=null)!==n)throw new TypeError(n&&(e[r]!=null||typeof e[r]=="boolean")?"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.":"In fragments, vnodes must either all have keys or none have keys.");for(var r=0;r<e.length;r++)t[r]=Wt.normalize(e[r])}return t};ii.exports=Wt});var Fn=me((cf,oi)=>{"use strict";var Va=xt();oi.exports=function(){var e=arguments[this],t=this+1,n;if(e==null?e={}:(typeof e!="object"||e.tag!=null||Array.isArray(e))&&(e={},t=this),arguments.length===t+1)n=arguments[t],Array.isArray(n)||(n=[n]);else for(n=[];t<arguments.length;)n.push(arguments[t++]);return Va("",e.key,e,n)}});var Ir=me((ff,ai)=>{"use strict";ai.exports={}.hasOwnProperty});var Qn=me((mf,ci)=>{"use strict";var Fa=xt(),Qa=Fn(),ar=Ir(),Wa=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,ui={};function li(e){for(var t in e)if(ar.call(e,t))return!1;return!0}function Ha(e){for(var t,n="div",r=[],s={};t=Wa.exec(e);){var i=t[1],o=t[2];if(i===""&&o!=="")n=o;else if(i==="#")s.id=o;else if(i===".")r.push(o);else if(t[3][0]==="["){var a=t[6];a&&(a=a.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),t[4]==="class"?r.push(a):s[t[4]]=a===""?a:a||!0}}return r.length>0&&(s.className=r.join(" ")),ui[e]={tag:n,attrs:s}}function Ka(e,t){var n=t.attrs,r=ar.call(n,"class"),s=r?n.class:n.className;if(t.tag=e.tag,t.attrs={},!li(e.attrs)&&!li(n)){var i={};for(var o in n)ar.call(n,o)&&(i[o]=n[o]);n=i}for(var o in e.attrs)ar.call(e.attrs,o)&&o!=="className"&&!ar.call(n,o)&&(n[o]=e.attrs[o]);(s!=null||e.attrs.className!=null)&&(n.className=s!=null?e.attrs.className!=null?String(e.attrs.className)+" "+String(s):s:e.attrs.className!=null?e.attrs.className:null),r&&(n.class=null);for(var o in n)if(ar.call(n,o)&&o!=="key"){t.attrs=n;break}return t}function Ja(e){if(e==null||typeof e!="string"&&typeof e!="function"&&typeof e.view!="function")throw Error("The selector must be either a string or a component.");var t=Qa.apply(1,arguments);return typeof e=="string"&&(t.children=Fa.normalizeChildren(t.children),e!=="[")?Ka(ui[e]||Ha(e),t):(t.tag=e,t)}ci.exports=Ja});var mi=me((pf,fi)=>{"use strict";var Ga=xt();fi.exports=function(e){return e==null&&(e=""),Ga("<",void 0,void 0,e,void 0,void 0)}});var hi=me((hf,pi)=>{"use strict";var Ya=xt(),Za=Fn();pi.exports=function(){var e=Za.apply(0,arguments);return e.tag="[",e.children=Ya.normalizeChildren(e.children),e}});var gi=me((df,di)=>{"use strict";var Wn=Qn();Wn.trust=mi();Wn.fragment=hi();di.exports=Wn});var Hn=me((gf,bi)=>{"use strict";var De=function(e){if(!(this instanceof De))throw new Error("Promise must be called with 'new'.");if(typeof e!="function")throw new TypeError("executor must be a function.");var t=this,n=[],r=[],s=l(n,!0),i=l(r,!1),o=t._instance={resolvers:n,rejectors:r},a=typeof setImmediate=="function"?setImmediate:setTimeout;function l(h,g){return function u(c){var m;try{if(g&&c!=null&&(typeof c=="object"||typeof c=="function")&&typeof(m=c.then)=="function"){if(c===t)throw new TypeError("Promise can't be resolved with itself.");f(m.bind(c))}else a(function(){!g&&h.length===0&&console.error("Possible unhandled promise rejection:",c);for(var y=0;y<h.length;y++)h[y](c);n.length=0,r.length=0,o.state=g,o.retry=function(){u(c)}})}catch(y){i(y)}}}function f(h){var g=0;function u(m){return function(y){g++>0||m(y)}}var c=u(i);try{h(u(s),c)}catch(m){c(m)}}f(e)};De.prototype.then=function(e,t){var n=this,r=n._instance;function s(l,f,h,g){f.push(function(u){if(typeof l!="function")h(u);else try{i(l(u))}catch(c){o&&o(c)}}),typeof r.retry=="function"&&g===r.state&&r.retry()}var i,o,a=new De(function(l,f){i=l,o=f});return s(e,r.resolvers,i,!0),s(t,r.rejectors,o,!1),a};De.prototype.catch=function(e){return this.then(null,e)};De.prototype.finally=function(e){return this.then(function(t){return De.resolve(e()).then(function(){return t})},function(t){return De.resolve(e()).then(function(){return De.reject(t)})})};De.resolve=function(e){return e instanceof De?e:new De(function(t){t(e)})};De.reject=function(e){return new De(function(t,n){n(e)})};De.all=function(e){return new De(function(t,n){var r=e.length,s=0,i=[];if(e.length===0)t([]);else for(var o=0;o<e.length;o++)(function(a){function l(f){s++,i[a]=f,s===r&&t(i)}e[a]!=null&&(typeof e[a]=="object"||typeof e[a]=="function")&&typeof e[a].then=="function"?e[a].then(l,n):l(e[a])})(o)})};De.race=function(e){return new De(function(t,n){for(var r=0;r<e.length;r++)e[r].then(t,n)})};bi.exports=De});var Kn=me((bf,un)=>{"use strict";var Tr=Hn();typeof window<"u"?(typeof window.Promise>"u"?window.Promise=Tr:window.Promise.prototype.finally||(window.Promise.prototype.finally=Tr.prototype.finally),un.exports=window.Promise):typeof global<"u"?(typeof global.Promise>"u"?global.Promise=Tr:global.Promise.prototype.finally||(global.Promise.prototype.finally=Tr.prototype.finally),un.exports=global.Promise):un.exports=Tr});var wi=me((yf,yi)=>{"use strict";var Jn=xt();yi.exports=function(e){var t=e&&e.document,n,r={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function s(w){return w.attrs&&w.attrs.xmlns||r[w.tag]}function i(w,d){if(w.state!==d)throw new Error("'vnode.state' must not be modified.")}function o(w){var d=w.state;try{return this.apply(d,arguments)}finally{i(w,d)}}function a(){try{return t.activeElement}catch{return null}}function l(w,d,v,k,O,z,K){for(var X=v;X<k;X++){var B=d[X];B!=null&&f(w,B,O,K,z)}}function f(w,d,v,k,O){var z=d.tag;if(typeof z=="string")switch(d.state={},d.attrs!=null&&Nt(d.attrs,d,v),z){case"#":h(w,d,O);break;case"<":u(w,d,k,O);break;case"[":c(w,d,v,k,O);break;default:m(w,d,v,k,O)}else E(w,d,v,k,O)}function h(w,d,v){d.dom=t.createTextNode(d.children),Le(w,d.dom,v)}var g={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function u(w,d,v,k){var O=d.children.match(/^\s*?<(\w+)/im)||[],z=t.createElement(g[O[1]]||"div");v==="http://www.w3.org/2000/svg"?(z.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+d.children+"</svg>",z=z.firstChild):z.innerHTML=d.children,d.dom=z.firstChild,d.domSize=z.childNodes.length,d.instance=[];for(var K=t.createDocumentFragment(),X;X=z.firstChild;)d.instance.push(X),K.appendChild(X);Le(w,K,k)}function c(w,d,v,k,O){var z=t.createDocumentFragment();if(d.children!=null){var K=d.children;l(z,K,0,K.length,v,null,k)}d.dom=z.firstChild,d.domSize=z.childNodes.length,Le(w,z,O)}function m(w,d,v,k,O){var z=d.tag,K=d.attrs,X=K&&K.is;k=s(d)||k;var B=k?X?t.createElementNS(k,z,{is:X}):t.createElementNS(k,z):X?t.createElement(z,{is:X}):t.createElement(z);if(d.dom=B,K!=null&&er(d,K,k),Le(w,B,O),!tn(d)&&d.children!=null){var re=d.children;l(B,re,0,re.length,v,null,k),d.tag==="select"&&K!=null&&Vn(d,K)}}function y(w,d){var v;if(typeof w.tag.view=="function"){if(w.state=Object.create(w.tag),v=w.state.view,v.$$reentrantLock$$!=null)return;v.$$reentrantLock$$=!0}else{if(w.state=void 0,v=w.tag,v.$$reentrantLock$$!=null)return;v.$$reentrantLock$$=!0,w.state=w.tag.prototype!=null&&typeof w.tag.prototype.view=="function"?new w.tag(w):w.tag(w)}if(Nt(w.state,w,d),w.attrs!=null&&Nt(w.attrs,w,d),w.instance=Jn.normalize(o.call(w.state.view,w)),w.instance===w)throw Error("A view cannot return the vnode it received as argument");v.$$reentrantLock$$=null}function E(w,d,v,k,O){y(d,v),d.instance!=null?(f(w,d.instance,v,k,O),d.dom=d.instance.dom,d.domSize=d.dom!=null?d.instance.domSize:0):d.domSize=0}function C(w,d,v,k,O,z){if(!(d===v||d==null&&v==null))if(d==null||d.length===0)l(w,v,0,v.length,k,O,z);else if(v==null||v.length===0)Ut(w,d,0,d.length);else{var K=d[0]!=null&&d[0].key!=null,X=v[0]!=null&&v[0].key!=null,B=0,re=0;if(!K)for(;re<d.length&&d[re]==null;)re++;if(!X)for(;B<v.length&&v[B]==null;)B++;if(K!==X)Ut(w,d,re,d.length),l(w,v,B,v.length,k,O,z);else if(X){for(var _e=d.length-1,xe=v.length-1,Ft,Me,be,Oe,b,A;_e>=re&&xe>=B&&(Oe=d[_e],b=v[xe],Oe.key===b.key);)Oe!==b&&x(w,Oe,b,k,O,z),b.dom!=null&&(O=b.dom),_e--,xe--;for(;_e>=re&&xe>=B&&(Me=d[re],be=v[B],Me.key===be.key);)re++,B++,Me!==be&&x(w,Me,be,k,Te(d,re,O),z);for(;_e>=re&&xe>=B&&!(B===xe||Me.key!==b.key||Oe.key!==be.key);)A=Te(d,re,O),Xe(w,Oe,A),Oe!==be&&x(w,Oe,be,k,A,z),++B<=--xe&&Xe(w,Me,O),Me!==b&&x(w,Me,b,k,O,z),b.dom!=null&&(O=b.dom),re++,_e--,Oe=d[_e],b=v[xe],Me=d[re],be=v[B];for(;_e>=re&&xe>=B&&Oe.key===b.key;)Oe!==b&&x(w,Oe,b,k,O,z),b.dom!=null&&(O=b.dom),_e--,xe--,Oe=d[_e],b=v[xe];if(B>xe)Ut(w,d,re,_e+1);else if(re>_e)l(w,v,B,xe+1,k,O,z);else{var S=O,M=xe-B+1,$=new Array(M),_=0,D=0,H=2147483647,se=0,Ft,ke;for(D=0;D<M;D++)$[D]=-1;for(D=xe;D>=B;D--){Ft==null&&(Ft=F(d,re,_e+1)),b=v[D];var ye=Ft[b.key];ye!=null&&(H=ye<H?ye:-1,$[D-B]=ye,Oe=d[ye],d[ye]=null,Oe!==b&&x(w,Oe,b,k,O,z),b.dom!=null&&(O=b.dom),se++)}if(O=S,se!==_e-re+1&&Ut(w,d,re,_e+1),se===0)l(w,v,B,xe+1,k,O,z);else if(H===-1)for(ke=Ce($),_=ke.length-1,D=xe;D>=B;D--)be=v[D],$[D-B]===-1?f(w,be,k,z,O):ke[_]===D-B?_--:Xe(w,be,O),be.dom!=null&&(O=v[D].dom);else for(D=xe;D>=B;D--)be=v[D],$[D-B]===-1&&f(w,be,k,z,O),be.dom!=null&&(O=v[D].dom)}}else{var kr=d.length<v.length?d.length:v.length;for(B=B<re?B:re;B<kr;B++)Me=d[B],be=v[B],!(Me===be||Me==null&&be==null)&&(Me==null?f(w,be,k,z,Te(d,B+1,O)):be==null?et(w,Me):x(w,Me,be,k,Te(d,B+1,O),z));d.length>kr&&Ut(w,d,B,d.length),v.length>kr&&l(w,v,B,v.length,k,O,z)}}}function x(w,d,v,k,O,z){var K=d.tag,X=v.tag;if(K===X){if(v.state=d.state,v.events=d.events,ln(v,d))return;if(typeof K=="string")switch(v.attrs!=null&&Rt(v.attrs,v,k),K){case"#":P(d,v);break;case"<":T(w,d,v,z,O);break;case"[":R(w,d,v,k,O,z);break;default:L(d,v,k,z)}else U(w,d,v,k,O,z)}else et(w,d),f(w,v,k,z,O)}function P(w,d){w.children.toString()!==d.children.toString()&&(w.dom.nodeValue=d.children),d.dom=w.dom}function T(w,d,v,k,O){d.children!==v.children?(rn(w,d),u(w,v,k,O)):(v.dom=d.dom,v.domSize=d.domSize,v.instance=d.instance)}function R(w,d,v,k,O,z){C(w,d.children,v.children,k,O,z);var K=0,X=v.children;if(v.dom=null,X!=null){for(var B=0;B<X.length;B++){var re=X[B];re!=null&&re.dom!=null&&(v.dom==null&&(v.dom=re.dom),K+=re.domSize||1)}K!==1&&(v.domSize=K)}}function L(w,d,v,k){var O=d.dom=w.dom;k=s(d)||k,d.tag==="textarea"&&d.attrs==null&&(d.attrs={}),sn(d,w.attrs,d.attrs,k),tn(d)||C(O,w.children,d.children,v,null,k)}function U(w,d,v,k,O,z){if(v.instance=Jn.normalize(o.call(v.state.view,v)),v.instance===v)throw Error("A view cannot return the vnode it received as argument");Rt(v.state,v,k),v.attrs!=null&&Rt(v.attrs,v,k),v.instance!=null?(d.instance==null?f(w,v.instance,k,z,O):x(w,d.instance,v.instance,k,O,z),v.dom=v.instance.dom,v.domSize=v.instance.domSize):d.instance!=null?(et(w,d.instance),v.dom=void 0,v.domSize=0):(v.dom=d.dom,v.domSize=d.domSize)}function F(w,d,v){for(var k=Object.create(null);d<v;d++){var O=w[d];if(O!=null){var z=O.key;z!=null&&(k[z]=d)}}return k}var W=[];function Ce(w){for(var d=[0],v=0,k=0,O=0,z=W.length=w.length,O=0;O<z;O++)W[O]=w[O];for(var O=0;O<z;++O)if(w[O]!==-1){var K=d[d.length-1];if(w[K]<w[O]){W[O]=K,d.push(O);continue}for(v=0,k=d.length-1;v<k;){var X=(v>>>1)+(k>>>1)+(v&k&1);w[d[X]]<w[O]?v=X+1:k=X}w[O]<w[d[v]]&&(v>0&&(W[O]=d[v-1]),d[v]=O)}for(v=d.length,k=d[v-1];v-- >0;)d[v]=k,k=W[k];return W.length=0,d}function Te(w,d,v){for(;d<w.length;d++)if(w[d]!=null&&w[d].dom!=null)return w[d].dom;return v}function Xe(w,d,v){var k=t.createDocumentFragment();We(w,k,d),Le(w,k,v)}function We(w,d,v){for(;v.dom!=null&&v.dom.parentNode===w;){if(typeof v.tag!="string"){if(v=v.instance,v!=null)continue}else if(v.tag==="<")for(var k=0;k<v.instance.length;k++)d.appendChild(v.instance[k]);else if(v.tag!=="[")d.appendChild(v.dom);else if(v.children.length===1){if(v=v.children[0],v!=null)continue}else for(var k=0;k<v.children.length;k++){var O=v.children[k];O!=null&&We(w,d,O)}break}}function Le(w,d,v){v!=null?w.insertBefore(d,v):w.appendChild(d)}function tn(w){if(w.attrs==null||w.attrs.contenteditable==null&&w.attrs.contentEditable==null)return!1;var d=w.children;if(d!=null&&d.length===1&&d[0].tag==="<"){var v=d[0].children;w.dom.innerHTML!==v&&(w.dom.innerHTML=v)}else if(d!=null&&d.length!==0)throw new Error("Child node of a contenteditable must be trusted.");return!0}function Ut(w,d,v,k){for(var O=v;O<k;O++){var z=d[O];z!=null&&et(w,z)}}function et(w,d){var v=0,k=d.state,O,z;if(typeof d.tag!="string"&&typeof d.state.onbeforeremove=="function"){var K=o.call(d.state.onbeforeremove,d);K!=null&&typeof K.then=="function"&&(v=1,O=K)}if(d.attrs&&typeof d.attrs.onbeforeremove=="function"){var K=o.call(d.attrs.onbeforeremove,d);K!=null&&typeof K.then=="function"&&(v|=2,z=K)}if(i(d,k),!v)qt(d),Pr(w,d);else{if(O!=null){var X=function(){v&1&&(v&=2,v||B())};O.then(X,X)}if(z!=null){var X=function(){v&2&&(v&=1,v||B())};z.then(X,X)}}function B(){i(d,k),qt(d),Pr(w,d)}}function rn(w,d){for(var v=0;v<d.instance.length;v++)w.removeChild(d.instance[v])}function Pr(w,d){for(;d.dom!=null&&d.dom.parentNode===w;){if(typeof d.tag!="string"){if(d=d.instance,d!=null)continue}else if(d.tag==="<")rn(w,d);else{if(d.tag!=="["&&(w.removeChild(d.dom),!Array.isArray(d.children)))break;if(d.children.length===1){if(d=d.children[0],d!=null)continue}else for(var v=0;v<d.children.length;v++){var k=d.children[v];k!=null&&Pr(w,k)}}break}}function qt(w){if(typeof w.tag!="string"&&typeof w.state.onremove=="function"&&o.call(w.state.onremove,w),w.attrs&&typeof w.attrs.onremove=="function"&&o.call(w.attrs.onremove,w),typeof w.tag!="string")w.instance!=null&&qt(w.instance);else{var d=w.children;if(Array.isArray(d))for(var v=0;v<d.length;v++){var k=d[v];k!=null&&qt(k)}}}function er(w,d,v){w.tag==="input"&&d.type!=null&&w.dom.setAttribute("type",d.type);var k=d!=null&&w.tag==="input"&&d.type==="file";for(var O in d)Ot(w,O,null,d[O],v,k)}function Ot(w,d,v,k,O,z){if(!(d==="key"||d==="is"||k==null||Bt(d)||v===k&&!on(w,d)&&typeof k!="object"||d==="type"&&w.tag==="input")){if(d[0]==="o"&&d[1]==="n")return pt(w,d,k);if(d.slice(0,6)==="xlink:")w.dom.setAttributeNS("http://www.w3.org/1999/xlink",d.slice(6),k);else if(d==="style")Dt(w.dom,v,k);else if(mt(w,d,O)){if(d==="value"){if((w.tag==="input"||w.tag==="textarea")&&w.dom.value===""+k&&(z||w.dom===a())||w.tag==="select"&&v!==null&&w.dom.value===""+k||w.tag==="option"&&v!==null&&w.dom.value===""+k)return;if(z&&""+k!=""){console.error("`value` is read-only on file inputs!");return}}w.dom[d]=k}else typeof k=="boolean"?k?w.dom.setAttribute(d,""):w.dom.removeAttribute(d):w.dom.setAttribute(d==="className"?"class":d,k)}}function nn(w,d,v,k){if(!(d==="key"||d==="is"||v==null||Bt(d)))if(d[0]==="o"&&d[1]==="n")pt(w,d,void 0);else if(d==="style")Dt(w.dom,v,null);else if(mt(w,d,k)&&d!=="className"&&d!=="title"&&!(d==="value"&&(w.tag==="option"||w.tag==="select"&&w.dom.selectedIndex===-1&&w.dom===a()))&&!(w.tag==="input"&&d==="type"))w.dom[d]=null;else{var O=d.indexOf(":");O!==-1&&(d=d.slice(O+1)),v!==!1&&w.dom.removeAttribute(d==="className"?"class":d)}}function Vn(w,d){if("value"in d)if(d.value===null)w.dom.selectedIndex!==-1&&(w.dom.value=null);else{var v=""+d.value;(w.dom.value!==v||w.dom.selectedIndex===-1)&&(w.dom.value=v)}"selectedIndex"in d&&Ot(w,"selectedIndex",null,d.selectedIndex,void 0)}function sn(w,d,v,k){if(d&&d===v&&console.warn("Don't reuse attrs object, use new object for every redraw, this will throw in next major"),v!=null){w.tag==="input"&&v.type!=null&&w.dom.setAttribute("type",v.type);var O=w.tag==="input"&&v.type==="file";for(var z in v)Ot(w,z,d&&d[z],v[z],k,O)}var K;if(d!=null)for(var z in d)(K=d[z])!=null&&(v==null||v[z]==null)&&nn(w,z,K,k)}function on(w,d){return d==="value"||d==="checked"||d==="selectedIndex"||d==="selected"&&w.dom===a()||w.tag==="option"&&w.dom.parentNode===t.activeElement}function Bt(w){return w==="oninit"||w==="oncreate"||w==="onupdate"||w==="onremove"||w==="onbeforeremove"||w==="onbeforeupdate"}function mt(w,d,v){return v===void 0&&(w.tag.indexOf("-")>-1||w.attrs!=null&&w.attrs.is||d!=="href"&&d!=="list"&&d!=="form"&&d!=="width"&&d!=="height")&&d in w.dom}var tr=/[A-Z]/g;function an(w){return"-"+w.toLowerCase()}function Vt(w){return w[0]==="-"&&w[1]==="-"?w:w==="cssFloat"?"float":w.replace(tr,an)}function Dt(w,d,v){if(d!==v)if(v==null)w.style.cssText="";else if(typeof v!="object")w.style.cssText=v;else if(d==null||typeof d!="object"){w.style.cssText="";for(var k in v){var O=v[k];O!=null&&w.style.setProperty(Vt(k),String(O))}}else{for(var k in v){var O=v[k];O!=null&&(O=String(O))!==String(d[k])&&w.style.setProperty(Vt(k),O)}for(var k in d)d[k]!=null&&v[k]==null&&w.style.removeProperty(Vt(k))}}function tt(){this._=n}tt.prototype=Object.create(null),tt.prototype.handleEvent=function(w){var d=this["on"+w.type],v;typeof d=="function"?v=d.call(w.currentTarget,w):typeof d.handleEvent=="function"&&d.handleEvent(w),this._&&w.redraw!==!1&&(0,this._)(),v===!1&&(w.preventDefault(),w.stopPropagation())};function pt(w,d,v){if(w.events!=null){if(w.events._=n,w.events[d]===v)return;v!=null&&(typeof v=="function"||typeof v=="object")?(w.events[d]==null&&w.dom.addEventListener(d.slice(2),w.events,!1),w.events[d]=v):(w.events[d]!=null&&w.dom.removeEventListener(d.slice(2),w.events,!1),w.events[d]=void 0)}else v!=null&&(typeof v=="function"||typeof v=="object")&&(w.events=new tt,w.dom.addEventListener(d.slice(2),w.events,!1),w.events[d]=v)}function Nt(w,d,v){typeof w.oninit=="function"&&o.call(w.oninit,d),typeof w.oncreate=="function"&&v.push(o.bind(w.oncreate,d))}function Rt(w,d,v){typeof w.onupdate=="function"&&v.push(o.bind(w.onupdate,d))}function ln(w,d){do{if(w.attrs!=null&&typeof w.attrs.onbeforeupdate=="function"){var v=o.call(w.attrs.onbeforeupdate,w,d);if(v!==void 0&&!v)break}if(typeof w.tag!="string"&&typeof w.state.onbeforeupdate=="function"){var v=o.call(w.state.onbeforeupdate,w,d);if(v!==void 0&&!v)break}return!1}while(!1);return w.dom=d.dom,w.domSize=d.domSize,w.instance=d.instance,w.attrs=d.attrs,w.children=d.children,w.text=d.text,!0}var ht;return function(w,d,v){if(!w)throw new TypeError("DOM element being rendered to does not exist.");if(ht!=null&&w.contains(ht))throw new TypeError("Node is currently being rendered to and thus is locked.");var k=n,O=ht,z=[],K=a(),X=w.namespaceURI;ht=w,n=typeof v=="function"?v:void 0;try{w.vnodes==null&&(w.textContent=""),d=Jn.normalizeChildren(Array.isArray(d)?d:[d]),C(w,w.vnodes,d,z,null,X==="http://www.w3.org/1999/xhtml"?void 0:X),w.vnodes=d,K!=null&&a()!==K&&typeof K.focus=="function"&&K.focus();for(var B=0;B<z.length;B++)z[B]()}finally{n=k,ht=O}}}});var Gn=me((wf,vi)=>{"use strict";vi.exports=wi()(typeof window<"u"?window:null)});var Ai=me((vf,Ei)=>{"use strict";var Ci=xt();Ei.exports=function(e,t,n){var r=[],s=!1,i=-1;function o(){for(i=0;i<r.length;i+=2)try{e(r[i],Ci(r[i+1]),a)}catch(f){n.error(f)}i=-1}function a(){s||(s=!0,t(function(){s=!1,o()}))}a.sync=o;function l(f,h){if(h!=null&&h.view==null&&typeof h!="function")throw new TypeError("m.mount expects a component, not a vnode.");var g=r.indexOf(f);g>=0&&(r.splice(g,2),g<=i&&(i-=2),e(f,[])),h!=null&&(r.push(f,h),e(f,Ci(h),a))}return{mount:l,redraw:a}}});var cn=me((Cf,xi)=>{"use strict";var Xa=Gn();xi.exports=Ai()(Xa,typeof requestAnimationFrame<"u"?requestAnimationFrame:null,typeof console<"u"?console:null)});var Yn=me((Ef,Si)=>{"use strict";Si.exports=function(e){if(Object.prototype.toString.call(e)!=="[object Object]")return"";var t=[];for(var n in e)r(n,e[n]);return t.join("&");function r(s,i){if(Array.isArray(i))for(var o=0;o<i.length;o++)r(s+"["+o+"]",i[o]);else if(Object.prototype.toString.call(i)==="[object Object]")for(var o in i)r(s+"["+o+"]",i[o]);else t.push(encodeURIComponent(s)+(i!=null&&i!==""?"="+encodeURIComponent(i):""))}}});var Zn=me((Af,Pi)=>{"use strict";var el=Ir();Pi.exports=Object.assign||function(e,t){for(var n in t)el.call(t,n)&&(e[n]=t[n])}});var fn=me((xf,ki)=>{"use strict";var tl=Yn(),rl=Zn();ki.exports=function(e,t){if(/:([^\/\.-]+)(\.{3})?:/.test(e))throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.");if(t==null)return e;var n=e.indexOf("?"),r=e.indexOf("#"),s=r<0?e.length:r,i=n<0?s:n,o=e.slice(0,i),a={};rl(a,t);var l=o.replace(/:([^\/\.-]+)(\.{3})?/g,function(y,E,C){return delete a[E],t[E]==null?y:C?t[E]:encodeURIComponent(String(t[E]))}),f=l.indexOf("?"),h=l.indexOf("#"),g=h<0?l.length:h,u=f<0?g:f,c=l.slice(0,u);n>=0&&(c+=e.slice(n,s)),f>=0&&(c+=(n<0?"?":"&")+l.slice(f,g));var m=tl(a);return m&&(c+=(n<0&&f<0?"?":"&")+m),r>=0&&(c+=e.slice(r)),h>=0&&(c+=(r<0?"":"&")+l.slice(h)),c}});var Mi=me((Sf,Ti)=>{"use strict";var nl=fn(),Ii=Ir();Ti.exports=function(e,t,n){var r=0;function s(a){return new t(a)}s.prototype=t.prototype,s.__proto__=t;function i(a){return function(l,f){typeof l!="string"?(f=l,l=l.url):f==null&&(f={});var h=new t(function(m,y){a(nl(l,f.params),f,function(E){if(typeof f.type=="function")if(Array.isArray(E))for(var C=0;C<E.length;C++)E[C]=new f.type(E[C]);else E=new f.type(E);m(E)},y)});if(f.background===!0)return h;var g=0;function u(){--g===0&&typeof n=="function"&&n()}return c(h);function c(m){var y=m.then;return m.constructor=s,m.then=function(){g++;var E=y.apply(m,arguments);return E.then(u,function(C){if(u(),g===0)throw C}),c(E)},m}}}function o(a,l){for(var f in a.headers)if(Ii.call(a.headers,f)&&f.toLowerCase()===l)return!0;return!1}return{request:i(function(a,l,f,h){var g=l.method!=null?l.method.toUpperCase():"GET",u=l.body,c=(l.serialize==null||l.serialize===JSON.serialize)&&!(u instanceof e.FormData||u instanceof e.URLSearchParams),m=l.responseType||(typeof l.extract=="function"?"":"json"),y=new e.XMLHttpRequest,E=!1,C=!1,x=y,P,T=y.abort;y.abort=function(){E=!0,T.call(this)},y.open(g,a,l.async!==!1,typeof l.user=="string"?l.user:void 0,typeof l.password=="string"?l.password:void 0),c&&u!=null&&!o(l,"content-type")&&y.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof l.deserialize!="function"&&!o(l,"accept")&&y.setRequestHeader("Accept","application/json, text/*"),l.withCredentials&&(y.withCredentials=l.withCredentials),l.timeout&&(y.timeout=l.timeout),y.responseType=m;for(var R in l.headers)Ii.call(l.headers,R)&&y.setRequestHeader(R,l.headers[R]);y.onreadystatechange=function(L){if(!E&&L.target.readyState===4)try{var U=L.target.status>=200&&L.target.status<300||L.target.status===304||/^file:\/\//i.test(a),F=L.target.response,W;if(m==="json"){if(!L.target.responseType&&typeof l.extract!="function")try{F=JSON.parse(L.target.responseText)}catch{F=null}}else(!m||m==="text")&&F==null&&(F=L.target.responseText);if(typeof l.extract=="function"?(F=l.extract(L.target,l),U=!0):typeof l.deserialize=="function"&&(F=l.deserialize(F)),U)f(F);else{var Ce=function(){try{W=L.target.responseText}catch{W=F}var Te=new Error(W);Te.code=L.target.status,Te.response=F,h(Te)};y.status===0?setTimeout(function(){C||Ce()}):Ce()}}catch(Te){h(Te)}},y.ontimeout=function(L){C=!0;var U=new Error("Request timed out");U.code=L.target.status,h(U)},typeof l.config=="function"&&(y=l.config(y,l,a)||y,y!==x&&(P=y.abort,y.abort=function(){E=!0,P.call(this)})),u==null?y.send():typeof l.serialize=="function"?y.send(l.serialize(u)):u instanceof e.FormData||u instanceof e.URLSearchParams?y.send(u):y.send(JSON.stringify(u))}),jsonp:i(function(a,l,f,h){var g=l.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+r++,u=e.document.createElement("script");e[g]=function(c){delete e[g],u.parentNode.removeChild(u),f(c)},u.onerror=function(){delete e[g],u.parentNode.removeChild(u),h(new Error("JSONP request failed"))},u.src=a+(a.indexOf("?")<0?"?":"&")+encodeURIComponent(l.callbackKey||"callback")+"="+encodeURIComponent(g),e.document.documentElement.appendChild(u)})}}});var Di=me((Pf,Oi)=>{"use strict";var sl=Kn(),il=cn();Oi.exports=Mi()(typeof window<"u"?window:null,sl,il.redraw)});var Xn=me((kf,Ri)=>{"use strict";function Ni(e){try{return decodeURIComponent(e)}catch{return e}}Ri.exports=function(e){if(e===""||e==null)return{};e.charAt(0)==="?"&&(e=e.slice(1));for(var t=e.split("&"),n={},r={},s=0;s<t.length;s++){var i=t[s].split("="),o=Ni(i[0]),a=i.length===2?Ni(i[1]):"";a==="true"?a=!0:a==="false"&&(a=!1);var l=o.split(/\]\[?|\[/),f=r;o.indexOf("[")>-1&&l.pop();for(var h=0;h<l.length;h++){var g=l[h],u=l[h+1],c=u==""||!isNaN(parseInt(u,10));if(g===""){var o=l.slice(0,h).join();n[o]==null&&(n[o]=Array.isArray(f)?f.length:0),g=n[o]++}else if(g==="__proto__")break;if(h===l.length-1)f[g]=a;else{var m=Object.getOwnPropertyDescriptor(f,g);m!=null&&(m=m.value),m==null&&(f[g]=m=c?[]:{}),f=m}}}return r}});var mn=me((If,$i)=>{"use strict";var ol=Xn();$i.exports=function(e){var t=e.indexOf("?"),n=e.indexOf("#"),r=n<0?e.length:n,s=t<0?r:t,i=e.slice(0,s).replace(/\/{2,}/g,"/");return i?(i[0]!=="/"&&(i="/"+i),i.length>1&&i[i.length-1]==="/"&&(i=i.slice(0,-1))):i="/",{path:i,params:t<0?{}:ol(e.slice(t+1,r))}}});var _i=me((Tf,Li)=>{"use strict";var al=mn();Li.exports=function(e){var t=al(e),n=Object.keys(t.params),r=[],s=new RegExp("^"+t.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(i,o,a){return o==null?"\\"+i:(r.push({k:o,r:a==="..."}),a==="..."?"(.*)":a==="."?"([^/]+)\\.":"([^/]+)"+(a||""))})+"$");return function(i){for(var o=0;o<n.length;o++)if(t.params[n[o]]!==i.params[n[o]])return!1;if(!r.length)return s.test(i.path);var a=s.exec(i.path);if(a==null)return!1;for(var o=0;o<r.length;o++)i.params[r[o].k]=r[o].r?a[o+1]:decodeURIComponent(a[o+1]);return!0}}});var es=me((Mf,Ui)=>{"use strict";var zi=Ir(),ji=new RegExp("^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$");Ui.exports=function(e,t){var n={};if(t!=null)for(var r in e)zi.call(e,r)&&!ji.test(r)&&t.indexOf(r)<0&&(n[r]=e[r]);else for(var r in e)zi.call(e,r)&&!ji.test(r)&&(n[r]=e[r]);return n}});var Fi=me((Of,Vi)=>{"use strict";var ll=xt(),ul=Qn(),cl=Kn(),qi=fn(),Bi=mn(),fl=_i(),ml=Zn(),pl=es(),ts={};function hl(e){try{return decodeURIComponent(e)}catch{return e}}Vi.exports=function(e,t){var n=e==null?null:typeof e.setImmediate=="function"?e.setImmediate:e.setTimeout,r=cl.resolve(),s=!1,i=!1,o=0,a,l,f=ts,h,g,u,c,m={onbeforeupdate:function(){return o=o?2:1,!(!o||ts===f)},onremove:function(){e.removeEventListener("popstate",C,!1),e.removeEventListener("hashchange",E,!1)},view:function(){if(!(!o||ts===f)){var T=[ll(h,g.key,g)];return f&&(T=f.render(T[0])),T}}},y=P.SKIP={};function E(){s=!1;var T=e.location.hash;P.prefix[0]!=="#"&&(T=e.location.search+T,P.prefix[0]!=="?"&&(T=e.location.pathname+T,T[0]!=="/"&&(T="/"+T)));var R=T.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,hl).slice(P.prefix.length),L=Bi(R);ml(L.params,e.history.state);function U(W){console.error(W),x(l,null,{replace:!0})}F(0);function F(W){for(;W<a.length;W++)if(a[W].check(L)){var Ce=a[W].component,Te=a[W].route,Xe=Ce,We=c=function(Le){if(We===c){if(Le===y)return F(W+1);h=Le!=null&&(typeof Le.view=="function"||typeof Le=="function")?Le:"div",g=L.params,u=R,c=null,f=Ce.render?Ce:null,o===2?t.redraw():(o=2,t.redraw.sync())}};Ce.view||typeof Ce=="function"?(Ce={},We(Xe)):Ce.onmatch?r.then(function(){return Ce.onmatch(L.params,R,Te)}).then(We,R===l?null:U):We("div");return}if(R===l)throw new Error("Could not resolve default route "+l+".");x(l,null,{replace:!0})}}function C(){s||(s=!0,n(E))}function x(T,R,L){if(T=qi(T,R),i){C();var U=L?L.state:null,F=L?L.title:null;L&&L.replace?e.history.replaceState(U,F,P.prefix+T):e.history.pushState(U,F,P.prefix+T)}else e.location.href=P.prefix+T}function P(T,R,L){if(!T)throw new TypeError("DOM element being rendered to does not exist.");if(a=Object.keys(L).map(function(F){if(F[0]!=="/")throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(F))throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.");return{route:F,component:L[F],check:fl(F)}}),l=R,R!=null){var U=Bi(R);if(!a.some(function(F){return F.check(U)}))throw new ReferenceError("Default route doesn't match any known routes.")}typeof e.history.pushState=="function"?e.addEventListener("popstate",C,!1):P.prefix[0]==="#"&&e.addEventListener("hashchange",E,!1),i=!0,t.mount(T,m),E()}return P.set=function(T,R,L){c!=null&&(L=L||{},L.replace=!0),c=null,x(T,R,L)},P.get=function(){return u},P.prefix="#!",P.Link={view:function(T){var R=ul(T.attrs.selector||"a",pl(T.attrs,["options","params","selector","onclick"]),T.children),L,U,F;return(R.attrs.disabled=!!R.attrs.disabled)?(R.attrs.href=null,R.attrs["aria-disabled"]="true"):(L=T.attrs.options,U=T.attrs.onclick,F=qi(R.attrs.href,T.attrs.params),R.attrs.href=P.prefix+F,R.attrs.onclick=function(W){var Ce;typeof U=="function"?Ce=U.call(W.currentTarget,W):U==null||typeof U!="object"||typeof U.handleEvent=="function"&&U.handleEvent(W),Ce!==!1&&!W.defaultPrevented&&(W.button===0||W.which===0||W.which===1)&&(!W.currentTarget.target||W.currentTarget.target==="_self")&&!W.ctrlKey&&!W.metaKey&&!W.shiftKey&&!W.altKey&&(W.preventDefault(),W.redraw=!1,P.set(F,null,L))}),R}},P.param=function(T){return g&&T!=null?g[T]:g},P}});var Wi=me((Df,Qi)=>{"use strict";var dl=cn();Qi.exports=Fi()(typeof window<"u"?window:null,dl)});var qe=me((Nf,Ji)=>{"use strict";var pn=gi(),Hi=Di(),Ki=cn(),Ne=function(){return pn.apply(this,arguments)};Ne.m=pn;Ne.trust=pn.trust;Ne.fragment=pn.fragment;Ne.Fragment="[";Ne.mount=Ki.mount;Ne.route=Wi();Ne.render=Gn();Ne.redraw=Ki.redraw;Ne.request=Hi.request;Ne.jsonp=Hi.jsonp;Ne.parseQueryString=Xn();Ne.buildQueryString=Yn();Ne.parsePathname=mn();Ne.buildPathname=fn();Ne.vnode=xt();Ne.PromisePolyfill=Hn();Ne.censor=es();Ji.exports=Ne});var Yi=me((Mr,rs)=>{(function(e,t){typeof Mr=="object"&&typeof rs=="object"?rs.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Mr=="object"?Mr.Parsimmon=t():e.Parsimmon=t()})(typeof self<"u"?self:Mr,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(r,s,i){n.o(r,s)||Object.defineProperty(r,s,{configurable:!1,enumerable:!0,get:i})},n.r=function(r){Object.defineProperty(r,"__esModule",{value:!0})},n.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(s,"a",s),s},n.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(b){if(!(this instanceof r))return new r(b);this._=b}var s=r.prototype;function i(b,A){for(var S=0;S<b;S++)A(S)}function o(b,A,S){return function(M,$){i($.length,function(_){M($[_],_,$)})}(function(M,$,_){A=b(A,M,$,_)},S),A}function a(b,A){return o(function(S,M,$,_){return S.concat([b(M,$,_)])},[],A)}function l(b,A){var S={v:0,buf:A};return i(b,function(){var M;S={v:S.v<<1|(M=S.buf,M[0]>>7),buf:function($){var _=o(function(D,H,se,ke){return D.concat(se===ke.length-1?Buffer.from([H,0]).readUInt16BE(0):ke.readUInt16BE(se))},[],$);return Buffer.from(a(function(D){return(D<<1&65535)>>8},_))}(S.buf)}}),S}function f(){return typeof Buffer<"u"}function h(){if(!f())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function g(b){h();var A=o(function(_,D){return _+D},0,b);if(A%8!=0)throw new Error("The bits ["+b.join(", ")+"] add up to "+A+" which is not an even number of bytes; the total should be divisible by 8");var S,M=A/8,$=(S=function(_){return _>48},o(function(_,D){return _||(S(D)?D:_)},null,b));if($)throw new Error($+" bit range requested exceeds 48 bit (6 byte) Number max.");return new r(function(_,D){var H=M+D;return H>_.length?L(D,M.toString()+" bytes"):R(H,o(function(se,ke){var ye=l(ke,se.buf);return{coll:se.coll.concat(ye.v),buf:ye.buf}},{coll:[],buf:_.slice(D,H)},b).coll)})}function u(b,A){return new r(function(S,M){return h(),M+A>S.length?L(M,A+" bytes for "+b):R(M+A,S.slice(M,M+A))})}function c(b,A){if(typeof(S=A)!="number"||Math.floor(S)!==S||A<0||A>6)throw new Error(b+" requires integer length in range [0, 6].");var S}function m(b){return c("uintBE",b),u("uintBE("+b+")",b).map(function(A){return A.readUIntBE(0,b)})}function y(b){return c("uintLE",b),u("uintLE("+b+")",b).map(function(A){return A.readUIntLE(0,b)})}function E(b){return c("intBE",b),u("intBE("+b+")",b).map(function(A){return A.readIntBE(0,b)})}function C(b){return c("intLE",b),u("intLE("+b+")",b).map(function(A){return A.readIntLE(0,b)})}function x(b){return b instanceof r}function P(b){return{}.toString.call(b)==="[object Array]"}function T(b){return f()&&Buffer.isBuffer(b)}function R(b,A){return{status:!0,index:b,value:A,furthest:-1,expected:[]}}function L(b,A){return P(A)||(A=[A]),{status:!1,index:-1,value:null,furthest:b,expected:A}}function U(b,A){if(!A||b.furthest>A.furthest)return b;var S=b.furthest===A.furthest?function(M,$){if(function(){if(r._supportsSet!==void 0)return r._supportsSet;var At=typeof Set<"u";return r._supportsSet=At,At}()&&Array.from){for(var _=new Set(M),D=0;D<$.length;D++)_.add($[D]);var H=Array.from(_);return H.sort(),H}for(var se={},ke=0;ke<M.length;ke++)se[M[ke]]=!0;for(var ye=0;ye<$.length;ye++)se[$[ye]]=!0;var Et=[];for(var rt in se)({}).hasOwnProperty.call(se,rt)&&Et.push(rt);return Et.sort(),Et}(b.expected,A.expected):A.expected;return{status:b.status,index:b.index,value:b.value,furthest:A.furthest,expected:S}}var F={};function W(b,A){if(T(b))return{offset:A,line:-1,column:-1};b in F||(F[b]={});for(var S=F[b],M=0,$=0,_=0,D=A;D>=0;){if(D in S){M=S[D].line,_===0&&(_=S[D].lineStart);break}(b.charAt(D)===`
`||b.charAt(D)==="\r"&&b.charAt(D+1)!==`
`)&&($++,_===0&&(_=D+1)),D--}var H=M+$,se=A-_;return S[A]={line:H,lineStart:_},{offset:A,line:H+1,column:se+1}}function Ce(b){if(!x(b))throw new Error("not a parser: "+b)}function Te(b,A){return typeof b=="string"?b.charAt(A):b[A]}function Xe(b){if(typeof b!="number")throw new Error("not a number: "+b)}function We(b){if(typeof b!="function")throw new Error("not a function: "+b)}function Le(b){if(typeof b!="string")throw new Error("not a string: "+b)}var tn=2,Ut=3,et=8,rn=5*et,Pr=4*et,qt="  ";function er(b,A){return new Array(A+1).join(b)}function Ot(b,A,S){var M=A-b.length;return M<=0?b:er(S,M)+b}function nn(b,A,S,M){return{from:b-A>0?b-A:0,to:b+S>M?M:b+S}}function Vn(b,A){var S,M,$,_,D,H=A.index,se=H.offset,ke=1;if(se===b.length)return"Got the end of the input";if(T(b)){var ye=se-se%et,Et=se-ye,rt=nn(ye,rn,Pr+et,b.length),At=a(function(Ie){return a(function(nr){return Ot(nr.toString(16),2,"0")},Ie)},function(Ie,nr){var sr=Ie.length,Qt=[],ir=0;if(sr<=nr)return[Ie.slice()];for(var or=0;or<sr;or++)Qt[ir]||Qt.push([]),Qt[ir].push(Ie[or]),(or+1)%nr==0&&ir++;return Qt}(b.slice(rt.from,rt.to).toJSON().data,et));_=function(Ie){return Ie.from===0&&Ie.to===1?{from:Ie.from,to:Ie.to}:{from:Ie.from/et,to:Math.floor(Ie.to/et)}}(rt),M=ye/et,S=3*Et,Et>=4&&(S+=1),ke=2,$=a(function(Ie){return Ie.length<=4?Ie.join(" "):Ie.slice(0,4).join(" ")+"  "+Ie.slice(4).join(" ")},At),(D=(8*(_.to>0?_.to-1:_.to)).toString(16).length)<2&&(D=2)}else{var rr=b.split(/\r\n|[\n\r\u2028\u2029]/);S=H.column-1,M=H.line-1,_=nn(M,tn,Ut,rr.length),$=rr.slice(_.from,_.to),D=_.to.toString().length}var Ba=M-_.from;return T(b)&&(D=(8*(_.to>0?_.to-1:_.to)).toString(16).length)<2&&(D=2),o(function(Ie,nr,sr){var Qt,ir=sr===Ba,or=ir?"> ":qt;return Qt=T(b)?Ot((8*(_.from+sr)).toString(16),D,"0"):Ot((_.from+sr+1).toString(),D," "),[].concat(Ie,[or+Qt+" | "+nr],ir?[qt+er(" ",D)+" | "+Ot("",S," ")+er("^",ke)]:[])},[],$).join(`
`)}function sn(b,A){return[`
`,"-- PARSING FAILED "+er("-",50),`

`,Vn(b,A),`

`,(S=A.expected,S.length===1?`Expected:

`+S[0]:`Expected one of the following: 

`+S.join(", ")),`
`].join("");var S}function on(b){return b.flags!==void 0?b.flags:[b.global?"g":"",b.ignoreCase?"i":"",b.multiline?"m":"",b.unicode?"u":"",b.sticky?"y":""].join("")}function Bt(){for(var b=[].slice.call(arguments),A=b.length,S=0;S<A;S+=1)Ce(b[S]);return r(function(M,$){for(var _,D=new Array(A),H=0;H<A;H+=1){if(!(_=U(b[H]._(M,$),_)).status)return _;D[H]=_.value,$=_.index}return U(R($,D),_)})}function mt(){var b=[].slice.call(arguments);if(b.length===0)throw new Error("seqMap needs at least one argument");var A=b.pop();return We(A),Bt.apply(null,b).map(function(S){return A.apply(null,S)})}function tr(){var b=[].slice.call(arguments),A=b.length;if(A===0)return Nt("zero alternates");for(var S=0;S<A;S+=1)Ce(b[S]);return r(function(M,$){for(var _,D=0;D<b.length;D+=1)if((_=U(b[D]._(M,$),_)).status)return _;return _})}function an(b,A){return Vt(b,A).or(pt([]))}function Vt(b,A){return Ce(b),Ce(A),mt(b,A.then(b).many(),function(S,M){return[S].concat(M)})}function Dt(b){Le(b);var A="'"+b+"'";return r(function(S,M){var $=M+b.length,_=S.slice(M,$);return _===b?R($,_):L(M,A)})}function tt(b,A){(function($){if(!($ instanceof RegExp))throw new Error("not a regexp: "+$);for(var _=on($),D=0;D<_.length;D++){var H=_.charAt(D);if(H!=="i"&&H!=="m"&&H!=="u"&&H!=="s")throw new Error('unsupported regexp flag "'+H+'": '+$)}})(b),arguments.length>=2?Xe(A):A=0;var S=function($){return RegExp("^(?:"+$.source+")",on($))}(b),M=""+b;return r(function($,_){var D=S.exec($.slice(_));if(D){if(0<=A&&A<=D.length){var H=D[0],se=D[A];return R(_+H.length,se)}return L(_,"valid match group (0 to "+D.length+") in "+M)}return L(_,M)})}function pt(b){return r(function(A,S){return R(S,b)})}function Nt(b){return r(function(A,S){return L(S,b)})}function Rt(b){if(x(b))return r(function(A,S){var M=b._(A,S);return M.index=S,M.value="",M});if(typeof b=="string")return Rt(Dt(b));if(b instanceof RegExp)return Rt(tt(b));throw new Error("not a string, regexp, or parser: "+b)}function ln(b){return Ce(b),r(function(A,S){var M=b._(A,S),$=A.slice(S,M.index);return M.status?L(S,'not "'+$+'"'):R(S,null)})}function ht(b){return We(b),r(function(A,S){var M=Te(A,S);return S<A.length&&b(M)?R(S+1,M):L(S,"a character/byte matching "+b)})}function w(b,A){arguments.length<2&&(A=b,b=void 0);var S=r(function(M,$){return S._=A()._,S._(M,$)});return b?S.desc(b):S}function d(){return Nt("fantasy-land/empty")}s.parse=function(b){if(typeof b!="string"&&!T(b))throw new Error(".parse must be called with a string or Buffer as its argument");var A,S=this.skip(z)._(b,0);return A=S.status?{status:!0,value:S.value}:{status:!1,index:W(b,S.furthest),expected:S.expected},delete F[b],A},s.tryParse=function(b){var A=this.parse(b);if(A.status)return A.value;var S=sn(b,A),M=new Error(S);throw M.type="ParsimmonError",M.result=A,M},s.assert=function(b,A){return this.chain(function(S){return b(S)?pt(S):Nt(A)})},s.or=function(b){return tr(this,b)},s.trim=function(b){return this.wrap(b,b)},s.wrap=function(b,A){return mt(b,this,A,function(S,M){return M})},s.thru=function(b){return b(this)},s.then=function(b){return Ce(b),Bt(this,b).map(function(A){return A[1]})},s.many=function(){var b=this;return r(function(A,S){for(var M=[],$=void 0;;){if(!($=U(b._(A,S),$)).status)return U(R(S,M),$);if(S===$.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");S=$.index,M.push($.value)}})},s.tieWith=function(b){return Le(b),this.map(function(A){if(function($){if(!P($))throw new Error("not an array: "+$)}(A),A.length){Le(A[0]);for(var S=A[0],M=1;M<A.length;M++)Le(A[M]),S+=b+A[M];return S}return""})},s.tie=function(){return this.tieWith("")},s.times=function(b,A){var S=this;return arguments.length<2&&(A=b),Xe(b),Xe(A),r(function(M,$){for(var _=[],D=void 0,H=void 0,se=0;se<b;se+=1){if(H=U(D=S._(M,$),H),!D.status)return H;$=D.index,_.push(D.value)}for(;se<A&&(H=U(D=S._(M,$),H),D.status);se+=1)$=D.index,_.push(D.value);return U(R($,_),H)})},s.result=function(b){return this.map(function(){return b})},s.atMost=function(b){return this.times(0,b)},s.atLeast=function(b){return mt(this.times(b),this.many(),function(A,S){return A.concat(S)})},s.map=function(b){We(b);var A=this;return r(function(S,M){var $=A._(S,M);return $.status?U(R($.index,b($.value)),$):$})},s.contramap=function(b){We(b);var A=this;return r(function(S,M){var $=A.parse(b(S.slice(M)));return $.status?R(M+S.length,$.value):$})},s.promap=function(b,A){return We(b),We(A),this.contramap(b).map(A)},s.skip=function(b){return Bt(this,b).map(function(A){return A[0]})},s.mark=function(){return mt(v,this,v,function(b,A,S){return{start:b,value:A,end:S}})},s.node=function(b){return mt(v,this,v,function(A,S,M){return{name:b,value:S,start:A,end:M}})},s.sepBy=function(b){return an(this,b)},s.sepBy1=function(b){return Vt(this,b)},s.lookahead=function(b){return this.skip(Rt(b))},s.notFollowedBy=function(b){return this.skip(ln(b))},s.desc=function(b){P(b)||(b=[b]);var A=this;return r(function(S,M){var $=A._(S,M);return $.status||($.expected=b),$})},s.fallback=function(b){return this.or(pt(b))},s.ap=function(b){return mt(b,this,function(A,S){return A(S)})},s.chain=function(b){var A=this;return r(function(S,M){var $=A._(S,M);return $.status?U(b($.value)._(S,$.index),$):$})},s.concat=s.or,s.empty=d,s.of=pt,s["fantasy-land/ap"]=s.ap,s["fantasy-land/chain"]=s.chain,s["fantasy-land/concat"]=s.concat,s["fantasy-land/empty"]=s.empty,s["fantasy-land/of"]=s.of,s["fantasy-land/map"]=s.map;var v=r(function(b,A){return R(A,W(b,A))}),k=r(function(b,A){return A>=b.length?L(A,"any character/byte"):R(A+1,Te(b,A))}),O=r(function(b,A){return R(b.length,b.slice(A))}),z=r(function(b,A){return A<b.length?L(A,"EOF"):R(A,null)}),K=tt(/[0-9]/).desc("a digit"),X=tt(/[0-9]*/).desc("optional digits"),B=tt(/[a-z]/i).desc("a letter"),re=tt(/[a-z]*/i).desc("optional letters"),kr=tt(/\s*/).desc("optional whitespace"),_e=tt(/\s+/).desc("whitespace"),xe=Dt("\r"),Ft=Dt(`
`),Me=Dt(`\r
`),be=tr(Me,Ft,xe).desc("newline"),Oe=tr(be,z);r.all=O,r.alt=tr,r.any=k,r.cr=xe,r.createLanguage=function(b){var A={};for(var S in b)({}).hasOwnProperty.call(b,S)&&function(M){A[M]=w(function(){return b[M](A)})}(S);return A},r.crlf=Me,r.custom=function(b){return r(b(R,L))},r.digit=K,r.digits=X,r.empty=d,r.end=Oe,r.eof=z,r.fail=Nt,r.formatError=sn,r.index=v,r.isParser=x,r.lazy=w,r.letter=B,r.letters=re,r.lf=Ft,r.lookahead=Rt,r.makeFailure=L,r.makeSuccess=R,r.newline=be,r.noneOf=function(b){return ht(function(A){return b.indexOf(A)<0}).desc("none of '"+b+"'")},r.notFollowedBy=ln,r.of=pt,r.oneOf=function(b){for(var A=b.split(""),S=0;S<A.length;S++)A[S]="'"+A[S]+"'";return ht(function(M){return b.indexOf(M)>=0}).desc(A)},r.optWhitespace=kr,r.Parser=r,r.range=function(b,A){return ht(function(S){return b<=S&&S<=A}).desc(b+"-"+A)},r.regex=tt,r.regexp=tt,r.sepBy=an,r.sepBy1=Vt,r.seq=Bt,r.seqMap=mt,r.seqObj=function(){for(var b,A={},S=0,M=(b=arguments,Array.prototype.slice.call(b)),$=M.length,_=0;_<$;_+=1){var D=M[_];if(!x(D)){if(P(D)&&D.length===2&&typeof D[0]=="string"&&x(D[1])){var H=D[0];if(Object.prototype.hasOwnProperty.call(A,H))throw new Error("seqObj: duplicate key "+H);A[H]=!0,S++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(S===0)throw new Error("seqObj expects at least one named parser, found zero");return r(function(se,ke){for(var ye,Et={},rt=0;rt<$;rt+=1){var At,rr;if(P(M[rt])?(At=M[rt][0],rr=M[rt][1]):(At=null,rr=M[rt]),!(ye=U(rr._(se,ke),ye)).status)return ye;At&&(Et[At]=ye.value),ke=ye.index}return U(R(ke,Et),ye)})},r.string=Dt,r.succeed=pt,r.takeWhile=function(b){return We(b),r(function(A,S){for(var M=S;M<A.length&&b(Te(A,M));)M++;return R(M,A.slice(S,M))})},r.test=ht,r.whitespace=_e,r["fantasy-land/empty"]=d,r["fantasy-land/of"]=pt,r.Binary={bitSeq:g,bitSeqObj:function(b){h();var A={},S=0,M=a(function(_){if(P(_)){var D=_;if(D.length!==2)throw new Error("["+D.join(", ")+"] should be length 2, got length "+D.length);if(Le(D[0]),Xe(D[1]),Object.prototype.hasOwnProperty.call(A,D[0]))throw new Error("duplicate key in bitSeqObj: "+D[0]);return A[D[0]]=!0,S++,D}return Xe(_),[null,_]},b);if(S<1)throw new Error("bitSeqObj expects at least one named pair, got ["+b.join(", ")+"]");var $=a(function(_){return _[0]},M);return g(a(function(_){return _[1]},M)).map(function(_){return o(function(D,H){return H[0]!==null&&(D[H[0]]=H[1]),D},{},a(function(D,H){return[D,_[H]]},$))})},byte:function(b){if(h(),Xe(b),b>255)throw new Error("Value specified to byte constructor ("+b+"=0x"+b.toString(16)+") is larger in value than a single byte.");var A=(b>15?"0x":"0x0")+b.toString(16);return r(function(S,M){var $=Te(S,M);return $===b?R(M+1,$):L(M,A)})},buffer:function(b){return u("buffer",b).map(function(A){return Buffer.from(A)})},encodedString:function(b,A){return u("string",A).map(function(S){return S.toString(b)})},uintBE:m,uint8BE:m(1),uint16BE:m(2),uint32BE:m(4),uintLE:y,uint8LE:y(1),uint16LE:y(2),uint32LE:y(4),intBE:E,int8BE:E(1),int16BE:E(2),int32BE:E(4),intLE:C,int8LE:C(1),int16LE:C(2),int32LE:C(4),floatBE:u("floatBE",4).map(function(b){return b.readFloatBE(0)}),floatLE:u("floatLE",4).map(function(b){return b.readFloatLE(0)}),doubleBE:u("doubleBE",8).map(function(b){return b.readDoubleBE(0)}),doubleLE:u("doubleLE",8).map(function(b){return b.readDoubleLE(0)})},e.exports=r}])})});var jt=Ue(qe());var lt=Ue(qe());var ut=Ue(qe()),gl=()=>({view:e=>{let t={[e.attrs.page]:"active"},n=[];window.authorizer.hasAccess("devices",1)&&n.push((0,ut.default)("li",{class:t.overview},(0,ut.default)("a",{href:"#!/overview"},"Overview"))),window.authorizer.hasAccess("devices",2)&&n.push((0,ut.default)("li",{class:t.devices},(0,ut.default)("a",{href:"#!/devices"},"Devices"))),window.authorizer.hasAccess("faults",2)&&n.push((0,ut.default)("li",{class:t.faults},(0,ut.default)("a",{href:"#!/faults"},"Faults")));let r=["presets","provisions","virtualParameters","files"];for(let s of r)if(window.authorizer.hasAccess(s,2)){n.push((0,ut.default)("li",{class:t.admin},(0,ut.default)("a",{href:"#!/admin"},"Admin")));break}return(0,ut.default)("nav",(0,ut.default)("ul",n))}}),Gi=gl;var q=Ue(qe());var bt=Ue(qe());var N=Ue(Yi());function bl(e){let t={b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};return e.replace(/\\(u[0-9a-fA-F]{4}|[^u])/g,(n,r)=>{let s=r.charAt(0),i=r.slice(1);return s==="u"?String.fromCharCode(parseInt(i,16)):t.hasOwnProperty(s)?t[s]:s})}function ne(e,t){if(!Array.isArray(e))return t(e);let n;for(let r=1;r<e.length;++r){let s=ne(e[r],t);s!==e[r]&&(n=n||e.slice(),n[r]=s)}return t(n||e)}function Or(e,t){return N.default.seqMap(t,N.default.seq(e,t).many(),(n,r)=>r.reduce((s,i)=>{let[o,a]=i;return Array.isArray(s)&&o===s[0]?s.concat([a]):[o,s,a]},n))}var yl=N.default.createLanguage({ComparisonOperator:function(){return N.default.alt(N.default.string(">="),N.default.string("<>"),N.default.string("<="),N.default.string("="),N.default.string(">"),N.default.string("<")).skip(N.default.optWhitespace)},LikeOperator:function(){return N.default.alt(N.default.regexp(/like/i).result("LIKE").desc("LIKE"),N.default.regexp(/not\s+like/i).result("NOT LIKE").desc("NOT LIKE")).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace)},IsNullOperator:function(){return N.default.alt(N.default.regexp(/is\s+null/i).result("IS NULL").desc("IS NULL"),N.default.regexp(/is\s+not\s+null/i).result("IS NOT NULL").desc("IS NOT NULL")).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace)},NotOperator:function(){return N.default.regexp(/not/i).result("NOT").notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).desc("NOT")},AndOperator:function(){return N.default.regexp(/and/i).result("AND").notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).desc("AND")},OrOperator:function(){return N.default.regexp(/or/i).result("OR").notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).desc("OR")},Parameter:function(e){return N.default.alt(N.default.regexp(/[a-zA-Z0-9_.*-]+/),e.Expression.wrap(N.default.string("{").skip(N.default.optWhitespace),N.default.string("}"))).atLeast(1).map(t=>["PARAM",t.length>1?["||"].concat(t):t[0]]).skip(N.default.optWhitespace).desc("parameter")},StringValueSql:function(){return N.default.regexp(/'([^']*)'/,1).atLeast(1).skip(N.default.optWhitespace).map(e=>e.join("'")).desc("string")},StringValueJs:function(){return N.default.regexp(/"((?:\\.|.)*?)"/,1).skip(N.default.optWhitespace).map(bl).desc("string")},NumberValue:function(){return N.default.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).map(Number).desc("number")},BooleanValue:function(){return N.default.alt(N.default.regexp(/true/i).result(!0).desc("TRUE"),N.default.regexp(/false/i).result(!1).desc("FALSE")).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace)},NullValue:function(){return N.default.regexp(/null/i).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).result(null).desc("NULL")},FuncValue:function(e){return N.default.seqMap(N.default.regexp(/([a-zA-Z0-9_]+)/,1).skip(N.default.optWhitespace).desc("function"),e.ExpressionList.wrap(N.default.string("(").skip(N.default.optWhitespace),N.default.string(")").skip(N.default.optWhitespace)),(t,n)=>["FUNC",t.toUpperCase()].concat(n))},WhenPair:function(e){return N.default.seq(N.default.regexp(/when/i).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).desc("WHEN").then(e.Expression),N.default.regexp(/then/i).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).desc("THEN").then(e.Expression))},CaseStatement:function(e){return N.default.seqMap(N.default.regexp(/case/i).result("CASE").notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).desc("CASE"),e.WhenPair.many(),N.default.regexp(/else/i).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/)).skip(N.default.optWhitespace).desc("ELSE").then(e.Expression).map(t=>[[!0,t]]).fallback(null).skip(N.default.regex(/end/i).notFollowedBy(N.default.regexp(/[a-zA-Z0-9_]/))).skip(N.default.optWhitespace),(...t)=>t.flat(2))},Value:function(e){return N.default.alt(e.NullValue,e.BooleanValue,e.NumberValue,e.StringValueSql,e.StringValueJs,e.FuncValue,e.CaseStatement)},ValueExpression:function(e){return Or(N.default.string("||").skip(N.default.optWhitespace),Or(N.default.alt(N.default.string("+"),N.default.string("-")).skip(N.default.optWhitespace),Or(N.default.alt(N.default.string("*"),N.default.string("/"),N.default.string("%")).skip(N.default.optWhitespace),N.default.alt(e.Value,e.Parameter,e.Expression.wrap(N.default.string("(").skip(N.default.optWhitespace),N.default.string(")").skip(N.default.optWhitespace))))))},Comparison:function(e){return N.default.alt(N.default.seqMap(e.ValueExpression,e.IsNullOperator,(t,n)=>[n,t]),N.default.seqMap(e.ValueExpression,e.ComparisonOperator,e.ValueExpression,(t,n,r)=>[n,t,r]),N.default.seqMap(e.ValueExpression,e.LikeOperator,e.ValueExpression.skip(N.default.regexp(/escape/i).result("ESCAPE").skip(N.default.whitespace).desc("ESCAPE")),e.ValueExpression,(t,n,r,s)=>[n,t,r,s]),N.default.seqMap(e.ValueExpression,e.LikeOperator,e.ValueExpression,(t,n,r)=>[n,t,r]))},ExpressionList:function(e){return e.Expression.sepBy(N.default.string(",").skip(N.default.optWhitespace))},Expression:function(e){function t(n,r){return N.default.seq(n,r).or(r)}return Or(e.OrOperator,Or(e.AndOperator,t(e.NotOperator,e.Comparison.or(e.ValueExpression)))).trim(N.default.optWhitespace)}});function he(e){return e?yl.Expression.tryParse(e):null}function J(e,t=0){if(!Array.isArray(e))return JSON.stringify(e);let n={OR:10,AND:11,NOT:12,"=":20,"<>":20,">":20,">=":20,"<":20,"<=":20,LIKE:20,"NOT LIKE":20,"IS NULL":20,"IS NOT NULL":20,"||":30,"+":31,"-":31,"*":32,"/":32,"%":32},r=e[0].toUpperCase();function s(i){return n[r]<=t?`(${i})`:i}if(r==="FUNC")return s(`${e[1]}(${e.slice(2).map(i=>J(i)).join(", ")})`);if(r==="PARAM")return typeof e[1]=="string"?s(e[1]):Array.isArray(e[1])&&e[1][0]==="||"?s(e[1].slice(1).map(i=>typeof i=="string"?i:`{${J(i)}}`).join("")):s(`{${J(e[1])}}`);if(r==="IS NULL"||r==="IS NOT NULL")return s(`${J(e[1],n[r])} ${r}`);if(r==="LIKE"||r==="NOT LIKE")return e[3]?s(`${J(e[1],n[r])} ${r} ${J(e[2],n[r])} ESCAPE ${J(e[3],n[r])}`):s(`${J(e[1],n[r])} ${r} ${J(e[2],n[r])}`);if(r==="CASE"){let i=["CASE"];for(let o=1;o<e.length-1;o+=2){if(!Array.isArray(e[o])&&e[o]){e[o+1]!=null&&i.push("ELSE",J(e[o+1]));break}i.push("WHEN",J(e[o]),"THEN",J(e[o+1]))}return i.push("END"),i.join(" ")}else if(r in n){let i=e.slice(1).map((o,a)=>J(o,n[e[0]]+Math.min(a-1,0)));return s(r==="NOT"?`${r} ${i[0]}`:i.join(` ${r} `))}else throw new Error(`Unrecognized operator ${e[0]}`)}function lr(e,t){let n=e.split("");for(let r=0;r<n.length;++r){let s=n[r];if(s===t)n[r]=n[r+1]||"",n[r+1]="";else if(s==="_")n[r]="\\_";else if(s==="%")for(n[r]="\\%";n[r+1]==="%";)n[++r]=""}return n.filter(r=>r)}var Y=Array.isArray,hn=new WeakMap,Ht={};function ur(e,t){let n=!0;for(;n;){n=!1;for(let r=2;r<e.length;++r){let s=t(e[r-1],e[r],r-2);s!==Ht&&(n=!0,e=e.slice(),e.splice(r-1,2,s))}}return e.length===2?e[1]:e}function Zi(e,t="",n=""){let r={"-":"\\-","/":"\\/","\\":"\\/","^":"\\^",$:"\\$","*":"\\*","+":"\\+","?":"\\?",".":"\\.","(":"\\(",")":"\\)","|":"\\|","[":"\\[","]":"\\]","{":"\\{","}":"\\}","\\%":".*","\\_":"."},s=lr(e,t);if(!s.length)return new RegExp("^$",n);s=s.map(o=>r[o]||o),s[0]=s[0]===".*"?"":"^"+s[0];let i=s.length-1;return s[i]=[".*",""].includes(s[i])?"":s[i]+"$",new RegExp(s.join(""),n)}function cr(e,t){return typeof e=="boolean"&&(e=+e),typeof t=="boolean"&&(t=+t),typeof e!=typeof t?typeof e=="string"?1:-1:e>t?1:e<t?-1:0}function st(e){switch(typeof e){case"number":return e;case"boolean":return+e;case"string":return parseFloat(e)||0}}function dn(e){switch(typeof e){case"string":return e;case"number":return e.toString();case"boolean":return(+e).toString()}}function ns(e){if(!Array.isArray(e))return e;if(e[0]==="CASE"){for(let t=1;t<e.length;t+=2){if(Array.isArray(e[t]))return e;if(e[t])return e[t+1]}return null}else if(e[0]==="FUNC"){if(e[1]==="COALESCE"){let t=[];for(let n=2;n<e.length;++n){let r=e[n];if(r!=null&&(t.push(r),!Array.isArray(r)))break}return t.length?t.length===1?t[0]:["FUNC","COALESCE",...t]:null}else if(e[1]==="UPPER"){if(e[2]==null)return null;if(!Y(e[2]))return dn(e[2]).toUpperCase()}else if(e[1]==="LOWER"){if(e[2]==null)return null;if(!Y(e[2]))return dn(e[2]).toLowerCase()}else if(e[1]==="ROUND"){let t=e[2],n=e.length>3?e[3]:0;if(t==null||n==null)return null;if(!Y(t)&&!Y(n)){let r=10**n,s=t*r*(1+Number.EPSILON);return Math.round(s)/r}}}else if(e[0]==="PARAM"){if(e[1]==null)return null}else if(e[0]==="AND"){for(let n=1;n<e.length;++n)if(!Array.isArray(e[n])&&e[n]!=null&&!e[n])return!1;let t=[];for(let n=1;n<e.length;++n){let r=e[n];if(r==null)return null;Array.isArray(r)&&(r[0]==="AND"?t.push(...r.slice(1)):t.push(r))}return t.length?(t.length===1&&t.push(!0),["AND",...t]):!0}else if(e[0]==="OR"){let t=[];for(let n=1;n<e.length;++n){let r=e[n];if(Array.isArray(r))r[0]==="OR"?t.push(...r.slice(1)):t.push(r);else if(r)return!0}return t.length?(t.length===1&&t.push(!1),["OR",...t]):e.some(n=>n==null)?null:!1}else if(e[0]==="NOT"){if(e[1]==null)return null;if(Y(e[1])){if(e[1][0]==="NOT")return e[1][1]}else return!e[1]}else{if(e[0]==="IS NULL")return Y(e[1])?e:e[1]==null;if(e[0]==="IS NOT NULL")return Y(e[1])?e:e[1]!=null;if(e[0]==="LIKE"){if(Y(e[1])||Y(e[2])||Y(e[3]))return e;if(e[1]==null||e[2]==null||e.length>=4&&e[3]==null)return null;let t=hn.get(e);return t||(t=Zi(e[2],e[3]),hn.set(e,t)),t.test(e[1])}else if(e[0]==="NOT LIKE"){if(Y(e[1])||Y(e[2])||Y(e[3]))return e;if(e[1]==null||e[2]==null||e.length>=4&&e[3]==null)return null;let t=hn.get(e);return t||(t=Zi(e[2],e[3]),hn.set(e,t)),!t.test(e[1])}else{if(e[0]==="=")return e[1]==null||e[2]==null?null:Y(e[1])||Y(e[2])?e:cr(e[1],e[2])===0;if(e[0]==="<>")return e[1]==null||e[2]==null?null:Y(e[1])||Y(e[2])?e:cr(e[1],e[2])!==0;if(e[0]===">")return e[1]==null||e[2]==null?null:Y(e[1])||Y(e[2])?e:cr(e[1],e[2])>0;if(e[0]===">=")return e[1]==null||e[2]==null?null:Y(e[1])||Y(e[2])?e:cr(e[1],e[2])>=0;if(e[0]==="<")return e[1]==null||e[2]==null?null:Y(e[1])||Y(e[2])?e:cr(e[1],e[2])<0;if(e[0]==="<=")return e[1]==null||e[2]==null?null:Y(e[1])||Y(e[2])?e:cr(e[1],e[2])<=0;if(e[0]==="*")return ur(e,(t,n)=>t==null||n==null?null:!Y(t)&&!Y(n)?st(t)*st(n):Ht);if(e[0]==="/")return ur(e,(t,n,r)=>{if(t==null||n==null)return null;if(Y(t)||Y(n))return Ht;let s=st(t),i=st(n);return r!==0?s*i:i===0?null:s/i});if(e[0]==="+")return ur(e,(t,n)=>t==null||n==null?null:!Y(t)&&!Y(n)?st(t)+st(n):Ht);if(e[0]==="-")return ur(e,(t,n,r)=>t==null||n==null?null:!Y(t)&&!Y(n)?r===0?st(t)-st(n):st(t)+st(n):Ht);if(e[0]==="%")return ur(e,(t,n,r)=>{if(t==null||n==null)return null;if(Y(t)||Y(n)||r!==0)return Ht;let s=st(t),i=Math.trunc(st(n));return i===0?null:s%i});if(e[0]==="||")return ur(e,(t,n)=>t==null||n==null?null:!Y(t)&&!Y(n)?dn(t)+dn(n):Ht)}}return e}function dt(e,t,n,r){return ne(e,s=>{if(r&&(s=r(s)),!Y(s))return s;if(s[0]==="FUNC"&&s[1]==="NOW"){if(n)return n}else if(s[0]==="PARAM"){if(s[1]==null)return null;if(t&&!Y(s[1])){let i;return typeof t=="function"?i=t(s[1]):i=t[s[1]],i==null?null:(typeof i=="object"&&(i=i.value?i.value[0]:null),i)}}return ns(s)})}function it(e,t){if(e!=null&&!e||t!=null&&!t)return!1;if(!Array.isArray(e)&&!Array.isArray(t))return e==null||t==null?null:!0;if(!Array.isArray(t)&&e[0]==="AND")return e;if(!Array.isArray(e)&&t[0]==="AND")return t;let n=["AND"];return Array.isArray(e)&&e[0]==="AND"?n.push(...e.slice(1)):n.push(e),Array.isArray(t)&&t[0]==="AND"?n.push(...t.slice(1)):n.push(t),n}function gt(e,t){if(!Array.isArray(e)&&e||!Array.isArray(t)&&t)return!0;if(!Array.isArray(e)&&!Array.isArray(t))return e==null||t==null?null:!1;if(!Array.isArray(t)&&e[0]==="OR")return e;if(!Array.isArray(e)&&t[0]==="OR")return t;let n=["OR"];return Array.isArray(e)&&e[0]==="OR"?n.push(...e.slice(1)):n.push(e),Array.isArray(t)&&t[0]==="OR"?n.push(...t.slice(1)):n.push(t),n}function Xi(e){let t=new Set;return ne(e,n=>(Y(n)&&n[0]==="PARAM"&&t.add(n[1]),n)),Array.from(t)}var Kt=new Map,gn=new Map,eo=new WeakMap;function to(e){if(e===null)return"null";if(e===void 0)return"undefined";let t=typeof e;if(t==="number"||t==="boolean"||t==="string")return`${t}:${e}`;if(t!=="function"&&t!=="object")throw new Error(`Cannot memoize ${t} arguments`);let n=eo.get(e);if(!n){let r=Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER);n=`${t}:${r.toString(36)}`,eo.set(e,n)}return n}function V(e){let t=to(e);return(...n)=>{let r=JSON.stringify(n.map(to))+t;if(Kt.has(r))return Kt.get(r);let s;return gn.has(r)?Kt.set(r,s=gn.get(r)):(Kt.set(r,s=e(...n)),s instanceof Promise&&s.catch(()=>{Kt.delete(r),gn.delete(r)})),s}}var ro=setInterval(()=>{gn=Kt,Kt=new Map},12e4);ro.unref&&ro.unref();var ss=Ue(qe()),is=new Set;function I(e,t,n){let r={type:e,message:t,timestamp:Date.now(),actions:n};return is.add(r),ss.default.redraw(),n||setTimeout(()=>{Dr(r)},4e3),r}function Dr(e){is.delete(e),ss.default.redraw()}function no(){return is}var ue=window.clientConfig,so=window.configSnapshot,io=window.genieacsVersion;function te(e,t){return e&t}function ee(e,t){return e|t}function ce(e,t){return e^t}function hr(e){return~e}function dr(e,t){return e<<t}function Lt(e,t){return e>>t}function vl(e,t){return e-t}function cs(e){return Number(e)}function Pt(e,t){return e===t}function ct(e,t){return e!==t}function lo(e,t){return e>=t}function fs(e,t){return BigInt.asIntN(e,t)}var yn=BigInt,$r=512,de=yn(0),at=yn(1),Cl=hr(de),ms=yn(32),Z=[],El=[];for(let e=0;e<=$r;++e){let t=dr(at,yn(e));Z.push(t),El.push(hr(t))}var pr=Z.filter((e,t)=>t%2===0).reduce((e,t)=>ee(e,t));function Jt(e){let t=[],n=0;for(;ct(e,de);){let r=cs(fs(32,e));e=Lt(e,ms);let s=Math.clz32(r);for(;s<32;){let i=31-s;t.push(n+i),r^=1<<i,s=Math.clz32(r)}n+=32}return t}function wn(e){let n=[],r=0;for(;ct(e,de);){let s=cs(fs(32,e));s=s&1431655765|s>>1&1431655765,e=Lt(e,ms);let i=Math.clz32(s);for(;i<32;){let o=31-i;n.push(r+o),s^=1<<o,i=Math.clz32(s)}r+=32}return n}function vn(e,t){let n=new Map;for(let r of t){let s=r-r%2;if(n.has(s))continue;let i=new Set;for(let o of e)(o.set.has(r)||o.set.has(r+1))&&i.add(o);i.size&&n.set(s,i)}if(n.size<=1)return[e];for(let r of e){let s=-1;for(let[i,o]of n)if(o.has(r)){if(s===-1){s=i;continue}if(n.set(s,new Set([...n.get(s),...o])),n.delete(i),n.size===1)return[e]}}return[...n.values()].map(r=>[...r])}function ot(e){return ee(dr(te(e,pr),at),te(Lt(e,at),pr))}function $t(e,t=$r){let n=0;for(;n<t&&ct(e,de);++n)e=te(e,vl(e,at));return n}var St=class fr{constructor(t,n,r){this._bigint=t,this._set=n,this._hash=r}get bigint(){return this._bigint}get set(){return this._set}get hash(){return this._hash}get empty(){for(let t of this._set)if(this._set.has(t^1))return!0;return!1}raise(t){if(!this._set.has(t))return this;let n=ce(this._bigint,Z[t]),r=new Set(this._set);r.delete(t);let s=this._hash^1<<t;return new fr(n,r,s)}lower(t){if(this._set.has(t))return this;let n=ee(this._bigint,Z[t]),r=new Set([...this._set,t]),s=this._hash^1<<t;return new fr(n,r,s)}covers(t){return this.set.size<=t.set.size&&Pt(te(this.bigint,t.bigint),this.bigint)}static parse(t){let n=t.split(""),r=de,s=0,i=new Set;for(let[o,a]of n.entries()){if(a==="-")continue;let l=o*2;if(a==="0")r=ee(r,Z[l]),i.add(l),s^=1<<l;else if(a==="1")r=ee(r,Z[l+1]),i.add(l+1),s^=2<<l;else if(a==="/")r=ee(r,Z[l]),i.add(l),r=ee(r,Z[l+1]),i.add(l+1),s^=3<<l;else throw new Error("Invalid cube string")}return new fr(r,i,s)}toString(){let t=this.bigint.toString(2);return t.length%2&&(t="0"+t),t.match(/.{2}/g).reverse().map(s=>s==="00"?"-":s==="01"?"0":s==="10"?"1":"/").join("")}static from(t){let n=de,r=0,s=new Set;for(let i of t)s.add(i),r^=1<<i,n=ee(n,Z[i]);return new fr(n,s,r)}static fromBigInt(t){let n=0,r=new Set,s=0,i=t;for(;ct(i,de);){let o=cs(fs(32,i));n^=o,i=Lt(i,ms);let a=Math.clz32(o);for(;a<32;){let l=31-a;r.add(s+l),o^=1<<l,a=Math.clz32(o)}s+=32}return new fr(t,r,n)}},He=class os{constructor(t,n,r){this._cubes=t,this._count=n,this._bigint=r}static from(t){let n=[],r=de,s=[];for(let i of t){r=ee(r,i.bigint),n.push(i);for(let o of i.set){for(;s.length<=o+1-o%2;)s.push(0);++s[o]}}return new os(n,s,r)}get bigint(){return this._bigint}get cubes(){return this._cubes}count(t){return this._count[t]}filter(t){let n=this._count.slice(),r=this._bigint,s=this._cubes.filter(i=>{if(t(i))return!0;for(let o of i.set)--n[o]||(r=ce(r,Z[o]));return!1});return new os(s,n,r)}pop(){let t=this._cubes.pop();if(t){for(let n of t.set)--this._count[n]||(this._bigint=ce(this._bigint,Z[n]));return t}}push(t){let n=this._cubes.push(t);for(let r of t.set)++this._count[r];return this._bigint=ee(this._bigint,t.bigint),n}unshift(t){let n=this._cubes.unshift(t);for(let r of t.set)++this._count[r];return this._bigint=ee(this._bigint,t.bigint),n}};function Nr(e,t=de,n=te(e.bigint,hr(ee(t,ot(t))))){let r=!1,s=!1;do if(r=!1,e=e.filter(g=>{if(ct(te(t,g.bigint),de))return!1;let u=te(g.bigint,n),c=$t(u,2);return c===1?(r=!0,t=ee(t,u),Pt(te(pr,u),de)?n=ce(n,Lt(u,at)):n=ce(n,dr(u,at)),!1):(c===0&&(s=!0),!0)}),s)return!0;while(r);if(e.cubes.length<=1)return!1;n=te(e.bigint,n);let i=-1,o=0,a=0,l=0,f=wn(n),h=new Set;for(let g of f){let u=e.count(g),c=e.count(g+1),m=u+c;if(u&&c){if(m>=o){let y=Math.min(u,c);(m>o||y>a)&&(i=g,o=m,a=y)}}else{if(m===e.cubes.length)return!1;h.add(g),t=ee(t,Z[u?g:g+1]),n=ce(n,Z[u?g+1:g])}l=Math.max(l,m)}if(i===-1)return!1;if(l*3<e.cubes.length&&f.length-h.size>8){let g=vn(e.cubes,f.filter(u=>!h.has(u)));if(g.length>1){for(let u of g)if(Nr(He.from(u),t,n))return!0;return!1}}return Nr(e,ee(t,Z[i]),ce(n,Z[i+1]))?Nr(e,ee(t,Z[i+1]),ce(n,Z[i])):!1}function mr(e,t=de,n=e.bigint){let r=!1,s=!1;do if(r=!1,e=e.filter(C=>{if(ct(te(t,C.bigint),de))return!1;let x=te(C.bigint,n),P=$t(x,2);return P===1?(r=!0,t=ee(t,x),Pt(te(pr,x),de)?n=ce(n,Lt(x,at)):n=ce(n,dr(x,at)),!1):(P===0&&(s=!0),!0)}),s)return[];while(r);if(!e.cubes.length)return[St.fromBigInt(ot(t))];n=te(e.bigint,n);let i=[];if(e.cubes.length===1){let C=ot(t);for(let x of Jt(n))i.push(St.fromBigInt(ee(C,Z[x^1])));return i}let o=-1,a=0,l=0,f=0,h=wn(n),g=new Set;for(let C of h){let x=e.count(C),P=e.count(C+1),T=x+P;if(x&&P){if(T>=a){let R=Math.min(x,P);(T>a||R>l)&&(o=C,a=T,l=R)}}else T===e.cubes.length&&(g.add(C),i.push(St.fromBigInt(ot(ee(t,Z[x?C:C+1])))),n=ce(n,Z[x?C:C+1]));f=Math.max(f,T)}if(f*3<e.cubes.length&&h.length-g.size>8){let C=vn(e.cubes,h.filter(x=>!g.has(x)));if(C.length>1){let x=He.from(C.pop()),P=mr(x,t,n);for(let T of C){if(!P.length)return i;let R=mr(He.from(T),t,n),L=[];for(let U of P)for(let F of R)L.push(St.fromBigInt(ee(U.bigint,F.bigint)));P=L}return[...i,...P]}}if(o===-1)return as(e,i,t,n),i;let u=mr(e,ee(t,Z[o]),ce(n,Z[o+1])),c=mr(e,ee(t,Z[o+1]),ce(n,Z[o])),m=3<<o,y=ee(Z[o],Z[o+1]),E=new Set;e:for(let[C,x]of u.entries()){let P=x.hash^m;for(let T of c)if(T.hash===P&&Pt(ce(x.bigint,T.bigint),y)){u[C]=St.fromBigInt(te(x.bigint,T.bigint)),E.add(T);continue e}}return E.size&&(c=c.filter(C=>!E.has(C))),[...i,...u,...c]}function as(e,t,n,r){let s=!1,i=!1,o=$r,a=de;do if(o=$r,a=de,s=!1,e=e.filter(u=>{if(ct(te(n,u.bigint),de))return!1;let c=te(u.bigint,r),m=$t(c,o);return m===1?(s=!0,n=ee(n,c),!1):(m<o&&(a=c,o=m),m===0&&(i=!0),!0)}),i)return;while(s);if(!e.cubes.length){t.push(St.fromBigInt(ot(n)));return}let l=Jt(a);if(e.cubes.length===1){let u=ot(n);for(let c of l)t.push(St.fromBigInt(ee(u,Z[c^1])));return}let f=-1,h=0,g=0;for(let u of l){let c=e.count(u);g=Math.max(g,c),c>h&&(f=u,h=c)}as(e,t,ee(n,Z[f]),r),as(e,t,n,ce(r,Z[f]))}function ps(e,t){return Nr(e,ot(t.bigint))}function uo(e,t,n,r,s){let i=ot(e.bigint),o=n.map(h=>new Set(Jt(te(i,h.bigint))));o=o.filter(h=>h.size);let a=t.map(h=>new Set(Jt(te(e.bigint,ce(e.bigint,h.bigint)))));a=a.filter(h=>h.size);let l=new Set([...e.set].sort(s)),f=[];for(let h=Math.max(...l);h>=0;--h)f.push(0);for(let h of a)for(let g of h)++f[g];for(;a.length&&o.length;){let h=new Set;for(let m of o)m.size===1&&h.add(m.values().next().value);if(h.size){for(let y of h)l.delete(y^1),o=o.filter(E=>!E.has(y)),a=a.filter(E=>!E.has(y^1));let m=new Set(l);for(let y of o)for(let E of y)m.delete(E^1);for(let y of m)l.delete(y),e=e.raise(y),a=a.filter(E=>!(E.delete(y)&&!E.size));if(!o.length||!a.length)break}let g=new Set;for(let m of a)m.size===1&&g.add(m.values().next().value);if(g.size){let m=0,y=-1;for(let E of[...g].sort(s))f[E]>m&&r(E,e.set)&&(m=f[E],y=E);if(y>=0){l.delete(y),e=e.raise(y),a=a.filter(E=>!(E.delete(y)&&!E.size));for(let E of o)E.delete(y^1);continue}}let u=0,c=-1;for(let m of l)f[m]>u&&r(m,e.set)&&(u=f[m],c=m);if(c<0){l.clear();break}l.delete(c),e=e.raise(c);for(let m of a)m.delete(c);for(let m of o)m.delete(c^1)}if(o.length){let h=hs(o);for(let g of h)l.delete(g^1)}for(let h of l)r(h,e.set)&&(e=e.raise(h));return e}function co(e,t,n,r,s){let i=t.map(l=>new Set(Jt(te(e.bigint,ce(e.bigint,l.bigint)))));i=i.filter(l=>l.size);let o=[...e.set],a=[];for(let l=Math.max(...o);l>=0;--l)a.push(0);for(let l of i)for(let f of l)++a[f];for(;o.length;){let l=new Set;for(let h of i)h.size===1&&l.add(h.values().next().value);o.sort((h,g)=>+l.has(h)-+l.has(g)||a[h]-a[g]||s(g,h));let f=[];for(;o.length;){let h=o.pop();if(!r(h,e.set)){f.unshift(h);continue}let g=e.raise(h);if(!ps(n,g)){i=i.filter(u=>!u.has(h)),o.push(...f);break}e=g;for(let u of i)u.delete(h);i=i.filter(u=>u.size),o.push(...f.splice(0))}}return e}function oo(e,t,n,r,s,i){if(!e.length)return e;e=e.slice(),e.sort((a,l)=>a.set.size-l.set.size);let o=e[0];do{let a=e[0];r.has(a)||(a=n?uo(a,e,n,s,i):co(a,e,He.from([...e,...t]),s,i)),e=e.filter(l=>!a.covers(l)),e.push(a)}while(e[0].set.size>=o.set.size&&ct(e[0].bigint,o.bigint));return e}function Al(e,t){let n=He.from([...t,...e]),r=[],s=[];for(let i=0;i<e.length;++i){let o=n.pop();ps(n,o)?s.push(o):r.push(o),n.unshift(o)}return[r,s]}function xl(e,t,n){let r=He.from([...n,...t]);return e.filter(s=>!ps(r,s))}function Sl(e){let t=new Map,n=e.length;for(let l=0;l<n;++l)t.set(l,new Set);for(let l=0;l<n;++l){let f=e[l],h=t.get(l);for(let g=l+1;g<n;++g){let u=e[g],c=!1;for(let m of f)if(u.has(m)){c=!0;break}if(!c){let m=t.get(g);h.add(g),m.add(l)}}}let r=Array.from(e.keys());r.sort((l,f)=>t.get(f).size-t.get(l).size);let s=[],i=0,o=0;function a(l,f,h){if(o>n)return;if(!f.length&&!h.length){if(++o,l.length>=s.length){let c=l.reduce((m,y)=>m+t.get(y).size,0);(c>i||l.length>s.length)&&(s=l,i=c,o=0)}return}let g=new Set,u=t.get(f[0]);for(let c of f){if(u.has(c))continue;let m=t.get(c),y=f.filter(C=>m.has(C)&&!g.has(C)),E=h.filter(C=>m.has(C));if(a([...l,c],y,E),s.length>l.length+f.length)return;h.push(c),g.add(c)}}return a([],r,[]),s.map(l=>e[l])}function Pl(e,t){let n=e.map(s=>new Set([...s].filter(i=>t.has(i)))),r=new Set;for(;;){for(let o of n)if(o.size===1){let[a]=o;r.add(a)}if(n=n.filter(o=>{for(let a of o)if(r.has(a))return!1;return o.size>1}),!n.length)break;let s=new Map;for(let o of n){for(let a of o)s.has(a)||s.set(a,new Set);if(o.size===2){let[a,l]=o,f=s.get(a),h=s.get(l);f.add(l),h.add(a)}}let i=Array.from(s).reduce((o,a)=>a[1].size<o[1].size?a:o)[0];for(let o of n)o.delete(i)}return r}function hs(e){let t=new Set,n=Sl(e),r=e;for(let s of n){let i=new Map;for(let l of e)for(let f of l)if(s.has(f)){let h=i.get(f);h||i.set(f,h=new Set),h.add(l)}let[o,a]=Array.from(i).reduce((l,f)=>f[1].size>l[1].size?f:l);r=r.filter(l=>!a.has(l)),t.add(o)}return t=Pl(e,t),r.length&&(t=new Set([...t,...hs(r)])),t}function bn(e,t,n,r){let s=!1,i=!1,o=[];do if(s=!1,e=e.filter(C=>{if(ct(te(n,C.bigint),de))return!1;let x=te(C.bigint,r),P=$t(x,2);if(P===1&&!t.has(C))return s=!0,n=ee(n,x),Pt(te(pr,x),de)?r=ce(r,Lt(x,at)):r=ce(r,dr(x,at)),!1;if(P===0){let T=t.get(C);if(T!=null)return o.push(T),!1;i=!0}return!0}),i)return[];while(s);if(e.cubes.length<=1)return[new Set(o)];r=te(e.bigint,r);let a=-1,l=0,f=0,h=0,g=wn(r),u=new Set;for(let C of g){let x=e.count(C),P=e.count(C+1),T=x+P;if(x&&P){if(T>=l){let R=Math.min(x,P);(T>l||R>f)&&(a=C,l=T,f=R)}}else u.add(C),n=ee(n,Z[x?C:C+1]),r=ce(r,Z[x?C+1:C]);h=Math.max(h,T)}if(a===-1)return[new Set(o)];if(h*3<e.cubes.length&&g.length-u.size>8){let C=vn(e.cubes,g.filter(x=>!u.has(x)));if(C.length>1){let x=[new Set(o)];for(let P of C){let T=x;x=bn(He.from(P),t,n,r);let R=[];for(let L of x)for(let U of T)R.push(new Set([...L,...U]));x=R}return x}}let c=bn(e,t,ee(n,Z[a]),ce(r,Z[a+1])),m=bn(e,t,ee(n,Z[a+1]),ce(r,Z[a])),y=new Set,E=new Set;for(let C of c)for(let x of m)if(C.size<=x.size){let P=!0;for(let T of C)if(!x.has(T)){P=!1;break}P&&E.delete(x)}else{let P=!0;for(let T of x)if(!C.has(T)){P=!1;break}P&&y.delete(C)}return y.size&&(c=c.filter(C=>!y.has(C))),E.size&&(m=m.filter(C=>!E.has(C))),[...c,...m].map(C=>new Set([...o,...C]))}function kl(e,t,n){let r=new Map,s=new WeakMap;for(let[o,a]of e.entries())s.set(a,o);let i=He.from([...e,...t,...n]);for(let o of e){let a=ot(o.bigint),l=te(i.bigint,hr(ee(o.bigint,a))),f=bn(i,s,a,l);for(let h of f){let g=0;for(let m of h)g^=1<<m;let u=r.get(g);if(!u){r.set(g,[h]);continue}let c=!1;e:for(let m of u)if(m.size===h.size){for(let y of m)if(!h.has(y))continue e;c=!0;break}c||u.push(h)}}return[...r.values()].flat()}function Il(e,t,n){let r=kl(e,t,n),s=hs(r);return e.filter((i,o)=>s.has(o))}function ls(e,t){let[n,r]=Al(e,t),s=xl(r,n,t),i=Il(s,n,t);return[...n,...i]}function Tl(e,t){let n=[...t,...e],r=[];for(let s=0;s<e.length;++s){let i=n.pop(),o=ot(i.bigint),a=[];for(let l of n){let f=te(o,l.bigint),h=$t(f,2);h===0?a.push(l):h===1&&a.push(St.fromBigInt(ce(l.bigint,f)))}Nr(He.from(a),o)||r.push(i),n.unshift(i)}return r}function Ml(e){if(e.length<=1)return;let t=e.reduce((n,r)=>r.set.size<=n.set.size?r:n);e.sort((n,r)=>{let s=$t(te(n.bigint,t.bigint)),i=n.set.size-s+(t.set.size-s),o=$t(te(r.bigint,t.bigint)),a=r.set.size-o+(t.set.size-o);return i-a})}function Rr(e,t,n){let r=!1,s=!1;do if(r=!1,e=e.filter(u=>{if(ct(te(t,u.bigint),de))return!1;let c=te(u.bigint,n),m=$t(c,2);return m===1?(r=!0,t=ee(t,c),Pt(te(pr,c),de)?n=ce(n,Lt(c,at)):n=ce(n,dr(c,at)),!1):(m===0&&(s=!0),!0)}),s)return Cl;while(r);if(e.cubes.length<=1)return t;n=te(e.bigint,n);let i=-1,o=0,a=0,l=0,f=wn(n);for(let u of f){let c=e.count(u),m=e.count(u+1),y=c+m;if(c&&m&&y>=o){let E=Math.min(c,m);(y>o||E>a)&&(i=u,o=y,a=E)}l=Math.max(l,y)}if(i===-1)return t;if(l*3<e.cubes.length&&f.length>8){let u=vn(e.cubes,f);if(u.length>1){for(let c of u)t=ee(t,Rr(He.from(c),t,n));return t}}let h=Rr(e,ee(t,Z[i]),ce(n,Z[i+1])),g=Rr(e,ee(t,Z[i+1]),ce(n,Z[i]));return te(h,g)}function Ol(e,t,n,r){e=e.slice(),Ml(e);for(let s=e.length;s>0;--s){let i=e.shift(),o=ot(i.bigint),a=ee(i.bigint,o),l=[...e,...t].filter(h=>Pt(te(o,h.bigint),de)),f=Rr(He.from(l),o,hr(a));if(lo(f,de))if(Pt(f,o))e.push(i),n.add(i);else{let h=i;for(let g=Jt(f);g.length;){let u=[];for(let c of g)r(c^1,h.set)?h=h.lower(c^1):u.push(c);if(u.length===g.length)break;g=u}e.push(h)}}return e}function Dl(e,t,n){let r=[];for(let s=e.length;s>0;--s){let i=e.shift(),o=ot(i.bigint),a=ee(i.bigint,o),l=[...e,...t].filter(h=>Pt(te(o,h.bigint),de)),f=Rr(He.from(l),o,hr(a));if(ct(f,o)&&lo(f,de)){let h=i;for(let g=Jt(f);g.length;){let u=[];for(let c of g)n(c^1,h.set)?h=h.lower(c^1):u.push(c);if(u.length===g.length)break;g=u}r.push(h)}e.push(i)}return r}function Nl(e,t,n,r,s,i){let o=Dl(e,t,s),a=[],l=n?null:He.from([...e,...t]);for(let f=o.length;f>0;--f){let h=o.shift(),g=n?uo(h,o,n,r,i):co(h,o,l,r,i);for(let u of o)g.covers(u)&&a.push(g);o.push(h)}return a.length?ls([...e,...a],t):e}function ao(e){return e.reduce((t,n)=>t+n.set.size,0)}function Rl(e,t,n,r=()=>!0,s=()=>!0,i=()=>0){if(!e.length)return e;let o=new WeakSet;e=oo(e,t,n,o,r,i),e=ls(e,t);let a=Tl(e,t);a.length&&(e=e.filter(f=>!a.includes(f)),t=[...t,...a]);let l=e.length*$r;for(;;){let f=Ol(e,t,o,s);f=oo(f,t,n,o,r,i),f=ls(f,t);let h=ao(f);if(h<=l&&(e=f),h>=l&&(f=Nl(e,t,n,r,s,i),h=ao(f),h<=l&&(e=f),h>=l))break;l=h}return[...a,...e]}function us(e){return e.map(t=>St.from(t))}function fo(e){return e.map(t=>[...t.set])}function ie(e){let t=He.from(us(e)),n=mr(t);return fo(n)}function mo(e,t=[],n={}){let r=us(e).filter(a=>!a.empty),s=us(t).filter(a=>!a.empty),i=n.computeOffSet?mr(He.from([...r,...s])):void 0,o=Rl(r,s,i,n.canRaise,n.canLower,n.bias);return fo(o)}function ds(e,t){return e+t}function kt(e,t){return e*t}function Lr(e,t){return e/t}function po(e,t){return e**t}function ho(e,t){return e%t}function gs(e){return Number(e)}function bs(e,t){return e!==t}function ys(e,t){return e<t}var ft=BigInt;var _r=ft(0),ws=ft(1),$l=ft(2),bo=ft(-1),_t=class e{constructor(t){this.map=new Map,t?(this.map.set(t,1),this.sortedKeys=[t]):this.sortedKeys=[]}reciprocal(){let t=new e;t.sortedKeys=this.sortedKeys,t.map=new Map;for(let[n,r]of this.map)t.map.set(n,0-r);return t}static multiply(t,n){let r=new e;r.sortedKeys=t.sortedKeys.slice(),r.map=new Map(t.map);for(let[s,i]of n.map){let o=r.map.get(s);if(!o)r.map.set(s,i),r.sortedKeys.push(s);else{let a=i+o;a?r.map.set(s,a):(r.map.delete(s),r.sortedKeys=r.sortedKeys.filter(l=>l!==s))}}return r.sortedKeys.sort((s,i)=>s.length!==i.length?i.length-s.length:s>i?1:s<i?-1:0),r}static compare(t,n){if(t.sortedKeys.length!==n.sortedKeys.length)return n.sortedKeys.length-t.sortedKeys.length;for(let r=0;r<t.sortedKeys.length;++r){let s=t.sortedKeys[r],i=t.map.get(s),o=n.sortedKeys[r],a=n.map.get(o);if(i!==a)return a-i;if(s.length>o.length)return-1;if(s.length<o.length)return 1;if(s>o)return 1;if(s<o)return-1}return 0}};function yo(e,t){for(;bs(t,_r);){let n=t;t=ho(e,t),e=n}return e}var Se=class e{constructor(t){this.terms=t}static simplifyTerms(t){let n=t.slice().sort((r,s)=>_t.compare(r.indeterminates,s.indeterminates));for(let r=1;r<n.length;++r){let s=n[r-1],i=n[r];if(_t.compare(s.indeterminates,i.indeterminates)===0){let o=ds(kt(s.coefficientNumerator,i.coefficientDenominator),kt(i.coefficientNumerator,s.coefficientDenominator)),a=kt(s.coefficientDenominator,i.coefficientDenominator),l=yo(o,a);n[r]={indeterminates:i.indeterminates,coefficientNumerator:Lr(o,l),coefficientDenominator:Lr(a,l)},n[r-1]={indeterminates:s.indeterminates,coefficientNumerator:_r,coefficientDenominator:s.coefficientDenominator}}}return n.filter(r=>bs(r.coefficientNumerator,_r))}static fromIndeterminate(t){let r=[{indeterminates:new _t(JSON.stringify(t)),coefficientNumerator:ws,coefficientDenominator:ws}];return new e(r)}static fromConstant(t){let[n,r]=Math.abs(t).toString(2).split(".",2),s=ft("0b"+n);t<0&&(s=kt(s,bo));let i=ws;r&&(i=po($l,ft(r.length)),s=ds(kt(s,i),ft("0b"+r)));let o=[{indeterminates:new _t,coefficientNumerator:s,coefficientDenominator:i}];return new e(o)}negation(){let t=this.terms.map(n=>({indeterminates:n.indeterminates,coefficientNumerator:kt(n.coefficientNumerator,bo),coefficientDenominator:n.coefficientDenominator}));return new e(t)}reciprocal(){let t=this.terms.map(n=>({indeterminates:n.indeterminates.reciprocal(),coefficientNumerator:n.coefficientDenominator,coefficientDenominator:n.coefficientNumerator}));return new e(t)}constant(){let t=this.terms.filter(n=>!n.indeterminates.sortedKeys.length);return new e(t)}add(t){return new e(e.simplifyTerms(this.terms.concat(t.terms)))}subtract(t){return this.add(t.negation())}multiply(t){let n=[];for(let r of this.terms)for(let s of t.terms){let i=kt(r.coefficientNumerator,s.coefficientNumerator),o=kt(r.coefficientDenominator,s.coefficientDenominator),a=yo(i,o);n.push({indeterminates:_t.multiply(r.indeterminates,s.indeterminates),coefficientNumerator:Lr(i,a),coefficientDenominator:Lr(o,a)})}return new e(e.simplifyTerms(n))}divide(t){return this.multiply(t.reciprocal())}toString(){let t=[];for(let n of this.terms){let r=gs(n.coefficientNumerator)/gs(n.coefficientDenominator),s=[];if(n.indeterminates.sortedKeys.length){for(let i of n.indeterminates.sortedKeys){let o=n.indeterminates.map.get(i);for(let a=Math.abs(o);a>0;--a)o>0?s.push(i):s.push(`["/",1,${i}]`)}r!==1&&s.push(r.toString()),s.length>1?t.push(`["*",${s.join(",")}]`):t.push(s[0])}else t.push(r.toString())}return t.length?t.length===1?t[0]:`["+",${t.join(",")}]`:"0"}},Ll=Se.fromConstant(0),_l=Se.fromConstant(1),zl={"=":"=","<>":"<>",">":"<",">=":"<=","<":">","<=":">="};function Cn(e){if(!Array.isArray(e))return e;let t=e[0];if(t==="FUNC"&&e[1]==="COALESCE"){let s=["CASE"];for(let i=2;i<e.length;++i)s.push(Cn(["IS NOT NULL",e[i]]),e[i]);return Cn(s)}if(t==="CASE"){let s=[];for(let i=1;i<e.length;i+=2){let o=e[i];if(o instanceof Se&&(o=JSON.parse(o.toString())),!Array.isArray(o)&&!o)continue;let a=e[i+1];if(!Array.isArray(a)||a[0]!=="CASE"){s.push([o,a]);continue}for(let l=1;l<a.length;l+=2)s.push([it(o,a[l]),a[l+1]]);if(s.push([o,null]),!Array.isArray(o)&&o)break}for(;s[s.length-1][1]==null;)s.pop();return["CASE",...s.flat()]}let n=new Map;for(let[s,i]of e.entries()){if(!Array.isArray(i)||i[0]!=="CASE")continue;let o=[];for(let a=1;a<i.length;a+=2)o.push([i[a],i[a+1]]);o.push([!0,null]),n.set(s,o)}if(n.size){let s=[[!0,e]];for(let[i,o]of n){let a=[];for(let[l,f]of o)if(a.push(...s.map(h=>{let g=h[1].slice();return g[i]=f,[it(l,h[0]),g]})),!Array.isArray(l)&&l)break;s=a}for(let i of s)i[1]=Cn(i[1]);if(s[0][0]===!0)return s[0][1];for(;s[s.length-1][1]==null;)s.pop();return["CASE",...s.flat()]}function r(s){return s==null?null:s instanceof Se?s:typeof s=="number"?Se.fromConstant(s):typeof s=="string"?Se.fromConstant(parseFloat(s)||0):typeof s=="boolean"?Se.fromConstant(+s):Se.fromIndeterminate(s)}if(t==="+"){let s=[];for(let i=1;i<e.length;++i){let o=r(e[i]);if(o==null)return null;s.push(o)}return s.reduce((i,o)=>i.add(o),Ll)}else if(t==="*"){let s=[];for(let i=1;i<e.length;++i){let o=r(e[i]);if(o==null)return null;s.push(o)}return s.reduce((i,o)=>i.multiply(o),_l)}else if(t==="-"){let s=[];for(let i=1;i<e.length;++i){let o=r(e[i]);if(o==null)return null;s.push(o)}return s.reduce((i,o)=>i.subtract(o))}else if(t==="/"){let s=[];for(let i=1;i<e.length;++i){let o=r(e[i]);if(o==null)return null;s.push(o)}return s.reduce((i,o)=>i.divide(o))}else if(["=","<>",">",">=","<","<="].includes(t)){if(e[1]==null||e[2]==null)return null;let s,i;if(e[1]instanceof Se?s=e[1]:typeof e[1]=="number"&&(s=Se.fromConstant(e[1])),e[2]instanceof Se?i=e[2]:typeof e[2]=="number"&&(i=Se.fromConstant(e[2])),s||i)if(s||(s=Se.fromIndeterminate(e[1])),i||(i=Se.fromIndeterminate(e[2])),s=s.subtract(i),i=s.constant().negation(),s=s.add(i),s.terms.length){let o=1,a=s.terms[0].coefficientNumerator,l=s.terms[0].coefficientDenominator;(ys(a,_r)||ys(l,_r))&&(o*=-1);let f=new Se([{indeterminates:new _t,coefficientNumerator:l,coefficientDenominator:a}]);s=s.multiply(f),i=i.multiply(f);let h=s.terms[0].indeterminates.sortedKeys,g=s.terms[0].indeterminates.map.get(h[0])<0?-1:0;for(let u of s.terms)for(let c of u.indeterminates.map.values())g+=c;g<0&&(o*=-1,s=s.reciprocal(),i=i.reciprocal()),o<0?e=[zl[t],s,i]:e=[t,s,i]}else{if(e=[t,JSON.parse(s.toString()),JSON.parse(i.toString())],t==="=")return e[1]===e[2];if(t==="<>")return e[1]!==e[2];if(t===">")return e[1]>e[2];if(t===">=")return e[1]>=e[2];if(t==="<")return e[1]<e[2];if(t==="<=")return e[1]<=e[2]}}return e=e.map(s=>s instanceof Se?JSON.parse(s.toString()):s),e=ns(e),e}function It(e){return e=ne(e,Cn),e instanceof Se?e=JSON.parse(e.toString()):Array.isArray(e)&&e[0]==="CASE"&&(e=e.map(t=>t instanceof Se?JSON.parse(t.toString()):t)),e}var zr=class{variables=new Map;clauses=new Map;getVar(t){let n=t.toString(),r=this.variables.get(n);return r==null&&(r=this.variables.size,this.variables.set(n,r),this.clauses.set(r,t)),r}getClause(t){return this.clauses.get(t)}canRaise(t,n){return!0}canLower(t,n){return!0}bias(t,n){return(n^1)-(t^1)}sanitizeMinterms(t){return t}minimize(t,n=[]){t=this.sanitizeMinterms(t);let r=this.canRaise.bind(this),s=this.canLower.bind(this),i=this.bias.bind(this);return mo(t,[...this.getDcSet([...t,...n]),...n],{canRaise:r,canLower:s,bias:i})}};function*En(e){if(!Array.isArray(e))return;let t=e[0];if(!(t==="IS NULL"||t==="IS NOT NULL")){if(t==="FUNC"){if(e[1]==="NOW")return;if(e[1]==="LOWER"||e[1]==="UPPER")yield*En(e[2]);else if(e[1]==="ROUND"){for(let n of e.slice(2,4))yield*En(n);return}}else if(t!=="PARAM"){for(let n of e.slice(1))yield*En(n);return}yield e}}var oe=class e{_isNullable;_expression;expression(){if(this._expression!==void 0)return this._expression;let t=vo(),n=this.true(t),r=t.minimize(n);return this._expression=t.toExpression(r),this._expression}isBoolean(){return!0}isNullable(t){return this._isNullable||(this._isNullable=new Set([...this.getNullables()].map(n=>n.toString()))),this._isNullable.has(t.toString())}*getNullables(){let t=this.expression();for(let n of En(t))n===t?yield new e.IsNull(this):yield new e.IsNull(new e.Exp(n))}toString(){return JSON.stringify(this.expression())}};(f=>{class e extends f{constructor(u){super();this.operand=u}true(u){return this.operand.false(u)}false(u){return this.operand.true(u)}null(u){return this.operand.null(u)}}f.Not=e;class t extends f{constructor(u){super();this.operands=u}true(u){let c=[];for(let m of this.operands){let y=m.true(u);if(y.length===1&&!y[0].length)return[[]];c.push(...y)}return c}false(u){let c=[],m=[...this.operands];for(let y of m){if(y instanceof t){m.push(...y.operands);continue}let E=y.false(u);if(!E.length)return[];c.push(E)}return c.length?c.length===1?c[0]:ie(c.map(y=>ie(y)).flat()):[[]]}null(u){let c=[],m=[...this.operands];for(let E of m){if(E instanceof t){m.push(...E.operands);continue}let C=E.true(u);if(C.length===1&&!C[0].length)return[];c.push(...C)}let y=[];for(let E of m){let C=E.null(u);if(C.length===1&&!C[0].length&&!c.length)return[[]];y.push(...C)}return c.length?ie([...ie(y),...c]):y}}f.Or=t;class n extends f{constructor(u){super();this.operands=u}true(u){let c=[],m=[...this.operands];for(let y of m){if(y instanceof n){m.push(...y.operands);continue}let E=y.true(u);if(!E.length)return[];E.length===1&&!E[0].length||c.push(E)}return c.length?c.length===1?c[0]:ie(c.map(y=>ie(y)).flat()):[[]]}false(u){let c=[];for(let m of this.operands){let y=m.false(u);if(y.length===1&&!y[0].length)return[[]];c.push(...y)}return c}null(u){let c=[],m=[...this.operands];for(let E of m){if(E instanceof n){m.push(...E.operands);continue}let C=E.false(u);if(C.length===1&&!C[0].length)return[];c.push(...C)}let y=[];for(let E of m){let C=E.null(u);if(C.length===1&&!C[0].length&&!c.length)return[[]];y.push(...C)}return c.length?ie([...ie(y),...c]):y}}f.And=n;class r extends f{constructor(u){super();this.clauses=u}true(u){let c=[],m=[];for(let y=0;y<this.clauses.length;y+=2){let E=this.clauses[y].true(u),C=this.clauses[y+1].true(u);c.push(...ie([...m,...ie(E),...ie(C)])),y<this.clauses.length-2&&m.push(...ie([...this.clauses[y].false(u),...this.clauses[y].null(u)]))}return c}false(u){let c=[],m=[];for(let y=0;y<this.clauses.length;y+=2){let E=this.clauses[y].true(u),C=this.clauses[y+1].false(u);c.push(...ie([...m,...ie(E),...ie(C)])),y<this.clauses.length-2&&m.push(...ie([...this.clauses[y].false(u),...this.clauses[y].null(u)]))}return c}null(u){let c=[],m=[];for(let y=0;y<this.clauses.length;y+=2){let E=this.clauses[y].true(u),C=this.clauses[y+1].null(u);c.push(...ie([...m,...ie(E),...ie(C)])),m.push(...ie([...this.clauses[y].false(u),...this.clauses[y].null(u)]))}return c.push(...ie([...m])),c}expression(){if(this._expression!=null)return this._expression;if(this.isBoolean())return this._expression=new f.Not(new f.Not(this)).expression(),this._expression;let u=vo(),c=[];for(let m=0;m<this.clauses.length;m+=2){let y=this.clauses[m].true(u),E=this.clauses[m+1].expression();if(c.length&&JSON.stringify(E)===JSON.stringify(c[c.length-1].then)&&y.push(...c.pop().when),y=u.minimize(y,c.flatMap(C=>C.when)),!!y.length&&(c.push({when:y,then:E}),y.length===1&&!y[0].length))break}for(;c[c.length-1].then==null;)c.pop();return c.length?(this._expression=["CASE",...c.flatMap(m=>[u.toExpression(m.when),m.then])],this._expression):null}isBoolean(){for(let u=1;u<this.clauses.length;u+=2)if(!this.clauses[u].isBoolean())return!1;return!0}}f.Case=r;class s extends f{constructor(u){super();this.operand=u;this._boolean=new e(new e(this))}_boolean;true(u){return this.operand.null(u)}false(u){return ie(this.true(u))}null(){return[]}isBoolean(){return!0}*getNullables(){}expression(){let u=[...this.operand.getNullables()];return u.length===1&&u[0].operand===this.operand?["IS NULL",this.operand.expression()]:super.expression()}}f.IsNull=s;class i extends f{constructor(u){super();this.exp=u}true(u){return Array.isArray(this.exp)?u.getMinterms(this,!0):this.exp?[[]]:[]}false(u){return Array.isArray(this.exp)?u.getMinterms(this,!1):!this.exp&&this.exp!=null?[[]]:[]}null(u){return Array.isArray(this.exp)?u.getMinterms(this,null):this.exp==null?[[]]:[]}expression(){return this.exp}isBoolean(){return this.exp===!0||this.exp===!1||this.exp==null}}f.Exp=i;class o extends f{constructor(u,c,m){super();this.lhs=u;this.op=c;this.rhs=m}true(u){return u.getMinterms(this,!0)}false(u){return u.getMinterms(this,!1)}null(u){return this.lhs.null(u)}*getNullables(){yield*this.lhs.getNullables()}isBoolean(){return!0}expression(){return[this.op,this.lhs.expression(),this.rhs]}}f.Compare=o;class a extends f{constructor(u,c,m){super();this.rhs=c;this.esc=m;let y=u.expression(),E=!0,C=!1;if(Array.isArray(y)&&y[0]==="FUNC"){let x=y[1];(x==="UPPER"||x==="LOWER")&&((x==="UPPER"?c.toUpperCase():c.toLowerCase())===c?E=!1:C=!0,u=new i(y[2]))}this.lhs=u,this.pattern=lr(c,m),this.caseSensitive=E,this.contradiction=C}caseSensitive;contradiction;pattern;lhs;true(u){return u.getMinterms(this,!0)}false(u){return u.getMinterms(this,!1)}null(u){return this.lhs.null(u)}isBoolean(){return!0}isNullable(u){return this.lhs.isNullable(u)}getNullables(){return this.lhs.getNullables()}expression(){let u=this.lhs.expression();return this.contradiction?this.rhs===this.rhs.toLocaleUpperCase()?u=["FUNC","LOWER",u]:u=["FUNC","UPPER",u]:this.caseSensitive||(this.rhs===this.rhs.toLocaleUpperCase()?u=["FUNC","UPPER",u]:u=["FUNC","LOWER",u]),["LIKE",u,this.rhs,...this.esc?[this.esc]:[]]}}f.Like=a;function l(h){return ne(h,u=>{if(!Array.isArray(u))return new f.Exp(u);let c=u[0],m=!0;c==="NOT LIKE"?c="LIKE":c==="IS NOT NULL"?c="IS NULL":c==="<>"?c="=":c===">="?c="<":c==="<="?c=">":m=!1;let y;if(c==="IS NULL")y=new f.IsNull(u[1]);else if(c==="NOT")y=new f.Not(u[1]);else if(c==="OR")y=new f.Or(u.slice(1));else if(c==="AND")y=new f.And(u.slice(1));else if(c==="CASE")y=new f.Case(u.slice(1));else if(c==="LIKE"){let E=u[2]instanceof i?u[2].expression():null,C=u[3]instanceof i?u[3].expression():null;typeof E=="string"&&typeof C=="string"?y=new f.Like(u[1],E,C):typeof E=="string"&&C==null&&(y=new f.Like(u[1],E))}else if(c===">"||c==="<"||c==="="){let E=u[2]instanceof i?u[2].expression():null;["boolean","number","string"].includes(typeof E)&&(y=new f.Compare(u[1],c,E))}if(!y){let E=u.slice(1).map(C=>C.expression());y=new f.Exp([c,...E])}return m&&(y=new f.Not(y)),y})}f.fromExpression=l})(oe||={});function wo(e,t){let n=new Map;for(let r of e){let s=t(r),i=n.get(s);i||n.set(s,i=[]),i.push(r)}return n.entries()}var gr=class extends zr{constructor(){super()}getMinterms(t,n){let r=this.getVar(t);return n===!0?[[r<<2^3]]:n===!1?[[r<<2^1]]:[[r<<2,r<<2^2]]}getDcSet(t){let n=[],r=new Set([...t.flat()].map(a=>a>>2)),s=[...r].map(a=>this.getClause(a)),i=s.filter(a=>a instanceof oe.Compare);for(let[,a]of wo(i,l=>JSON.stringify(l.lhs))){let l=a[0].lhs,h=[...new Set(a.map(g=>g.rhs))].sort((g,u)=>{let c=typeof g,m=typeof u;return c===m?g>u?1:-1:c==="string"?1:m==="string"?-1:+g-+u});for(let[g,u]of h.entries()){let c=this.getVar(new oe.Compare(l,"=",u)),m=this.getVar(new oe.Compare(l,">",u)),y=this.getVar(new oe.Compare(l,"<",u));n.push([c<<2^3,m<<2^3]),n.push([y<<2^3,m<<2^3]),n.push([y<<2^3,c<<2^3]),n.push([y<<2^1,c<<2^1,m<<2^1]);let E=[y,c,m].filter(C=>!r.has(C));E.length===1&&r.add(E[0]);for(let C=0;C<g;C++){let x=this.getVar(new oe.Compare(l,"=",h[C])),P=this.getVar(new oe.Compare(l,">",h[C])),T=this.getVar(new oe.Compare(l,"<",h[C]));n.push([P<<2^1,y<<2^1]),n.push([x<<2^3,y<<2^1]),n.push([T<<2^3,y<<2^1]),n.push([P<<2^1,m<<2^3]),n.push([P<<2^1,c<<2^3]),n.push([x<<2^3,m<<2^3]),n.push([x<<2^3,c<<2^3]),n.push([T<<2^3,m<<2^3]),n.push([T<<2^3,c<<2^3])}}}let o=s.filter(a=>a instanceof oe.Like);for(let[,a]of wo(o,l=>JSON.stringify(l.lhs)))for(let l=0;l<a.length;++l){let f=a[l];if(f.contradiction){n.push([this.getVar(f)<<2^3]);continue}for(let h=l+1;h<a.length;++h){let g=a[h];if(g.contradiction)continue;let u=f.pattern,c=g.pattern;(!f.caseSensitive||!g.caseSensitive)&&(u=u.map(m=>m.toLowerCase()),c=c.map(m=>m.toLowerCase())),vs(u,c)?n.push([this.getVar(f)<<2^3,this.getVar(g)<<2^3]):(!f.caseSensitive||g.caseSensitive)&&jr(u,c)?(n.push([this.getVar(f)<<2^2,this.getVar(g)<<2^3]),n.push([this.getVar(f)<<2^1,this.getVar(g)<<2^0])):(!g.caseSensitive||f.caseSensitive)&&jr(c,u)&&(n.push([this.getVar(f)<<2^3,this.getVar(g)<<2^2]),n.push([this.getVar(f)<<2^0,this.getVar(g)<<2^1]))}}for(let a of r){let l=this.getClause(a),f=[...l.getNullables()].map(h=>this.getVar(h));if(f.length){n.push([...f.map(h=>h<<2^2),a<<2^0,a<<2^2]);for(let h of f)n.push([h<<2^3,a<<2^1]),n.push([h<<2^3,a<<2^3]),r.add(h)}if(l instanceof oe.IsNull){let h=l.operand.toString();(h==='["PARAM","DeviceID.ID"]'||h==='["PARAM","_id"]')&&n.push([a<<2^3])}}return n.filter(a=>a.every(l=>r.has(l>>2)))}canRaise(t,n){let r=this.getClause(t>>2);if(r instanceof oe.IsNull){for(let s of n){if(s===t||s&1)continue;if(this.getClause(s>>2).isNullable(r))return!1}return!0}return!(t&1)||!n.has(t^3)}canLower(t,n){return t&1||this.getClause(t>>2)instanceof oe.IsNull?!0:n.has(t^3)||n.has(t^1)}bias(t,n){return(n&3^3)-(t&3^3)}sanitizeMinterms(t){let n=[];e:for(let r of t){let s=new Map;for(let l of r)s.set(l>>2,(s.get(l>>2)||0)|1<<(l&3));let i=[],o=[];for(let[l,f]of s){if((f&3)===3||(f&12)===12)continue e;let h=this.clauses.get(l);if(!h)throw new Error("Invalid literal");if(h instanceof oe.IsNull){if(f===4)i.push(l<<2^2);else if(f===8)i.push(l<<2^3);else throw new Error("Invalid literal");continue}if((f&10)===10)continue e;let g=[...h.getNullables()].map(c=>this.getVar(c)),u=l<<2;f===5?g.length===1?i.push(g[0]<<2^3):o.push(g.map(c=>c<<2^3)):f===1?o.push([...g.map(c=>c<<2^3),u^3]):f===4?o.push([...g.map(c=>c<<2^3),u^1]):f&8?i.push(u^3):f&2&&i.push(u^1)}let a=[i];for(;o.length;){let l=[],f=o.pop();for(let h of f)l.push(...a.map(g=>[...g,h]));a=l}n.push(...a)}return n}toExpression(t){if(!t.length)return!1;let n=[];for(let r of t){if(!r.length)return!0;let s=[];for(let i of r){let o=this.getClause(i>>>2);if(!o)throw new Error("Invalid literal");if(o instanceof oe.IsNull){if(!(i&2))throw new Error("Invalid literal")}else if(!(i&1)){let l=[...o.getNullables()].map(f=>this.getVar(f));s.push(this.toExpression([[i^3],...l.map(f=>[f<<2^3])]));continue}let a=o.expression();if(!(i&1)!=!(i&2)&&(a=["NOT",a]),Array.isArray(a)&&a[0]==="NOT"&&Array.isArray(a[1])){let l=a[1];l[0]==="IS NULL"?a=["IS NOT NULL",...l.slice(1)]:l[0]==="LIKE"?a=["NOT LIKE",...l.slice(1)]:l[0]==="="?a=["<>",...l.slice(1)]:l[0]==="<>"?a=["=",...l.slice(1)]:l[0]===">"?a=["<=",...l.slice(1)]:l[0]===">="?a=["<",...l.slice(1)]:l[0]==="<"?a=[">=",...l.slice(1)]:l[0]==="<="?a=[">",...l.slice(1)]:l[0]==="NOT"&&(a=l[1])}s.push(a)}s.length>1?n.push(["AND",...s]):n.push(s[0])}return n.length>1?["OR",...n]:n[0]}};function vo(){return new gr}function jr(e,t){let n=null;for(let r=0,s=0;;++r,++s){for(;r<e.length&&e[r]==="\\%";)n=[r++,s];if(s>=t.length)return r>=e.length;let i=r<e.length?e[r]:null;if(i!==t[s]&&i!=="\\_"){if(!n)return!1;[r,s]=n,++n[1]}}}function vs(e,t){let n=e.indexOf("\\%"),r=t.indexOf("\\%"),s=e.lastIndexOf("\\%"),i=t.lastIndexOf("\\%"),o=e.slice(0,n!==-1?n:e.length),a=t.slice(0,r!==-1?r:t.length),l=e.slice(s!==-1?s+1:0).reverse(),f=t.slice(i!==-1?i+1:0).reverse();for(let h=0;h<Math.min(o.length,a.length);++h)if(o[h]!==a[h]&&o[h]!=="\\_"&&a[h]!=="\\_")return!0;for(let h=0;h<Math.min(l.length,f.length);++h)if(l[h]!==f[h]&&l[h]!=="\\_"&&f[h]!=="\\_")return!0;return e.length===o.length?t.filter(h=>h!=="\\%").length>e.length:t.length===a.length?e.filter(h=>h!=="\\%").length>t.length:!1}function Co(e,t){if(t=It(t),!t)return[e,!1];let n=oe.fromExpression(t);if(!e){let f=n.expression();return[f,f]}e=It(e);let r=oe.fromExpression(e),s=new gr,i=n.true(s),o=r.true(s),a=s.minimize([...o,...i]),l=s.minimize(ie([...o,...ie(i)]));return[s.toExpression(a),s.toExpression(l)]}function Eo(e,t){let n={};for(let r of Object.keys(e)){let s=t[r];s!=null&&typeof s=="object"&&(s=s.value?.[0]),n[r]=s}return n}function An(e,t){return Object.entries(t).reverse().reduce((n,r)=>{let[s,i]=r;if(i<0){if(e[s]==null)return gt(["IS NOT NULL",["PARAM",s]],it(["IS NULL",["PARAM",s]],n));let o=null;return o=gt(o,[">",["PARAM",s],e[s]]),gt(o,it(["=",["PARAM",s],e[s]],n))}else{let o=["IS NULL",["PARAM",s]];return e[s]==null?it(o,n):(o=gt(o,["<",["PARAM",s],e[s]]),gt(o,it(["=",["PARAM",s],e[s]],n)))}},!0)}function Ao(e,t,n){if(!n.length)return[[]];let[r,s]=n[0],i=[],o=[];if(s>0){let l=new oe.Exp(["PARAM",r]),f=e.getVar(new oe.IsNull(l));i.push(f<<2^2)}for(let l of t){let f=e.getClause(l>>>2);if(f instanceof oe.IsNull){let h=f.operand.expression();if(!Array.isArray(h)||h[0]!=="PARAM"||h[1]!==r)continue;o.push(l),s<0&&l&1&&i.push(l,l^1)}else if(f instanceof oe.Compare){let h=f.lhs.expression();if(!Array.isArray(h)||h[0]!=="PARAM"||h[1]!==r||!(l&1)&&s>0)continue;o.push(l);let g=(l^l>>1)&1;if(s>0){if(f.op==="="&&!g||f.op===">"&&!g||f.op==="<"&&g){let u=new oe.Compare(f.lhs,">",f.rhs),c=e.getVar(u);i.push(c<<2^3)}}else if(s<0&&(f.op==="="&&!g||f.op===">"&&g||f.op==="<"&&!g)){let u=new oe.Compare(f.lhs,"<",f.rhs),c=e.getVar(u);i.push(c<<2^0)}}}let a=Ao(e,t,n.slice(1));return[i,...a.map(l=>[...o,...l])]}function xo(e,t,n){if(e=It(e),!e)return[!1,t];if(t=It(t),!t)return[!1,t];let r=oe.fromExpression(e),s=oe.fromExpression(t),i=new gr,o=r.true(i),a=ie(s.true(i)),f=i.sanitizeMinterms(ie([...o,...a,...i.getDcSet([...o,...a])])).flatMap(u=>Ao(i,u,Object.entries(n))),h=i.minimize(ie([...f,...a])),g=i.minimize(ie([...h,...a]));return[i.toExpression(h),i.toExpression(g)]}var br=V(J),Sn=V(dt),Be=0,Ur,qr,Br,yt=0,Q={filter:new WeakMap,bookmark:new WeakMap,limit:new WeakMap,sort:new WeakMap,fulfilled:new WeakMap,fulfilling:new WeakSet,accessed:new WeakMap,value:new WeakMap,unsatisfied:new WeakMap},ze={};for(let e of["devices","faults","presets","provisions","virtualParameters","files","config","users","permissions"])ze[e]={objects:new Map,count:new Map,fetch:new Map,combinedFilter:null};var Pn=class{get fulfilled(){return Q.accessed.set(this,Date.now()),Q.fulfilled.get(this)||0}get fulfilling(){return Q.accessed.set(this,Date.now()),!(Q.fulfilled.get(this)>=Be)}get value(){return Q.accessed.set(this,Date.now()),Q.value.get(this)}};function jl(){let e=Date.now();bt.default.request({url:"status",method:"GET",background:!0,extract:t=>{let n=Date.now();if(t.status!==200)Ur||(Ur=I("warning","Server is unreachable",{}));else{Ur&&(Dr(Ur),Ur=null);try{let i=Math.trunc((e+n)/2),o=Date.parse(t.getResponseHeader("Date"))-i;Math.abs(o-yt)>5e3&&n-e<1e3&&(yt=o,console.warn(`System and server clocks are out of sync. Adding ${yt}ms offset to any client-side time relative calculations.`),j(n),bt.default.redraw())}catch{}let r=t.getResponseHeader("x-config-snapshot")!==so,s=t.getResponseHeader("genieacs-version")!==io;!qr!=!r&&(qr?(Dr(qr),qr=null):qr=I("warning","Configuration has been modified, please reload the page",{Reload:()=>{window.location.reload()}})),!Br!=!s&&(Br?(Dr(Br),Br=null):Br=I("warning","Server has been updated, please reload the page",{Reload:()=>{window.location.reload()}}))}}}).catch(t=>{I("error",t.message)})}setInterval(jl,3e3);async function Ke(e){let t=e.extract,n=e.deserialize;return e.extract=(r,s)=>{if(typeof t=="function")return t(r,s);if(r.status!==304&&Math.floor(r.status/100)!==2){if(r.status===403)throw new Error("Not authorized");let o=new Error;throw o.message=r.status===0?"Server is unreachable":`Unexpected response status code ${r.status}`,o.code=r.status,o.response=r.responseText,o}let i;if(typeof n=="function")i=n(r.responseText);else if((r.getResponseHeader("content-type")||"").startsWith("application/json"))try{i=r.responseText?JSON.parse(r.responseText):null}catch{throw new Error("Invalid JSON: "+r.responseText.slice(0,80))}else i=r.responseText;return i},bt.default.request(e)}function xn(e){return Array.isArray(e)?Sn(e,null,Be+yt):e}function Re(e,t){let n=br(t),r=ze[e].count.get(n);return r||(r=new Pn,ze[e].count.set(n,r),Q.filter.set(r,t),r)}function Ul(e){return(t,n)=>{for(let[r,s]of Object.entries(e)){let i=t[r],o=n[r];if(i!=null&&typeof i=="object"&&(i.value?i=i.value[0]:i=null),o!=null&&typeof o=="object"&&(o.value?o=o.value[0]:o=null),i>o)return s;if(i<o)return s*-1;if(i!==o){let a={null:1,number:2,string:3},l=a[i==null?"null":typeof i]||4,f=a[o==null?"null":typeof o]||4;return Math.max(-1,Math.min(1,l-f))*s}}return 0}}function Cs(e,t,n,r){let s=[];for(let i of ze[e].objects.values())dt(t,i,Be+yt)&&s.push(i);return s=s.sort(Ul(n)),r&&(s=s.slice(0,r)),s}function pe(e,t,n={}){let r=br(t),s=Object.assign({},n.sort),i=n.limit||0;e==="devices"?s["DeviceID.ID"]=s["DeviceID.ID"]||1:s._id=s._id||1;let o=`${r}:${i}:${JSON.stringify(s)}`,a=ze[e].fetch.get(o);if(a)return a;a=new Pn,ze[e].fetch.set(o,a),Q.filter.set(a,t),Q.limit.set(a,i),Q.sort.set(a,s);let[l,f]=xo(ze[e].combinedFilter,xn(t),s),h=Cs(e,l,s,i);return Q.value.set(a,h),!f||i&&h.length>=i?Q.fulfilled.set(a,Be):Q.unsatisfied.set(a,f),a}function So(e){let t=[];for(let[r,s]of Object.entries(ze))for(let[i,o]of s.count){if(!(Q.accessed.get(o)>=e)){s.count.delete(i);continue}if(!Q.fulfilling.has(o)&&!(Be<=Q.fulfilled.get(o))){Q.fulfilling.add(o);let a=Q.filter.get(o);a=xn(a),t.push(Ke({method:"HEAD",url:`api/${r}/?`+bt.default.buildQueryString({filter:br(a)}),extract:l=>{if(l.status===403)throw new Error("Not authorized");if(l.status){if(l.status!==200)throw new Error(`Unexpected response status code ${l.status}`)}else throw new Error("Server is unreachable");return+l.getResponseHeader("x-total-count")},background:!1}).then(l=>{Q.value.set(o,l),Q.fulfilled.set(o,Be),Q.fulfilling.delete(o)}))}}let n={};for(let[r,s]of Object.entries(ze))for(let[i,o]of s.fetch){if(!(Q.accessed.get(o)>=e)){s.fetch.delete(i);continue}if(!Q.fulfilling.has(o)&&!(Be<=Q.fulfilled.get(o))){Q.fulfilling.add(o),n[r]=n[r]||[],n[r].push(o);let a=Q.limit.get(o),l=Q.sort.get(o);if(a){let f=Q.filter.get(o);f=xn(f);let h=Q.unsatisfied.get(o);h&&(a-=Q.value.get(o).length,f=h),t.push(Ke({method:"GET",url:`api/${r}/?`+bt.default.buildQueryString({filter:br(f),limit:1,skip:a-1,sort:JSON.stringify(l),projection:Object.keys(l).join(",")}),background:!0}).then(g=>{Q.unsatisfied.delete(o),g.length?Q.bookmark.set(o,Eo(l,g[0])):Q.bookmark.delete(o)}))}}}Promise.all(t).then(()=>{let r=!1,s=[];for(let[i,o]of Object.entries(n)){let a=null;for(let u of o){let c=Q.filter.get(u);c=Sn(c,null,Be+yt);let m=Q.bookmark.get(u),y=Q.sort.get(u);m&&(c=it(c,An(m,y))),a=gt(a,c)}let[l,f]=Co(ze[i].combinedFilter,a);if(!f){for(let u of o){let c=Q.filter.get(u);c=Sn(c,null,Be+yt);let m=Q.limit.get(u),y=Q.bookmark.get(u),E=Q.sort.get(u);y&&(c=it(c,An(y,E))),Q.value.set(u,Cs(i,c,E,m)),Q.fulfilled.set(u,Be),Q.fulfilling.delete(u),r=!0}continue}let h=new Set;ze[i].combinedFilter||(h=new Set(ze[i].objects.keys()));let g=f;ze[i].combinedFilter=l,s.push(Ke({method:"GET",url:`api/${i}/?`+bt.default.buildQueryString({filter:br(g)}),background:!1}).then(u=>{for(let c of u){let m=i==="devices"?c["DeviceID.ID"].value[0]:c._id;ze[i].objects.set(m,c),h.delete(m)}for(let c of h){let m=ze[i].objects.get(c);dt(g,m,Be+yt)&&ze[i].objects.delete(c)}for(let c of o){let m=Q.filter.get(c);m=xn(m);let y=Q.limit.get(c),E=Q.bookmark.get(c),C=Q.sort.get(c);E&&(m=it(m,An(E,C))),Q.value.set(c,Cs(i,m,C,y)),Q.fulfilled.set(c,Be),Q.fulfilling.delete(c)}}))}return r&&bt.default.redraw(),Promise.all(s)}).catch(r=>{I("error",r.message)})}function kn(){return Be}function j(e){if(e>Be){Be=e;for(let t of Object.values(ze))t.combinedFilter=null}}function Es(){return yt}function Po(e,t){let n=[];for(let r of t){r.status="pending";let s=Object.assign({},r);delete s.device,delete s.status,n.push(s)}return Ke({method:"POST",url:`api/devices/${encodeURIComponent(e)}/tasks`,body:n,extract:r=>{if(r.status===403)throw new Error("Not authorized");if(!r.status)throw new Error("Server is unreachable");if(r.status!==200)throw new Error(r.response);let s=r.getResponseHeader("Connection-Request"),i=JSON.parse(r.response);for(let[o,a]of i.entries())t[o]._id=a._id,t[o].status=a.status;return s}})}function yr(e,t){return Ke({method:"POST",url:`api/devices/${encodeURIComponent(e)}/tags`,body:t})}function ae(e,t){return Ke({method:"DELETE",url:`api/${e}/${encodeURIComponent(t)}`})}function Je(e,t,n){for(let r in n)n[r]===void 0&&(n[r]=null);return Ke({method:"PUT",url:`api/${e}/${encodeURIComponent(t)}`,body:n})}function ko(e="%"){let t=J(["LIKE",["PARAM","_id"],e]);return Ke({method:"GET",url:`api/config/?${bt.default.buildQueryString({filter:t})}`,background:!0})}function Ge(e,t){let r=["=",["PARAM",e==="devices"?"DeviceID.ID":"_id"],t];return Ke({method:"HEAD",url:`api/${e}/?`+bt.default.buildQueryString({filter:br(r)}),extract:s=>{if(s.status===403)throw new Error("Not authorized");if(s.status){if(s.status!==200)throw new Error(`Unexpected response status code ${s.status}`)}else throw new Error("Server is unreachable");return+s.getResponseHeader("x-total-count")},background:!0})}function G(e,t){return Array.isArray(e)?Sn(e,t,Be+yt):e}function In(e,t,n){let r={newPassword:t};return n&&(r.authPassword=n),Ke({method:"PUT",url:`api/users/${e}/password`,background:!0,body:r})}function Io(e,t){return Ke({method:"POST",url:"login",background:!0,body:{username:e,password:t}})}function To(){return Ke({method:"POST",url:"logout"})}function Mo(e){return Ke({url:`api/ping/${encodeURIComponent(e)}`,background:!0})}var As=Ue(qe());var Oo="logo.svg";var Do="icons.svg";function ve(e){return(0,As.default)(`svg.icon.icon-${e}`,{key:`icon-${e}`},(0,As.default)("use",{href:`${Do}#icon-${e}`}))}var xs=100,wt=new Set,Ss=new Set;function No(e){let t=wt.size;for(let n of e)wt.has(n)||++t;return t<=xs}function Ve(...e){if(!No(e)){I("error","Too many tasks in queue");return}for(let t of e)t.status="queued",wt.add(t)}function Tn(e){wt.delete(e)}function Ps(){return wt}function Ro(){wt.clear()}function $o(){return Ss}function Lo(e){if(wt.size+e.devices.length>xs){I("error","Too many tasks in queue");return}Ss.add(e)}function Mn(e){if(wt.size+e.devices.length>xs){I("error","Too many tasks in queue");return}Ss.add(e)}function On(e,t){let n={};if(!No(e))return Promise.reject(new Error("Too many tasks in queue"));for(let r of e)n[r.device]=n[r.device]||[],n[r.device].push(r),r.status="queued",wt.add(r);return new Promise(r=>{let s=1;for(let[i,o]of Object.entries(n))++s,Po(i,o).then(a=>{for(let l of o)l.status==="pending"?l.status="stale":l.status==="done"&&wt.delete(l);t(i,null,a,o),--s===0&&r()}).catch(a=>{for(let l of o)l.status="stale";t(i,a,null,o),--s===0&&r()});--s===0&&r()})}var ks=new WeakSet;function Fr(e){return(0,q.default)("span.parameter",{title:e},`${e}`)}function ql(e){return(0,q.default)("span.value",{title:e},`${e}`)}function Bl(e,t,n){function r(i){i.key==="Enter"?t():i.key==="Escape"?n():i.redraw=!1}let s;if(e.parameterValues[0][2]==="xsd:boolean")s=(0,q.default)("select",{value:e.parameterValues[0][1].toString(),onchange:i=>{i.redraw=!1,e.parameterValues[0][1]=s.dom.value},onkeydown:r,oncreate:i=>{i.dom.focus()}},[(0,q.default)("option",{value:"true"},"true"),(0,q.default)("option",{value:"false"},"false")]);else{let i=e.parameterValues[0][2],o=e.parameterValues[0][1];i==="xsd:dateTime"&&typeof o=="number"&&(o=new Date(o).toJSON()||o),s=(0,q.default)("input",{type:["xsd:int","xsd:unsignedInt"].includes(i)?"number":"text",value:o,oninput:a=>{a.redraw=!1,e.parameterValues[0][1]=s.dom.value},onkeydown:r,oncreate:a=>{a.dom.focus(),a.dom.select(),a.dom.parentNode.parentNode.scrollTop=0}})}return[(0,q.default)("span","Editing ",Fr(e.parameterValues[0][0])),s]}function Vl(e){!e.fileName||!e.fileType?ks.add(e):ks.delete(e);let t=pe("files",!0),n="",r="";for(let o of e.devices){let a=o.split("-");n===""?n=a[0]:n!==a[0]&&(n=null),a.length===3&&(r===""?r=a[1]:r!==a[1]&&(r=null))}n&&(n=decodeURIComponent(n)),r&&(r=decodeURIComponent(r));let s=[...new Set(["","1 Firmware Upgrade Image","2 Web Content","3 Vendor Configuration File","4 Tone File","5 Ringer File",...t.value.map(o=>o["metadata.fileType"]).filter(o=>o)])].map(o=>(0,q.default)("option",{disabled:!o,value:o,selected:(e.fileType||"")===o},o)),i=[""].concat(t.value.filter(o=>(!o["metadata.oui"]||o["metadata.oui"]===n)&&(!o["metadata.productClass"]||o["metadata.productClass"]===r)).map(o=>o._id)).map(o=>(0,q.default)("option",{disabled:!o,value:o,selected:(e.fileName||"")===o},o));return["Push ",(0,q.default)("select",{onchange:o=>{let a=o.target.value;e.fileName=a,e.fileType="";for(let l of t.value)l._id===a&&(e.fileType=l["metadata.fileType"])},disabled:t.fulfilling,style:"width: 350px"},i)," as ",(0,q.default)("select",{onchange:o=>{e.fileType=o.target.value}},s)]}function Fl(e){let t=[];for(let n of e){let r=()=>{e.delete(n);for(let l of n.devices){let f=Object.assign({device:l},n);delete f.devices,Ve(f)}},s=()=>{e.delete(n)},i;n.name==="setParameterValues"?i=Bl(n,r,s):n.name==="download"&&(i=Vl(n));let o=(0,q.default)("button.primary",{title:"Queue task",onclick:r,disabled:ks.has(n)},"Queue"),a=(0,q.default)("button",{title:"Cancel edit",onclick:s},"Cancel");t.push((0,q.default)(".staging",i,(0,q.default)("div.actions",o,a)))}return t}function Ql(e){let t=[],n={};for(let r of e)n[r.device]=n[r.device]||[],n[r.device].push(r);for(let[r,s]of Object.entries(n)){t.push((0,q.default)("strong",r));for(let i of s){let o=[];(i.status==="fault"||i.status==="stale")&&o.push((0,q.default)("button",{title:"Retry this task",onclick:()=>{Ve(i)}},ve("retry"))),o.push((0,q.default)("button",{title:"Remove this task",onclick:()=>{Tn(i)}},ve("remove"))),i.name==="setParameterValues"?t.push((0,q.default)(`div.${i.status}`,(0,q.default)("span","Set ",Fr(i.parameterValues[0][0])," to '",ql(i.parameterValues[0][1]),"'"),(0,q.default)(".actions",o))):i.name==="refreshObject"?t.push((0,q.default)(`div.${i.status}`,(0,q.default)("span","Refresh ",Fr(i.parameterName)),(0,q.default)(".actions",o))):i.name==="reboot"?t.push((0,q.default)(`div.${i.status}`,"Reboot",(0,q.default)(".actions",o))):i.name==="factoryReset"?t.push((0,q.default)(`div.${i.status}`,"Factory reset",(0,q.default)(".actions",o))):i.name==="addObject"?t.push((0,q.default)(`div.${i.status}`,(0,q.default)("span","Add ",Fr(i.objectName)),(0,q.default)(".actions",o))):i.name==="deleteObject"?t.push((0,q.default)(`div.${i.status}`,(0,q.default)("span","Delete ",Fr(i.objectName)),(0,q.default)(".actions",o))):i.name==="getParameterValues"?t.push((0,q.default)(`div.${i.status}`,`Refresh ${i.parameterNames.length} parameters`,(0,q.default)(".actions",o))):i.name==="download"?t.push((0,q.default)(`div.${i.status}`,`Push file: ${i.fileName} (${i.fileType})`,(0,q.default)(".actions",o))):t.push((0,q.default)(`div.${i.status}`,i.name,(0,q.default)(".actions",o)))}}return t}function Wl(e){let t=[];for(let n of e){let r;if(n.actions){let s=Object.entries(n.actions).map(([i,o])=>(0,q.default)("button.primary",{onclick:o},i));s.length&&(r=(0,q.default)("div",{style:"float: right"},s))}t.push((0,q.default)("div.notification",{class:n.type,style:"position: absolute;opacity: 0",oncreate:s=>{s.dom.style.opacity="1"},onbeforeremove:s=>(s.dom.style.opacity="0",new Promise(i=>{setTimeout(()=>{i()},500)})),key:n.timestamp},(0,q.default)("div",r,n.message)))}return t}var Hl=()=>({view:e=>{let t=Ps(),n=$o(),r=no(),s,i,o=Wl(r),a=Fl(n),l=Ql(t);function f(){let g=10;for(let u of o)u.dom.style.top=`${g}px`,g+=u.dom.offsetHeight+10}function h(){let g=i.dom.offsetTop+i.dom.offsetHeight;if(a.length)for(let u of a)g=Math.max(g,u.dom.offsetTop+u.dom.offsetHeight);else if(e.state.mouseIn)for(let u of s.children)g=Math.max(g,u.dom.offsetTop+u.dom.offsetHeight);s.dom.style.height=g+"px"}if(a.length+l.length){let g={queued:0,pending:0,fault:0,stale:0};for(let c of t)g[c.status]+=1;let u=(0,q.default)(".actions",(0,q.default)("button.primary",{title:"Commit queued tasks",disabled:!g.queued,onclick:()=>{let c=Array.from(Ps()).filter(m=>m.status==="queued");On(c,(m,y,E,C)=>{if(y){I("error",`${m}: ${y.message}`);return}if(E!=="OK"){I("error",`${m}: ${E}`);return}for(let x of C)if(x.status==="stale"){I("error",`${m}: No contact from device`);return}else if(x.status==="fault"){I("error",`${m}: Task(s) faulted`);return}I("success",`${m}: Task(s) committed`)}).then(()=>{j(Date.now())}).catch(m=>{I("error",m.message)})}},"Commit"),(0,q.default)("button",{title:"Clear tasks",onclick:Ro,disabled:!l.length},"Clear"));i=(0,q.default)(".status",(0,q.default)("span.queued",{class:g.queued?"active":""},`Queued: ${g.queued}`),(0,q.default)("span.pending",{class:g.pending?"active":""},`Pending: ${g.pending}`),(0,q.default)("span.fault",{class:g.fault?"active":""},`Fault: ${g.fault}`),(0,q.default)("span.stale",{class:g.stale?"active":""},`Stale: ${g.stale}`),u),s=(0,q.default)(".drawer",{key:"drawer",style:"opacity: 0;height: 0;",oncreate:c=>{e.state.mouseIn=!1,c.dom.style.opacity="1",h()},onmouseover:c=>{e.state.mouseIn=!0,h(),c.redraw=!1},onmouseleave:c=>{e.state.mouseIn=!1,h(),c.redraw=!1},onupdate:h,onbeforeremove:c=>(c.dom.onmouseover=null,c.dom.onmouseleave=null,c.dom.style.opacity="0",c.dom.style.height="0",new Promise(m=>{setTimeout(m,500)}))},i,a.length?a:(0,q.default)(".queue",l))}return(0,q.default)("div.drawer-wrapper",s,(0,q.default)("div.notifications-wrapper",{key:"notifications",style:"position: relative;",onupdate:f,oncreate:f},o))}}),_o=Hl;var Gt=Ue(qe());var Kl=()=>({view:()=>window.username?(0,Gt.default)("div.user-menu",window.username,(0,Gt.default)("button",{onclick:e=>(e.target.disabled=!0,To().then(()=>{location.hash="",location.reload()}).catch(t=>{e.target.disabled=!1,I("error",t.message)}),!1)},"Log out")):(0,Gt.default)("div.user-menu",(0,Gt.default)("a",{href:"#!/login?"+Gt.default.buildQueryString({continue:Gt.default.route.get()})},"Log in"))}),zo=Kl;var je=Ue(qe()),Jl=()=>({view:e=>{let t={[e.attrs.page]:"active"},n=[];return window.authorizer.hasAccess("presets",1)&&n.push((0,je.default)("li",{class:t.presets},(0,je.default)("a",{href:"#!/admin/presets"},"Presets"))),window.authorizer.hasAccess("provisions",1)&&n.push((0,je.default)("li",{class:t.provisions},(0,je.default)("a",{href:"#!/admin/provisions"},"Provisions"))),window.authorizer.hasAccess("virtualParameters",1)&&n.push((0,je.default)("li",{class:t.virtualParameters},(0,je.default)("a",{href:"#!/admin/virtualParameters"},"Virtual Parameters"))),window.authorizer.hasAccess("files",1)&&n.push((0,je.default)("li",{class:t.files},(0,je.default)("a",{href:"#!/admin/files"},"Files"))),window.authorizer.hasAccess("config",1)&&n.push((0,je.default)("li",{class:t.config},(0,je.default)("a",{href:"#!/admin/config"},"Config"))),window.authorizer.hasAccess("permissions",1)&&n.push((0,je.default)("li",{class:t.permissions},(0,je.default)("a",{href:"#!/admin/permissions"},"Permissions"))),window.authorizer.hasAccess("users",1)&&n.push((0,je.default)("li",{class:t.users},(0,je.default)("a",{href:"#!/admin/users"},"Users"))),(0,je.default)("nav#side-menu",(0,je.default)("ul",n))}}),jo=Jl;var Qr=Ue(qe()),Tt=null,Dn=null;function ge(e,t=null){Tt=e,Dn=t}function le(e,t=!0){return e===Tt?!t&&Dn&&!Dn()?!1:(Tt=null,Dn=null,!0):!1}function Uo(){return Tt?(0,Qr.default)(".overlay-wrapper",{tabindex:0,onclick:()=>{le(Tt,!1)},style:"opacity: 0",oncreate:e=>{e.dom.focus(),e.dom.style.opacity="1"},onbeforeremove:e=>(e.dom.style.opacity="0",new Promise(t=>{setTimeout(()=>{t()},500)}))},(0,Qr.default)(".overlay",{onclick:e=>{e.stopPropagation()}},Tt())):null}document.addEventListener("keydown",e=>{Tt&&e.key==="Escape"&&le(Tt,!1)&&Qr.default.redraw()});window.addEventListener("popstate",()=>{le(Tt,!1)&&Qr.default.redraw()});var qo="1.2.13+20240724222422";var Is=Ue(qe()),Wr=new Map;function Yl(e){let t=0;for(let n=0;n<e.length;++n){let r=e.charCodeAt(n);t=(t<<5)-t+r,t|=0}return t}function Bo(e){let t="datalist"+e.reduce((n,r)=>n^Yl(r),0);if(!Wr.has(t)){let n=(0,Is.default)("datalist",{id:t},e.map(r=>(0,Is.default)("option",{value:r})));Wr.set(t,n)}return t}var Zl=()=>({view:()=>[...Wr.values()],onupdate:()=>{for(let e of Wr.keys())document.querySelector(`[list='${e}']`)||Wr.delete(e)}}),Vo=Zl;var Xl=["presets","provisions","virtualParameters","files","config","users","permissions"],eu=()=>({view:e=>{let t,n;if(Xl.includes(e.attrs.page)){n="admin";let s={};s.page=e.attrs.page,t=(0,lt.default)(jo,s)}let r={};return r.page=n||e.attrs.page,[(0,lt.default)("#header",[(0,lt.default)("div.logo",(0,lt.default)("img",{src:Oo}),(0,lt.default)("span.version","v"+qo)),(0,lt.default)(zo),(0,lt.default)(Gi,r),(0,lt.default)(_o)]),(0,lt.default)("#content-wrapper",t,(0,lt.default)("#content",{class:`page-${e.attrs.page}`},[e.children])),Uo(),(0,lt.default)(Vo)]}}),Fo=eu;var Ts={};nt(Ts,{component:()=>ru,init:()=>tu});var Ae=Ue(qe());async function tu(){return Ae.default.request({url:"init"})}var ru=e=>{let t=e.attrs,n=new Set;for(let[r,s]of Object.entries(t))s&&n.add(r);return{view:()=>{document.title="Initialization wizard - GenieACS";let r=["users","presets","filters","device","index","overview"].map(s=>(t[s]||n.delete(s),(0,Ae.default)("input",{type:"checkbox",checked:n.has(s),disabled:!t[s],style:"display: inline; margin-right: 0.5em;",onclick:i=>{i.target.checked?n.add(s):n.delete(s)}})));return(0,Ae.default)(".wizard-dialog",[(0,Ae.default)("h1","Initialization wizard"),(0,Ae.default)("p","This wizard will seed the database with a minimal initial configuration to serve as a starting point. Select what you want to initialize and click 'ABRACADABRA!'."),(0,Ae.default)("div",(0,Ae.default)("label",r[0],"Users, roles and permissions")),(0,Ae.default)("div",(0,Ae.default)("label",r[1],"Presets and provisions")),(0,Ae.default)("div",(0,Ae.default)("label",r[2],"Devices predefined search filters")),(0,Ae.default)("div",(0,Ae.default)("label",r[3],"Device details page")),(0,Ae.default)("div",(0,Ae.default)("label",r[4],"Devices listing page")),(0,Ae.default)("div",(0,Ae.default)("label",r[5],"Overview page")),(0,Ae.default)("button.primary",{style:"margin: 10px;",disabled:n.size===0,onclick:s=>{s.target.disabled=!0;let i={};for(let o of n)i[o]=!0;Ae.default.request({method:"POST",url:"init",body:i}).then(()=>{setTimeout(()=>{Ae.default.request({url:"init"}).then(o=>{s.target.disabled=!1,t=o,I("success","Initialization complete",{"Open Sesame!":()=>{Ae.default.route.set("/login"),window.location.reload()}})}).catch(o=>{I("error",o.message)})},3e3),i.users&&alert("An administrator user has been created for you. Use admin/admin to log in. Don't forget to change the default password.")}).catch(o=>{I("error",o.message)})}},"ABRACADABRA!")])}}};var Rs={};nt(Rs,{component:()=>Ou,init:()=>Mu});var Ns=Ue(qe());var nu={year:31104e6,month:2592e6,day:864e5,hour:36e5,minute:6e4,second:1e3};function Ms(e){let t="",n=2;for(let[r,s]of Object.entries(nu))if(e>=s){let i;if(n>1?(i=Math.floor(e/s),e-=i*s):i=Math.round(e/s),i>1?t+=`${i} ${r}s `:t+=`${i} ${r} `,!--n)break}return t+"ago"}var su=V((e,t,n)=>{let r=n;e=dt(e,null,n,o=>{if(!Array.isArray(o))return o;for(let a=1;a<o.length;++a)if(Array.isArray(o[a])&&o[a][0]==="PARAM"&&!Array.isArray(o[a][1])){let l=null,f=t[o[a][1]];f?.value&&(l=f.value[0],r=Math.min(r,f.valueTimestamp)),o=o.slice(),o[a]=l}return o[0]==="FUNC"&&o[1]==="DATE_STRING"&&!Array.isArray(o[2])?new Date(o[2]).toLocaleString():o});let s=null,i=null;if(!Array.isArray(e))i=e;else if(e[0]==="PARAM"){let o=t[e[1]];o?.value&&(r=o.valueTimestamp,i=o.value[0],s=e[1],o.value[1]==="xsd:dateTime"&&typeof i=="number"&&(i=new Date(i).toLocaleString()))}return{value:i,timestamp:r,parameter:s}}),iu=()=>({view:e=>{let t=e.attrs.device,{value:n,timestamp:r,parameter:s}=su(e.attrs.parameter,t,kn()+Es());if(n==null)return null;let i;t[s]?.writable&&(i=p("button",{title:"Edit parameter value",onclick:()=>{Lo({name:"setParameterValues",devices:[t["DeviceID.ID"].value[0]],parameterValues:[[s,t[s].value[0],t[s].value[1]]]})}},ve("edit")));let o=p("long-text",{text:`${n}`});return p("span",{class:"parameter-value",onmouseover:a=>{if(a.redraw=!1,a.target===o.dom){let l=Date.now()+Es(),f=new Date(r).toLocaleString();a.target.title=`${f} (${Ms(l-r)})`}}},o,i)}}),Qo=iu;var ou=()=>({view:e=>{let t=e.attrs.device,n=Object.values(e.attrs.parameters).map(r=>{let s=G(r.type,t),i=p.context({device:t,parameter:r.parameter},s||"parameter",r);return p("tr",{oncreate:o=>{o.dom.style.display=i.dom?"":"none"},onupdate:o=>{o.dom.style.display=i.dom?"":"none"}},p("th",G(r.label,t)),p("td",i))});return p("loading",{queries:[e.attrs.deviceQuery]},p("table.parameter-list",n))}}),Wo=ou;var au=()=>({oninit:e=>{let t=e.attrs.parameter;if(!Array.isArray(t)||t[0]!=="PARAM")throw new Error("Object must be a parameter path");e.state.object=t[1],e.state.parameters=Object.values(e.attrs.childParameters)},view:e=>{let t=e.attrs.device,n=G(e.state.object,t),r=e.state.parameters;if(typeof n!="string"||!t[n])return null;let s=new Set,i=`${n}.`;for(let g in t)if(g.startsWith(i)){let u=g.indexOf(".",i.length);u===-1?s.add(g):s.add(g.slice(0,u))}let o=Object.values(r).map(g=>p("th",G(g.label,t))),a=p("thead",p("tr",o)),l=[];for(let g of s){let u="filter"in e.attrs?e.attrs.filter:!0;if(u=ne(u,m=>Array.isArray(m)&&m[0]==="PARAM"?["PARAM",["||",g,".",m[1]]]:m),!G(u,t))continue;let c=r.map(m=>{let y=ne(m.parameter,E=>Array.isArray(E)&&E[0]==="PARAM"?["PARAM",["||",g,".",E[1]]]:E);return p("td",p.context({device:t,parameter:y},m.type||"parameter",Object.assign({},m,{device:t,parameter:y,label:null})))});t[g].writable===!0&&c.push(p("td",p("button",{title:"Delete this instance",onclick:()=>{Ve({name:"deleteObject",device:t["DeviceID.ID"].value[0],objectName:g})}},ve("delete-instance")))),l.push(p("tr",c))}l.length||l.push(p("tr.empty",p("td",{colspan:o.length},"No instances"))),t[n].writable===!0&&l.push(p("tr",p("td",{colspan:o.length}),p("td",p("button",{title:"Create a new instance",onclick:()=>{Ve({name:"addObject",device:t["DeviceID.ID"].value[0],objectName:n})}},ve("add-instance")))));let f,h=G(e.attrs.label,t);return h!=null&&(f=p("h2",h)),[f,p("loading",{queries:[e.attrs.deviceQuery]},p("table.table",a,p("tbody",l)))]}}),Ho=au;var lu=ue.ui.overview.charts,uu=()=>({view:e=>{let t=e.attrs.device,n=G(e.attrs.chart,t||{}),r=lu[n];if(!r)return null;for(let s of Object.values(r.slices)){let i=s.filter;if(G(i,t||{})){let o=p("svg",{width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},p("circle",{cx:"0.5em",cy:"0.5em",r:"0.4em",fill:G(s.color,null)}));return p("span.overview-dot",o,G(s.label,null))}}return null}}),Ko=uu;var cu=V((e,t,n)=>{let r={};for(let[s,i]of Object.entries(e)){let o=ne(i,a=>{if(Array.isArray(a)&&a[0]==="FUNC"&&a[1]==="ENCODEURICOMPONENT"){let l=G(a[2],t);return l==null?null:encodeURIComponent(l)}return a});r[s]=G(o,t)}return r}),fu=()=>({view:e=>{let t=e.attrs.device;if("filter"in e.attrs&&!G(e.attrs.filter,t||{}))return null;let n=Object.values(e.attrs.components).map(i=>{if(Array.isArray(i)&&(i=G(i,t||{})),typeof i!="object")return`${i}`;let o=G(i.type,t||{});return o?p(o,i):null}),r=e.attrs.element;if(r==null)return n;let s;return Array.isArray(r)?r=G(r,t||{}):typeof r=="object"&&(r.attributes!=null&&(s=cu(r.attributes,t||{},kn())),r=G(r.tag,t||{})),p(r,s,n)}}),Jo=fu;var mu=()=>({view:e=>{let t=e.attrs.device;return p("button.primary",{title:"Initiate session and refresh basic parameters",onclick:n=>{n.target.disabled=!0;let s={name:"getParameterValues",parameterNames:Object.values(e.attrs.parameters).map(i=>!Array.isArray(i)||i[0]!=="PARAM"?null:G(i[1],t)).filter(i=>!!i),device:t["DeviceID.ID"].value[0]};On([s],(i,o,a,l)=>{if(o){I("error",`${i}: ${o.message}`);return}for(let f of l)f.status==="stale"&&Tn(f);a!=="OK"?I("error",`${i}: ${a}`):l[0].status==="stale"?I("error",`${i}: No contact from device`):l[0].status==="fault"?I("error",`${i}: Refresh faulted`):I("success",`${i}: Summoned`)}).then(()=>{n.target.disabled=!1,j(Date.now())}).catch(i=>{n.target.disabled=!1,I("error",i.message)})}},"Summon")}}),Go=mu;var zt="  ",pu=new Set(["true","True","TRUE","false","False","FALSE","null","Null","NULL"]);function Yo(e){return!/[^\t\n\x20-\x7e\x85\u{a0}-\u{d7ff}\u{e000}-\u{fffd}\u{10000}-\u{10ffff}]/u.test(e)}function Os(e){return!e||!Yo(e)||/^[\s-?:,[\]{}#&$!|>'"%@`]|: | #|[\n,[\]{}]|\s$/.test(e)?JSON.stringify(e):e}function hu(e){if(e.length<=80)return[e];if(e.startsWith(" "))return[e];let t=[],n=0,r=0;for(let s=1;s<e.length-1;++s){if(e[s]!==" ")continue;if(e[s+1]===" "){for(s+=2;e[s]===" ";)++s;continue}if(s<=n+80){r=s;continue}let i=r>n?r:s;t.push(e.slice(n,i)),n=i+1,r=s}return r>n&&e.length>n+80&&(t.push(e.slice(n,r)),n=r+1),t.push(e.slice(n)),t}function du(e,t,n,r){if(/^\s*$/.test(e)||pu.has(e)||!Yo(e)){t.push(n+JSON.stringify(e));return}r||(r=zt);let s=e.split(`
`);if(s.length>1){let i="",o="-";if((s.find(f=>f)||"").startsWith(" ")&&(i=`${zt.length}`),s[s.length-1]||(s.pop(),s[s.length-1]?o="":o="+"),/^\s+$/.test(s[s.length-1])){t.push(n+JSON.stringify(e));return}let a=!1,l=s.map(f=>{let h=hu(f);return h.length>1&&(a=!0),h});if(!a){t.push(`${n}|${i}${o}`,...s.map(f=>f&&r+f));return}t.push(`${n}>${i}${o}`),t.push(...l[0].map(f=>r+f));for(let f=1;f<l.length;++f)l[f-1][0]&&!l[f-1][0].startsWith(" ")&&t.push(""),t.push(...l[f].map(g=>r+g));return}if(/^[\s-?:,[\]{}#&$!|>'"%@`]|: | #|\s$/.test(e)||parseFloat(e)===+e){t.push(n+JSON.stringify(e));return}t.push(n+e)}function Yt(e,t,n="",r=""){if(e==null){t.push(`${n}null`);return}if(typeof e=="number"||typeof e=="boolean"){t.push(`${n}${JSON.stringify(e)}`);return}if(e instanceof Date){t.push(`${n}${e.toJSON()}`);return}if(typeof e=="string"){du(e,t,n,r);return}if(Array.isArray(e)){if(!e.length){t.push(n+"[]");return}if(!n||n.endsWith("- ")){Yt(e[0],t,n+"- ",r+zt),n=r+"- ",r=r+zt;for(let i=1;i<e.length;++i)Yt(e[i],t,n,r)}else{t.push(n),n=r+"- ",r=r+zt;for(let i=0;i<e.length;++i)Yt(e[i],t,n,r)}return}let s=Object.entries(e).filter(i=>i[1]!==void 0);if(!s.length){t.push(n+"{}");return}if(!n||n.endsWith("- ")){Yt(s[0][1],t,n+`${Os(s[0][0])}: `,r+zt),n=r,r=r+zt;for(let i=1;i<s.length;++i)Yt(s[i][1],t,n+`${Os(s[i][0])}: `,r)}else{t.push(n),n=r,r=r+zt;for(let i=0;i<s.length;++i)Yt(s[i][1],t,n+`${Os(s[i][0])}: `,r)}}function Nn(e){if(e===void 0)return;let t=[];return Yt(e,t),t.join(`
`)+`
`}var gu=()=>({view:e=>{let n=e.attrs.device["DeviceID.ID"].value[0],r=pe("faults",["AND",[">",["PARAM","_id"],`${n}:`],["<",["PARAM","_id"],`${n}:zzzz`]]),s=["Channel","Code","Message","Detail","Retries","Timestamp"].map(l=>p("th",l)),i=p("thead",p("tr",s)),o=[];for(let l of r.value)o.push([p("td",l.channel),p("td",l.code),p("td",p("long-text",{text:l.message})),p("td",p("long-text",{text:Nn(l.detail)})),p("td",l.retries),p("td",new Date(l.timestamp).toLocaleString()),p("td",p("button",{title:"Delete fault",onclick:f=>{f.redraw=!1,ae("faults",l._id).then(()=>{I("success","Fault deleted"),j(Date.now()),p.redraw()}).catch(h=>{I("error",h.message),j(Date.now())})}},ve("remove")))]);let a;return o.length?a=p("tbody",o.map(l=>p("tr",l))):a=p("tbody",p("tr.empty",p("td",{colspan:s.length},"No faults"))),p("loading",{queries:[r]},p("table.table",i,a))}}),Zo=gu;function Hr(e,t){let n,r=[];return s=>{r.push(s),clearTimeout(n),n=setTimeout(()=>{let i=r;r=[],e(i)},t)}}var bu=V(he);function yu(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}var Ds=new WeakMap;function wu(e){if(Ds.has(e))return Ds.get(e);let t=[];for(let n of Object.keys(e)){let r=0;for(let s=n.lastIndexOf(".",n.length-2);s>=0;s=n.lastIndexOf(".",s-1))++r;for(;t.length<=r;)t.push([]);t[r].push(n)}return Ds.set(e,t),t}var vu=()=>{let e,t=Hr(n=>{e=n[n.length-1],p.redraw()},500);return{view:n=>{let r=n.attrs.device,s=G(n.attrs.limit,r)||100,i=p("input",{type:"text",placeholder:"Search parameters",oninput:u=>{t(u.target.value),u.redraw=!1}}),o=/\.[0-9]+$/,a;if(e){let u=e.split(" ").filter(c=>c);u.length&&(a=new RegExp(u.map(c=>yu(c)).join(".*"),"i"))}let l=[],f=wu(r),h=0;for(let u of f){let c=0;for(let m of u){let y=r[m],E=y.value?.[0]?`${m} ${y.value[0]}`:m;a&&!a.test(E)||(++c,h<s&&l.push(m))}h+=c}l.sort();let g=l.map(u=>{let c=r[u],m=[],y={key:u};return c.object===!1?m.push(p("parameter",Object.assign({device:r,parameter:bu(u)}))):c.object&&c.writable&&(o.test(u)?m.push(p("button",{title:"Delete this instance",onclick:()=>{Ve({name:"deleteObject",device:r["DeviceID.ID"].value[0],objectName:u})}},ve("delete-instance"))):m.push(p("button",{title:"Create a new instance",onclick:()=>{Ve({name:"addObject",device:r["DeviceID.ID"].value[0],objectName:u})}},ve("add-instance")))),m.push(p("button",{title:"Refresh tree",onclick:()=>{Ve({name:"getParameterValues",device:r["DeviceID.ID"].value[0],parameterNames:[u]})}},ve("refresh"))),p("tr",y,p("td.left",p("long-text",{text:u})),p("td.right",m))});return p("loading",{queries:[n.attrs.deviceQuery]},p(".all-parameters",p("a.download-csv",{href:`api/devices/${encodeURIComponent(r["DeviceID.ID"].value[0])}.csv`,download:"",style:"float: right;"},"Download"),i,p(".parameter-list",p("table",p("tbody",g)),p("m",`Displaying ${l.length} out of ${h} parameters.`))))}}},Xo=vu;var Cu=()=>({view:e=>{let t=e.attrs.device,n=[];return n.push(p("button.primary",{title:"Reboot device",onclick:()=>{Ve({name:"reboot",device:t["DeviceID.ID"].value[0]})}},"Reboot")),n.push(p("button.critical",{title:"Factory reset device",onclick:()=>{Ve({name:"factoryReset",device:t["DeviceID.ID"].value[0]})}},"Reset")),n.push(p("button.critical",{title:"Push a firmware or a config file",onclick:()=>{Mn({name:"download",devices:[t["DeviceID.ID"].value[0]]})}},"Push file")),n.push(p("button.primary",{title:"Delete device",onclick:()=>{if(!confirm("Deleting this device. Are you sure?"))return;let r=t["DeviceID.ID"].value[0];ae("devices",r).then(()=>{I("success",`${r}: Device deleted`),p.route.set("/devices")}).catch(s=>{I("error",s.message)})}},"Delete")),p(".actions-bar",n)}}),ea=Cu;function ta(e){return encodeURIComponent(e).replace(/[!~*'().]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase()).replace(/0x(?=[0-9A-Z]{2})/g,"0%78").replace(/%/g,"0x")}function Kr(e){return decodeURIComponent(e.replace(/0x(?=[0-9A-Z]{2})/g,"%"))}var Eu=()=>({view:e=>{let t=e.attrs.device,n=!0;"writable"in e.attrs&&(n=!!G(e.attrs.writable,t));let r=[];for(let s of Object.keys(t))s.startsWith("Tags.")&&r.push(Kr(s.slice(5)));return r.sort(),n?p(".tags",r.map(s=>p("span.tag",s,p("button",{onclick:i=>{i.target.disabled=!0;let o=t["DeviceID.ID"].value[0];yr(o,{[s]:!1}).then(()=>{i.target.disabled=!1,I("success",`${o}: Tags updated`),j(Date.now())}).catch(a=>{i.target.disabled=!1,I("error",`${o}: ${a.message}`)})}},ve("remove")))),p("span.tag.writable",p.trust("&nbsp;"),p("button",{onclick:s=>{s.target.disabled=!0;let i=t["DeviceID.ID"].value[0],o=prompt("Enter tag to assign to device:");if(!o){s.target.disabled=!1;return}yr(i,{[o]:!0}).then(()=>{s.target.disabled=!1,I("success",`${i}: Tags updated`),j(Date.now())}).catch(a=>{s.target.disabled=!1,I("error",`${i}: ${a.message}`)})}},ve("add")))):p(".tags",r.map(s=>p("span.tag",s)))}}),ra=Eu;var Au=3e3,xu=e=>{let t,n,r=()=>{if(!n){let i=e.dom;i&&(i.innerHTML="");return}let s="";Mo(n).then(i=>{i.avg!=null?s=`${Math.trunc(i.avg)} ms`:s="Unreachable"}).catch(()=>{s="Error!",clearInterval(t)}).finally(()=>{let i=e.dom;i&&(i.innerHTML=`Pinging ${n}: ${s}`)})};return{onremove:()=>{clearInterval(t)},view:s=>{let i=s.attrs.device,o=i["InternetGatewayDevice.ManagementServer.ConnectionRequestURL"];o||(o=i["Device.ManagementServer.ConnectionRequestURL"]);let a;try{a=new URL(o.value[0]).hostname}catch{}return n!==a&&(n=a,clearInterval(t),n&&(r(),t=setInterval(r,Au))),p("div",n?`Pinging ${n}:`:"")}}},na=xu;var Su=()=>({view:e=>{let t,n=e.attrs.device;n&&(t=n["DeviceID.ID"].value[0]);let r=Object.values(e.attrs.components).map(s=>{if(Array.isArray(s)&&(s=G(s,n||{})),typeof s!="object")return`${s}`;let i=G(s.type,n||{});if(!i)return null;let o=Object.assign({},e.attrs,s);return p(i,o)});return t?p("a",{href:`#!/devices/${encodeURIComponent(t)}`},r):r}}),sa=Su;var Rn=Ue(qe());var Pu=()=>({view:e=>{let t=e.attrs.text,n=e.attrs.element||"span";function r(s){s.dom.classList.add("long-text-overflowed"),s.dom.onclick=i=>{ge(()=>(0,Rn.default)("textarea.long-text",{value:t,cols:80,rows:24,readonly:"",oncreate:o=>{o.dom.focus(),o.dom.select()}})),i.stopPropagation(),Rn.default.redraw()}}return(0,Rn.default)(n,{oncreate:s=>{s.dom.clientWidth!==s.dom.scrollWidth&&r(s)},onupdate:s=>{s.dom.clientWidth===s.dom.scrollWidth?(s.dom.classList.remove("long-text-overflowed"),s.dom.onclick=null):r(s)},class:"long-text",title:t},t)}}),ia=Pu;var ku=()=>{let e,t,n=!1;function r(s){if(!n){e&&e.parentElement.remove(),t&&t.classList.remove("loading"),e=null,t=null;return}if(t&&t!==s.dom&&t.classList.remove("loading"),t=s.dom,t.classList.add("loading"),!e){let l=document.createElement("div");l.style.position="relative",l.style.pointerEvents="none",e=document.createElement("div"),e.classList.add("loading-overlay"),e.style.position="absolute",l.appendChild(e)}let i=e.parentElement;i.parentElement!==t.parentElement&&t.parentNode.appendChild(i);let o=i.getBoundingClientRect(),a=t.getBoundingClientRect();e.style.width=`${t.scrollWidth}px`,e.style.height=`${t.scrollHeight}px`,e.style.left=`${a.left-o.left}px`,e.style.top=`${a.top-o.top}px`}return{view:s=>(n=s.attrs.queries.some(o=>o.fulfilling),s.children),oncreate:r,onupdate:r,onremove:()=>{e&&e.parentElement.remove(),t&&t.classList.remove("loading"),e=null,t=null}}},oa=ku;var aa={parameter:Qo,"parameter-list":Wo,"parameter-table":Ho,"overview-dot":Ko,container:Jo,"summon-button":Go,"device-faults":Zo,"all-parameters":Xo,"device-actions":ea,tags:ra,ping:na,"device-link":sa,"long-text":ia,loading:oa},la=new WeakMap,Jr=new WeakMap,p=new Proxy(Ns.default,{apply:(e,t,n)=>{let r=n[0];return typeof r!="string"?n[0]=Ln(r):aa[r]&&(n[0]=Ln(aa[r])),Reflect.apply(e,void 0,n)},get:(e,t)=>t==="context"?Iu:Reflect.get(e,t)});function Iu(e,...t){let n=Reflect.apply(p,void 0,t);return Jr.set(n,e),n}function $n(e,t){if(Array.isArray(e))for(let n of e)$n(n,t);else if(e&&typeof e=="object"&&e.tag){let n=Object.assign({},t,Jr.get(e));if(typeof e.tag!="string"&&(Jr.set(e,n),e.attrs=Object.assign({},n,e.attrs)),e.children?.length)for(let r of e.children)$n(r,n)}}function Ln(e){let t=la.get(e);if(!t){if(typeof e!="function"){t=Object.assign({},e);let n=e.view;t.view=function(r){let s=Jr.get(r)||{},i=Reflect.apply(n,this,[r]);return $n(i,s),i}}else if(!e.prototype?.view)t=n=>{let r=e(n),s=r.view;return r.view=function(i){let o=Jr.get(i)||{};try{let a=Reflect.apply(s,this,[i]);return $n(a,o),a}catch(a){return(0,Ns.default)("p.error",{title:"Click to print stack trace to console",onclick:()=>console.error(a)},"Error!")}},r};else throw new Error("Class components not supported");la.set(e,t)}return t}var Tu=()=>({view:e=>{let t=e.attrs.onPasswordChange,n=!e.attrs.noAuth,r=e.attrs.username;r&&(e.state.username=r);let s=[p("p",p("label",{for:"username"},"Username"),p("input",{name:"username",type:"text",value:e.state.username,disabled:!!r,oninput:l=>{e.state.username=l.target.value},oncreate:l=>{l.dom.focus()}}))],i={newPassword:"New password",confirmPassword:"Confirm password"};n&&(i=Object.assign({authPassword:"Your password"},i));for(let[l,f]of Object.entries(i))s.push(p("p",p("label",{for:l},f),p("input",{name:l,type:"password",value:e.state[l],oninput:h=>{e.state[l]=h.target.value}})));let o=p("button.primary",{type:"submit"},"Change password");s.push(p(".actions-bar",o));let a=[p("h1","Change password"),p("form",{onsubmit:l=>{l.redraw=!1,l.preventDefault(),!e.state.username||!e.state.newPassword||n&&!e.state.authPassword?I("error","Please fill all fields"):e.state.newPassword!==e.state.confirmPassword?I("error","Password confirm doesn't match new password"):(o.dom.disabled=!0,In(e.state.username,e.state.newPassword,e.state.authPassword).then(()=>{I("success","Password updated successfully"),t&&t(),o.dom.disabled=!1}).catch(f=>{I("error",f.message),o.dom.disabled=!1}))}},s)];return p("div.put-form",a)}}),_n=Tu;function Mu(e){return Promise.resolve(e)}var Ou=()=>({view:e=>(window.username&&p.route.set(e.attrs.continue||"/"),document.title="Login - GenieACS",[p("h1","Log in"),p("form",p("p",p("label",{for:"username"},"Username"),p("input",{name:"username",type:"text",value:e.state.username,oncreate:t=>{t.dom.focus()},oninput:t=>{e.state.username=t.target.value}})),p("p",p("label",{for:"password"},"Password"),p("input",{name:"password",type:"password",value:e.state.password,oninput:t=>{e.state.password=t.target.value}})),p("p",p("button.primary",{type:"submit",onclick:t=>(t.target.disabled=!0,Io(e.state.username,e.state.password).then(()=>{location.reload()}).catch(n=>{I("error",n.response||n.message),t.target.disabled=!1}),!1)},"Login"))),p("a",{onclick:()=>{let t=()=>p(_n,{onPasswordChange:()=>{le(t),p.redraw()}});ge(t)}},"Change password")])});var $s={};nt($s,{component:()=>Lu,init:()=>$u});var ua=V(J);function Du(e){let t=e.slices,n=Array.from(Object.values(e.slices)).reduce((g,u)=>g+(u.count.value||0),0),r=[],s=[],i=[],o=0,a=Math.cos(2*Math.PI*o)*100,l=Math.sin(2*Math.PI*o)*100,f,h;for(let g of Object.values(t)){let u=n>0?(g.count.value||0)/n:0;if(r.push(p(".legend-line",[p("span.color",{style:`background-color: ${G(g.color,null)} !important;`}),`${G(g.label,null)}: `,p("a",{href:`#!/devices/?${p.buildQueryString({filter:ua(g.filter)})}`},g.count.value||0),` (${(u*100).toFixed(2)}%)`])),u>0){o+=u,f=Math.cos(2*Math.PI*o)*100,h=Math.sin(2*Math.PI*o)*100;let c=u>.5?1:0,m=`M ${a} ${l} A 100 100 0 ${c} 1 ${f} ${h} L 0 0 z`;a=f,l=h,s.push(p("path",{d:m,fill:G(g.color,null)}));let y=Math.cos(2*Math.PI*(o-u/2))*50,E=Math.sin(2*Math.PI*(o-u/2))*50;i.push(p("a",{"xlink:href":`#!/devices/?${p.buildQueryString({filter:ua(g.filter)})}`},[p("path",{d:m,"fill-opacity":0}),p("text",{x:y,y:E,"dominant-baseline":"middle","text-anchor":"middle"},`${(u*100).toFixed(2)}%`)]))}}return r.push(p("span.legend-total",`Total: ${n}`)),p("loading",{queries:Object.values(e.slices).map(g=>g.count)},p("div",{class:"pie-chart"},[p("svg",{viewBox:"-102 -102 204 204",width:"204px",height:"204px",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},s.concat(i)),p(".legend",r)]))}var Nu=()=>({view:e=>Du(e.attrs.chart)}),ca=Nu;var fa=ue.ui.overview.groups||{},ma={};for(let e of Object.values(fa))for(let t of Object.values(e.charts))ma[t]=ue.ui.overview.charts[t];function Ru(e){e=Object.assign({},e);for(let[t,n]of Object.entries(e)){e[t]=n=Object.assign({},n),n.slices=Object.assign({},n.slices);for(let[r,s]of Object.entries(n.slices)){let i=s.filter;n.slices[r]=s=Object.assign({},s),s.count=Re("devices",i)}}return e}function $u(){return window.authorizer.hasAccess("devices",1)?Promise.resolve({charts:Ru(ma)}):Promise.reject(new Error("You are not authorized to view this page"))}var Lu=()=>({view:e=>{document.title="Overview - GenieACS";let t=[];for(let n of Object.values(fa)){n.label&&t.push(p("h1",G(n.label,null)));let r=[];for(let s of Object.values(n.charts)){let i=e.attrs.charts[s],o=[];i.label&&o.push(p("h2",G(i.label,null)));let a={};a.chart=i,o.push(p(ca,a)),r.push(p(".overview-chart",o))}t.push(p(".overview-chart-group",r))}return t}});var Us={};nt(Us,{component:()=>rc,init:()=>ec});var _u=200;function zu(e,t,n,r,s,i,o,a,l,f,h){let g=t||[],u=[];typeof f=="function"?(u=f(s),Array.isArray(u)||(u=[u])):Array.isArray(f)&&(u=f);let c=[];if(u.length){let x=p("input",{type:"checkbox",checked:g.length&&s.size===g.length,onchange:P=>{for(let T of g){let R=T._id||T["DeviceID.ID"].value[0];P.target.checked?s.add(R):s.delete(R)}},disabled:!n});c.push(p("th",x))}for(let x=0;x<e.length;x++){let T=e[x].label;if(!i.hasOwnProperty(x)){c.push(p("th",T));continue}let R=ve("unsorted");i[x]>0?R=ve("sorted-asc"):i[x]<0&&(R=ve("sorted-dsc"));let L=p("button",{onclick:U=>{U.redraw=!1,o(x)}},R);c.push(p("th",[T,L]))}let m=[];for(let x of g){let P=x._id||x["DeviceID.ID"].value[0],T=[];if(u.length){let L=p("input",{type:"checkbox",checked:s.has(P),onchange:U=>{U.target.checked?s.add(P):s.delete(P)},onclick:U=>{U.stopPropagation(),U.redraw=!1}});T.push(p("td",L))}for(let L of e){let U={},F;if(typeof l=="function")F=l(L,x);else if(L.type==="code"){let W=x[L.id].split(`
`,11);W.length>10&&(W[10]=["\uFE19"]),U.title==null&&(U.title=W.join(`
`)),F=W[0]||""}else F=x[L.id];T.push(p("td",U,F))}let R=[];typeof h=="function"?(R=h(x),Array.isArray(R)||(R=[R])):Array.isArray(h)&&(R=h);for(let L of R)T.push(p("td.table-row-links",L));m.push(p("tr",{onclick:L=>{if(["INPUT","BUTTON","A"].includes(L.target.nodeName)){L.redraw=!1;return}s.delete(P)||s.add(P)}},T))}m.length||m.push(p("tr.empty",p("td",{colspan:c.length},"No records")));let y=[];n!=null?y.push(`${g.length}/${n}`):y.push(`${g.length}`),y.push(p("button",{title:"Show more records",onclick:r,disabled:!t.length||g.length>=Math.min(_u,n)},"More")),a&&y.push(p("a.download-csv",{href:a,download:""},"Download"));let E=p("tfoot",p("tr",p("td",{colspan:c.length},y))),C=[p("table.table.highlight",p("thead",p("tr",c)),p("tbody",m),E)];return u.length&&C.push(p("div.actions-bar",u)),C}var ju=()=>{let e=new Set,t,n=Hr(r=>{t(r)},500);return{view:r=>{let s=r.attrs.attributes,i=r.attrs.data,o=r.attrs.valueCallback,a=r.attrs.total,l=r.attrs.showMoreCallback,f=r.attrs.sortAttributes,h=r.attrs.onSortChange,g=r.attrs.downloadUrl,u=r.attrs.actionsCallback,c=r.attrs.recordActionsCallback,m=new Set;for(let y of i){let E=y._id||y["DeviceID.ID"].value[0];e.has(E)&&m.add(E)}return t=y=>{let E=new Set(Object.keys(f).map(C=>(parseInt(C)+1)*f[C]).filter(C=>C));for(let C of y)E.delete(C+1)?E.add(-(C+1)):E.delete((C+1)*-1)||E.add(C+1);h(Array.from(E).reverse())},e=m,zu(s,i,a,l,e,f,n,g,o,u,c)}}},Fe=ju;var Yr=Ue(qe());var Gr=class{constructor(t,n){this.callback=n,this.element=null,this.hideTimeout=null,this.visible=!1,this.default=null,this.selection=null,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.display="block",this.container.style.opacity="0",this.container.className=t}attach(t){t.setAttribute("autocomplete","off"),t.addEventListener("focus",()=>{this.element=t,this.update(),this.reposition()}),t.addEventListener("blur",()=>{this.element===t&&this.visible&&this.hide()}),t.addEventListener("keydown",n=>{this.element===t&&(n.key==="Escape"?this.visible&&this.hide():n.key==="Enter"?this.default!=null&&(t.value=this.default,n.stopImmediatePropagation(),t.dispatchEvent(new InputEvent("input")),this.update()):n.key==="ArrowDown"?(n.preventDefault(),this.selection==null?this.selection=0:++this.selection,this.update()):n.key==="ArrowUp"&&(n.preventDefault(),--this.selection,this.update()))}),t.addEventListener("input",()=>{this.element===t&&(this.selection=null,this.update())})}reposition(){if(!this.element)return;let t=this.element.getBoundingClientRect();if(!t.width){this.visible&&this.hide();return}this.container.style.left=`${t.left+window.scrollX}px`,this.container.style.width=`${t.width}px`,this.container.style.top=`${t.bottom+window.scrollY}px`}hide(){this.container.style.opacity="0",this.visible=!1,this.default=null,this.selection=null,clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{for(this.hideTimeout=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild);document.body.removeChild(this.container)},500)}update(){let t=this.element;this.callback(t.value,n=>{if(this.element!==t)return;if(this.default=null,!n.length){this.visible&&this.hide();return}for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild);this.visible||(this.hideTimeout?(clearTimeout(this.hideTimeout),this.hideTimeout=null):(document.body.appendChild(this.container),window.getComputedStyle(this.container).opacity),this.container.style.opacity="1",this.visible=!0),this.selection!=null?(this.selection=(this.selection%n.length+n.length)%n.length,this.default=n[this.selection].value):this.default=n[0].value;let r;for(let[s,i]of n.entries()){let o=document.createElement("div");i.tip&&(o.title=i.tip),o.classList.add("suggestion"),s===this.selection&&(o.classList.add("selected"),r=o);let a=document.createTextNode(i.value);o.appendChild(a),o.addEventListener("mousedown",l=>{l.preventDefault(),t.value=i.value,t.dispatchEvent(new InputEvent("input")),this.element===t&&this.update()}),this.container.appendChild(o)}r&&(this.container.scrollTop=Math.min(this.container.scrollTop,r.offsetTop),this.container.scrollTop=Math.max(this.container.scrollTop,r.offsetTop+r.scrollHeight-this.container.clientHeight))})}};var Ye={devices:{},faults:{Device:{parameter:["PARAM","device"],type:"string"},Channel:{parameter:["PARAM","channel"],type:"string"},Code:{parameter:["PARAM","code"],type:"string"},Retries:{parameter:["PARAM","retries"],type:"number"},Timestamp:{parameter:["PARAM","timestamp"],type:"timestamp"}},presets:{ID:{parameter:["PARAM","_id"],type:"string"},Channel:{parameter:["PARAM","channel"],type:"string"},Weight:{parameter:["PARAM","weight"],type:"number"}},provisions:{ID:{parameter:["PARAM","_id"],type:"string"}},virtualParameters:{ID:{parameter:["PARAM","_id"],type:"string"}},files:{ID:{parameter:["PARAM","_id"],type:"string"},Type:{parameter:["PARAM","metadata.fileType"],type:"string"},OUI:{parameter:["PARAM","metadata.oui"],type:"string"},"Product class":{parameter:["PARAM","metadata.productClass"],type:"string"},Version:{parameter:["PARAM","metadata.version"],type:"string"}},permissions:{Role:{parameter:["PARAM","role"],type:"string"},Resource:{parameter:["PARAM","resource"],type:"string"},Access:{parameter:["PARAM","access"],type:"number"}},users:{Username:{parameter:["PARAM","_id"],type:"string"}}};for(let e of Object.values(ue.ui.filters))Ye.devices[e.label]={parameter:e.parameter,type:(e.type||"").split(",").map(t=>t.trim())};function pa(e){return Ye[e]?Object.keys(Ye[e]):[]}function Uu(e,t){let n="=";for(let s of["<>","=","<=","<",">=",">"])if(t.startsWith(s)){n=s,t=t.slice(s.length).trim();break}let r=parseInt(t);return r!==+t?null:[n,e,r]}function qu(e,t){let n="=";for(let s of["<>","=","<=","<",">=",">"])if(t.startsWith(s)){n=s,t=t.slice(s.length).trim();break}let r=parseInt(t);return r!==+t&&(r=Date.parse(t)),isNaN(r)?null:[n,e,r]}function Bu(e,t){return["LIKE",["FUNC","LOWER",e],t.toLowerCase()]}function Vu(e,t){return["LIKE",e,t]}function Ls(e,t){return["OR",["LIKE",e,t.toLowerCase()],["LIKE",e,t.toUpperCase()]]}function Fu(e,t){return t=t.replace(/[^a-f0-9]/gi,"").toLowerCase(),t?t.length===12?["OR",["=",e,t.replace(/(..)(?!$)/g,"$1:").toLowerCase()],["=",e,t.replace(/(..)(?!$)/g,"$1:").toUpperCase()]]:["OR",["LIKE",["FUNC","LOWER",e],`%${t.replace(/(..)(?!$)/g,"$1:")}%`],["LIKE",["FUNC","LOWER",e],`%${t.replace(/(.)(.)/g,"$1:$2")}%`]]:null}function Qu(e,t){if(!/^[a-f0-9%]+$/i.test(t))return Ls(e,t);let r=t.split("%").map(o=>[o.replace(/..(?=.)/gi,"$&:"),o.replace(/(.)(.)/gi,"$1:$2")]),s=new Set;for(let o=0;o<2**r.length;++o){let a=r.map((l,f)=>l[o>>f&1]).join("%");/^[a-f0-9]:/i.test(a)||/:[a-f0-9]$/i.test(a)||(s.add(a.toLocaleLowerCase()),s.add(a.toUpperCase()))}if(!s.size)return Ls(e,t);let i=[...s].map(o=>["LIKE",e,o]);return i.length===1?i[0]:["OR",...i]}function Wu(e){return["IS NOT NULL",["PARAM",`Tags.${ta(e)}`]]}function ha(e,t){let n;if(Ye[e]?.[t]){let r=Ye[e][t],s=e==="devices"?r.type:r.type.split(","),i=[];for(let o of s)switch(o.trim()){case"string":i.push("case insensitive string pattern");break;case"string-casesensitive":i.push("case sensitive string pattern");break;case"string-monocase":i.push("case insensitive string pattern");break;case"number":i.push("numeric value");break;case"timestamp":i.push("Unix timestamp or string in the form YYYY-MM-DDTHH:mm:ss.sssZ");break;case"mac":i.push("partial case insensitive MAC address");break;case"mac-wildcard":i.push("case insensitive MAC address");break;case"tag":i.push("case sensitive string");break}i.length&&(n=`${t}: ${i.join(", ")}`)}return n}function $e(e,t,n){if(!Ye[e])return null;let r=Ye[e][t].type;n=n.trim();let s=["OR"];if(r.length===0||r.includes("number")){let i=Uu(Ye[e][t].parameter,n);i&&s.push(i)}if(r.length===0||r.includes("string")){let i=Bu(Ye[e][t].parameter,n);i&&s.push(i)}if(r.length===0||r.includes("timestamp")){let i=qu(Ye[e][t].parameter,n);i&&s.push(i)}if(r.includes("string-casesensitive")){let i=Vu(Ye[e][t].parameter,n);i&&s.push(i)}if(r.includes("string-monocase")){let i=Ls(Ye[e][t].parameter,n);i&&s.push(i)}if(r.includes("mac")){let i=Fu(Ye[e][t].parameter,n);i&&s.push(i)}if(r.includes("mac-wildcard")){let i=Qu(Ye[e][t].parameter,n);i&&s.push(i)}if(r.includes("tag")){let i=Wu(n);i&&s.push(i)}return s.length<=1?null:s.length===2?s[1]:s}function _s(e,t){if(!Array.isArray(e))throw new Error("Left-hand operand must be a parameter");if(e[0]!=="PARAM")throw new Error("Left-hand operand must be a parameter");if(typeof e[1]!="string")throw new Error("Left-hand operand must be a parameter");let n=e[1];if(t==="devices"){if(n==="DeviceID.ID")return"_id";if(n==="DeviceID")return"_deviceId";if(n.startsWith("DeviceID."))return"_deviceId._"+n.slice(9);if(n==="Events.Inform")return"_lastInform";if(n==="Events.Registered")return"_registered";if(n==="Events.0_BOOTSTRAP")return"_lastBootstrap";if(n==="Events.1_BOOT")return"_lastBoot";if(!n.endsWith("._value")&&!n.startsWith("Tags."))return`${n}._value`}return n}function da(e,t){if(t==="devices"){if(e==="_id")return["string"];if(e==="_lastInform")return["date"];if(e==="_registered")return["date"];if(e==="_lastBootstrap")return["date"];if(e==="_lastBoot")return["date"];if(e.startsWith("_deviceId."))return["string"];if(e==="Reboot._value")return["date"];if(e==="FactoryReset._value")return["date"];if(e.endsWith("_timestamp"))return["date"];if(e.startsWith("Downloads.")){if(e.endsWith("Download._value"))return["date"];if(e.endsWith("Time._value"))return["date"];if(e.endsWith("Name._value"))return["string"];if(e.endsWith("Type._value"))return["string"]}if(e.endsWith("_value"))return["bool","number","date","string"]}else if(t==="tasks"){if(e==="_id")return["oid"];if(e==="timestamp")return["date"];if(e==="expiry")return["date"];if(e==="name")return["string"];if(e==="device")return["string"]}else if(t==="faults"){if(e==="_id")return["string"];if(e==="timestamp")return["date"];if(e==="expiry")return["date"];if(e==="code")return["string"];if(e==="retries")return["number"];if(e==="channel")return["string"];if(e==="device")return["string"];if(e==="message")return["string"]}else if(t==="users"){if(e==="_id")return["string"];if(e==="roles")return["string"];if(e==="password")throw new Error("Cannot query restricted parameters");if(e==="salt")throw new Error("Cannot query restricted parameters")}else if(t==="config"){if(e==="_id")return["string"];if(e==="value")return["string"]}else if(t==="files"){if(e==="_id")return["string"];if(e==="metadata.fileType")return["string"];if(e==="metadata.oui")return["string"];if(e==="metadata.productClass")return["string"];if(e==="metadata.version")return["string"]}else if(t==="permissions"){if(e==="_id")return["string"];if(e==="role")return["string"];if(e==="resource")return["devices"];if(e==="access")return["number"];if(e==="filter")return["string"];if(e==="validate")return["string"]}else if(t==="presets"){if(e==="_id")return["string"];if(e==="weight")return["number"];if(e==="channel")return["string"];if(e==="precondition")return["string"];if(e.startsWith("events."))return["bool"]}else if(t==="provisions"){if(e==="_id")return["string"];if(e==="script")return["string"]}else if(t==="virtualParameters"){if(e==="_id")return["string"];if(e==="script")return["string"]}return e==="_id"?["oid","string"]:["bool","number","date","string"]}function Hu(e,t){let n=(e.match(/^[0-9a-f]*/)?.[0]??"").slice(0,24),r=ft("0x0"+n),s=0;e.length>n.length&&(s+=e.charCodeAt(n.length)),n.length<24&&(s-=48),s>0&&t&&r++,r<<=ft(4*(24-n.length)),s<0&&!t&&--r;let i=r.toString(16);return i.length>24||i.startsWith("-")?null:i.padStart(24,"0")}function ga(e,t){let n=new Map;for(let r of e){let s=t(r),i=n.get(s);i||n.set(s,i=[]),i.push(r)}return n.entries()}var wr=class{toString(){return JSON.stringify(this.toQuery(!0))}},zn=class extends wr{constructor(n,r){super();this.parameter=n;this.value=r}toQuery(n){return n?{[this.parameter]:{$eq:this.value}}:{[this.parameter]:{$ne:this.value}}}},fe=class extends wr{constructor(n,r,s,i){super();this.parameter=n;this.op=r;this.value=s;this.type=i}toQuery(n){let r=this.value;return this.type==="date"&&typeof r=="number"&&(r={$date:new Date(r).toISOString()}),this.type==="oid"&&typeof r=="string"&&(r={$oid:r}),n?{[this.parameter]:{[this.op]:r}}:this.op==="$eq"?{[this.parameter]:{$ne:r}}:{[this.parameter]:{$not:{[this.op]:r}}}}},Zt=class extends wr{constructor(n,r){super();this.parameter=n;this.type=r}toQuery(n){return n?{[this.parameter]:{$type:this.type}}:{[this.parameter]:{$not:{$type:this.type}}}}},jn=class extends wr{constructor(n,r,s,i){super();this.parameter=n;this.caseSensitive=i;this.pattern=lr(r,s)}pattern;toQuery(n){let r={"-":"\\-","/":"\\/","\\":"\\/","^":"\\^",$:"\\$","*":"\\*","+":"\\+","?":"\\?",".":"\\.","(":"\\(",")":"\\)","|":"\\|","[":"\\[","]":"\\]","{":"\\{","}":"\\}","\\%":".*","\\_":"."},s=this.pattern.map(l=>r[l]??l);s[0]=s[0]===".*"?"":"^"+s[0];let i=s.length-1;s[i]=[".*",""].includes(s[i])?"":s[i]+"$";let o=s.join(""),a=this.caseSensitive?"s":"is";return n?{[this.parameter]:{$regularExpression:{options:a,pattern:o}}}:{[this.parameter]:{$not:{$regularExpression:{options:a,pattern:o}}}}}},zs=class extends zr{constructor(n){super();this.collection=n}getMinterms(n,r){let s=n.expression();if(!Array.isArray(s))throw new Error("Invalid query expression");if(r===null){let i=[];for(let o of n.getNullables()){let a=o.operand.expression(),l=_s(a,this.collection);if(l.startsWith("Tags.")&&this.collection==="devices"){let h=Kr(l.slice(5)),g=new zn("_tags",h);i.push([this.getVar(g)<<1]);continue}let f=new fe(l,"$eq",null,"");i.push([this.getVar(f)<<1^1])}return i}if([">","<","="].includes(s[0])){let i=_s(s[1],this.collection),o=s[2];if(typeof o=="boolean")o=+o;else if(typeof o!="string"&&typeof o!="number")throw new Error("Right-hand operand must be a literal value");if(i.startsWith("Tags.")&&this.collection==="devices"&&s[0]==="="){let h=Kr(i.slice(5)),g=new zn("_tags",h);if(typeof o=="string"&&(o=2),s[0]==="="){if(o===1!==r)return[]}else if(s[0]===">"){if(r&&o>=1||!r&&o<1)return[]}else if(s[0]==="<"&&(r&&o<=1||!r&&o>1))return[];return[[this.getVar(g)<<1^1]]}let a;s[0]==="="?a="$eq":s[0]===">"?a=r?"$gt":"$lte":s[0]==="<"&&(a=r?"$lt":"$gte");let l=new Set(da(i,this.collection)),f=[];if(typeof o=="number")l.has("number")&&f.push(new fe(i,a,o,"number")),l.has("date")&&f.push(new fe(i,a,o,"date")),l.has("bool")&&(o===0||o===1)&&f.push(new fe(i,a,!!o,"bool"));else if(typeof o=="string"&&(l.has("string")&&f.push(new fe(i,a,o,"string")),l.has("oid"))){let h=Hu(o,a==="$lt"||a==="$lte");h&&(a!=="$eq"||h===o)&&f.push(new fe(i,a,h,"oid"))}return a==="$eq"&&!r?(f.push(new fe(i,"$eq",null,"")),[f.map(h=>this.getVar(h)<<1)]):(typeof o=="number"?(l.has("bool")&&(o>1&&(a==="$lt"||a==="$lte")||o<0&&(a==="$gt"||a==="$gte"))&&f.push(new fe(i,"$gte",!1,"bool")),(a==="$gt"||a==="$gte")&&(l.has("string")&&f.push(new fe(i,"$gte","","string")),l.has("oid")&&f.push(new fe(i,"$gte","000000000000000000000000","oid")))):typeof o=="string"&&(a==="$lt"||a==="$lte")&&(l.has("bool")&&f.push(new fe(i,"$gte",!1,"bool")),l.has("number")&&(f.push(new fe(i,"$gte",0,"number")),f.push(new fe(i,"$lt",0,"number"))),l.has("date")&&(f.push(new fe(i,"$gte",0,"date")),f.push(new fe(i,"$lt",0,"date")))),f.map(h=>[this.getVar(h)<<1^1]))}else if(s[0]==="LIKE"){let i=s[2];if(typeof i!="string")throw new Error("Right-hand operand of 'LIKE' must be a string");let o=s[1],a=!0;if(Array.isArray(o)&&o[0]==="FUNC"&&["UPPER","LOWER"].includes(o[1])){if(o[1]==="UPPER"&&i!==i.toUpperCase())return r?[]:[[]];if(o[1]==="LOWER"&&i!==i.toLowerCase())return r?[]:[[]];a=!1,o=o[2]}let l=_s(o,this.collection),f=new jn(l,i,s[3],a);if(r)return[[this.getVar(f)<<1^1]];let h=new Zt(l,"string");return[[this.getVar(f)<<1,this.getVar(h)<<1^1]]}else throw new Error("Invalid query expression")}getDcSet(n){let r=[],s=new Set(n.flat().map(o=>o>>1)),i=Array.from(s).map(o=>this.getClause(o));for(let[o,a]of ga(i,l=>l.parameter)){let l=a.filter(u=>u instanceof fe&&u.value!==null);for(let[u,c]of ga(l,m=>m.type)){let m=this.getVar(new Zt(o,u)),y=new Set(c.map(C=>C.value)),E=Array.from(y).sort((C,x)=>C>x?1:-1);for(let[C,x]of E.entries()){let P=this.getVar(new fe(o,"$eq",x,u)),T=this.getVar(new fe(o,"$gt",x,u)),R=this.getVar(new fe(o,"$lt",x,u)),L=this.getVar(new fe(o,"$gte",x,u)),U=this.getVar(new fe(o,"$lte",x,u));if(u==="bool"?x===!1?r.push([R<<1^1]):x===!0&&r.push([T<<1^1]):u==="string"?x===""&&r.push([R<<1^1]):u==="oid"&&(x<"000000000000000000000000"?r.push([U<<1^1]):x==="000000000000000000000000"?r.push([R<<1^1]):x>"ffffffffffffffffffffffff"?r.push([L<<1^1]):x==="ffffffffffffffffffffffff"&&r.push([T<<1^1])),r.push([R<<1^1,L<<1^1]),r.push([T<<1^1,L<<1^0]),r.push([P<<1^0,R<<1^0,U<<1^1]),r.push([P<<1^1,L<<1^0]),r.push([P<<1^1,T<<1^1]),C===0)r.push([m<<1^0,L<<1^1]),r.push([m<<1^0,R<<1^1]);else{let F=this.getVar(new fe(o,"$gt",E[C-1],u)),W=this.getVar(new fe(o,"$lte",E[C-1],u));r.push([F<<1^0,L<<1^1]),r.push([F<<1^0,W<<1^0,R<<1^1])}C===E.length-1&&r.push([m<<1^1,T<<1^0,U<<1^0])}}let f=a.filter(u=>u instanceof jn);if(f.length){let u=this.getVar(new Zt(o,"string"));for(let c=0;c<f.length;++c){let m=f[c],y=m.pattern;r.push([this.getVar(m)<<1^1,u<<1^0]);for(let E=c+1;E<f.length;++E){let C=f[E],x=C.pattern;(!m.caseSensitive||!C.caseSensitive)&&(y=y.map(P=>P.toLowerCase()),x=x.map(P=>P.toLowerCase())),vs(y,x)?r.push([this.getVar(m)<<1^1,this.getVar(C)<<1^1]):(!m.caseSensitive||C.caseSensitive)&&jr(y,x)?r.push([this.getVar(m)<<1^0,this.getVar(C)<<1^1]):(!C.caseSensitive||m.caseSensitive)&&jr(x,y)&&r.push([this.getVar(m)<<1^1,this.getVar(C)<<1^0])}}}let h=this.getVar(new fe(o,"$eq",null,"")),g=da(o,this.collection).map(u=>this.getVar(new Zt(o,u)));r.push([h<<1^0,...g.map(u=>u<<1^0)]);for(let u=0;u<g.length;++u){let c=g[u];r.push([c<<1^1,h<<1^1]);for(let m=u+1;m<g.length;++m){let y=g[m];r.push([c<<1^1,y<<1^1])}}o==="_id"&&r.push([h<<1^1])}return r}canRaise(n,r){if(!(n&1))return!0;let s=this.getClause(n>>1);if(s instanceof fe)for(let i of r){if(i===n)continue;let o=this.getClause(i>>1);if(o.parameter===s.parameter&&(!(i&1)||o instanceof Zt))return!1}return!0}toQuery(n){let r=[],s=["$oid","$date","$regularExpression"];for(let i of n){let o={};e:for(let a of i){if(!i.length)return{};let l=!!(a&1),h=this.getClause(a>>1).toQuery(l);if(Object.keys(h).length!==1)throw new Error("Invalid query expression");let[g,u]=Object.entries(h)[0],c=[o,...o.$and??[]];for(let m of c){if(!(g in m)){m[g]=u;continue e}let y=u,E=m[g];if(Object.getPrototypeOf(y).constructor!==Object||Object.getPrototypeOf(E).constructor!==Object)continue;let C=Object.keys(y),x=Object.keys(E);if([...C,...x].every(P=>P==="$not")){if(y=y.$not,E=E.$not,Object.getPrototypeOf(y).constructor!==Object||Object.getPrototypeOf(E).constructor!==Object)continue;C=Object.keys(y),x=Object.keys(E)}if(!C.some(P=>x.includes(P))&&!C.some(P=>s.includes(P))&&!x.some(P=>s.includes(P))){Object.assign(E,y);continue e}}o.$and??=[],o.$and.push({[g]:u})}r.push(o)}return r.length===1?r[0]:{$or:r}}};function ba(e,t){let n=oe.fromExpression(It(e)),r=new zs(t);n.true(r)}var ya=V(e=>{let t=pa(e);return new Gr("autocomplete",(r,s)=>{r=r.toLowerCase(),s(t.filter(i=>i.toLowerCase().includes(r)).map(i=>({value:`${i}: `,tip:ha(e,i)})))})});function Ku(e,t){let n;if(/^[\s0-9a-zA-Z]+:/.test(t)){let s=t.split(":",1)[0],i=t.slice(s.length+1).trim();n=["FUNC","Q",s.trim(),i]}else n=he(t);let r=ne(n,s=>{if(Array.isArray(s)&&s[0]==="FUNC"){if(s[1]==="Q")return $e(e,s[2],s[3]);if(s[1]==="NOW")return Date.now()}return s});return ba(r,e),n}function wa(e){return Array.isArray(e)&&e[0]==="FUNC"&&e[1]==="Q"?`${e[2]}: ${e[3]}`:J(e)}function va(e){if(!e)return[""];let t=[],n=he(e);if(Array.isArray(n)&&n[0]==="AND")for(let r of n.slice(1))t.push(wa(r));else t.push(wa(n));return t.push(""),t}var Ju=e=>{let t=va(e.attrs.filter),n=0,r=!1,s=e.attrs;function i(){r=!1,n=0,t=t.filter(a=>a);let o=t.map((a,l)=>{try{return Ku(s.resource,a)}catch{n|=1<<l}return null});if(t.push(""),n){Yr.default.redraw();return}o.length===0?s.onChange(""):o.length>1?s.onChange(J(["AND",...o])):s.onChange(J(o[0]))}return{onupdate:o=>{ya(o.attrs.resource).reposition()},view:o=>(s.filter!==o.attrs.filter&&(n=0,t=va(o.attrs.filter)),s=o.attrs,(0,Yr.default)("div.filter",[(0,Yr.default)("b","Filter"),...t.map((a,l)=>(0,Yr.default)("input",{type:"text",class:`${n>>l&1?"error":""}`,value:a,oninput:f=>{f.redraw=!1,t[l]=f.target.value,r=!0},oncreate:f=>{let h=f.dom;ya(o.attrs.resource).attach(h),h.addEventListener("blur",()=>{r&&i()}),h.addEventListener("keydown",g=>{g.key==="Enter"&&r&&i()})}}))]))}},Qe=Ju;var js=ue.ui.pageSize||10,Gu=V(he),Yu=V(JSON.parse),Ca=V(e=>{let t=Xi(e);if(t.length===1){let n=dt(t[0]);if(typeof n=="string")return n}return null}),Zu=V((e,t)=>{let n={};for(let r of t)n[G(r.label,null)]=J(r.parameter);return`api/devices.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(n)})}`}),Xu=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("devices",t[2],t[3]):t));function ec(e){return new Promise((t,n)=>{if(!window.authorizer.hasAccess("devices",2))return void n(new Error("You are not authorized to view this page"));let r=e.hasOwnProperty("filter")?""+e.filter:"",s=e.hasOwnProperty("sort")?""+e.sort:"",i=Object.values(ue.ui.index);i.length||i.push({label:"ID",parameter:["PARAM","DeviceID.ID"]}),t({filter:r,indexParameters:i,sort:s})})}function tc(e){let t=[];return t.push(p("button.primary",{title:"Reboot selected devices",disabled:!e.size,onclick:()=>{let n=[...e].map(r=>({name:"reboot",device:r}));Ve(...n)}},"Reboot")),t.push(p("button.critical",{title:"Factory reset selected devices",disabled:!e.size,onclick:()=>{let n=[...e].map(r=>({name:"factoryReset",device:r}));Ve(...n)}},"Reset")),t.push(p("button.critical",{title:"Push a firmware or a config file",disabled:!e.size,onclick:()=>{Mn({name:"download",devices:[...e]})}},"Push file")),t.push(p("button.primary",{title:"Delete selected devices",disabled:!e.size,onclick:()=>{let n=Array.from(e);if(!confirm(`Deleting ${n.length} devices. Are you sure?`))return;let r=1;for(let s of n)++r,ae("devices",s).then(()=>{I("success",`${s}: Deleted`),--r===0&&j(Date.now())}).catch(i=>{I("error",`${s}: ${i.message}`),--r===0&&j(Date.now())});--r===0&&j(Date.now())}},"Delete")),t.push(p("button.primary",{title:"Tag selected devices",disabled:!e.size,onclick:()=>{let n=Array.from(e),r=prompt(`Enter tag to assign to ${n.length} devices:`);if(!r)return;let s=1;for(let i of n)++s,yr(i,{[r]:!0}).then(()=>{I("success",`${i}: Tags updated`),--s===0&&j(Date.now())}).catch(o=>{I("error",`${i}: ${o.message}`),--s===0&&j(Date.now())});--s===0&&j(Date.now())}},"Tag")),t.push(p("button.primary",{title:"Untag selected devices",disabled:!e.size,onclick:()=>{let n=Array.from(e),r=prompt(`Enter tag to unassign from ${n.length} devices:`);if(!r)return;let s=1;for(let i of n)++s,yr(i,{[r]:!1}).then(()=>{I("success",`${i}: Tags updated`),--s===0&&j(Date.now())}).catch(o=>{I("error",`${i}: ${o.message}`),--s===0&&j(Date.now())});--s===0&&j(Date.now())}},"Untag")),t}var rc=()=>({view:e=>{document.title="Devices - GenieACS";let t=e.attrs.indexParameters;function n(){e.state.showCount=(e.state.showCount||js)+js,p.redraw()}function r(m){let y={filter:m};e.attrs.sort&&(y.sort=e.attrs.sort),p.route.set("/devices",y)}let s=e.attrs.sort?Yu(e.attrs.sort):{},i={};for(let m=0;m<t.length;m++){let y=t[m];if(y.unsortable)continue;let E=Ca(y.parameter);E&&(i[m]=s[E]||0)}function o(m){let y={};for(let C of m){let x=Ca(t[Math.abs(C)-1].parameter);y[x]=Math.sign(C)}let E={sort:JSON.stringify(y)};e.attrs.filter&&(E.filter=e.attrs.filter),p.route.set("/devices",E)}let a=e.attrs.filter?Gu(e.attrs.filter):!0;a=Xu(a);let l=pe("devices",a,{limit:e.state.showCount||js,sort:s}),f=Re("devices",a),h=Zu(a,t),g=(m,y)=>p.context({device:y,parameter:m.parameter},m.type||"parameter",m),u={};u.attributes=t.map(m=>({...m,label:G(m.label,null),type:G(m.type,null)})),u.data=l.value,u.total=f.value,u.showMoreCallback=n,u.sortAttributes=i,u.onSortChange=o,u.downloadUrl=h,u.valueCallback=g,u.recordActionsCallback=m=>p("a",{href:`#!/devices/${encodeURIComponent(m["DeviceID.ID"].value[0])}`},"Show"),window.authorizer.hasAccess("devices",3)&&(u.actionsCallback=tc);let c={resource:"devices",filter:e.attrs.filter,onChange:r};return[p("h1","Listing devices"),p(Qe,c),p("loading",{queries:[l,f]},p(Fe,u))]}});var Un={};nt(Un,{component:()=>sc,init:()=>nc});function nc(e){return window.authorizer.hasAccess("devices",2)?Promise.resolve({deviceId:e.id,deviceFilter:["=",["PARAM","DeviceID.ID"],e.id],tab:e.tab}):Promise.reject(new Error("You are not authorized to view this page"))}var sc=()=>({view:e=>{document.title=`${e.attrs.deviceId} - Device ${e.attrs.tab} - GenieACS`;let t=pe("devices",e.attrs.deviceFilter);if(!t.value.length)return t.fulfilling?p("loading",{queries:[t]},p("div",{style:"height: 100px;"})):p("p.error",`No such device ${e.attrs.deviceId}`);let n=ue.ui.device,r=ue.ui.multiTabs,s=[];if(Object.keys(r).length>0){let i={[e.attrs.tab||r[0].route]:"active"},o=[],a=[],l=encodeURIComponent(e.attrs.deviceId).replace(/-/g,"%2D");for(let[f,h]of Object.entries(r))if(o.push(p("li",{class:i[h.route]},[p("a",{href:`#!/devices/${l}/${h.route}`},h.label)])),i[h.route])for(let g of Object.values(h.components))a.push(p.context({device:t.value[0],deviceQuery:t},g.type,g));s.push(p("div.tab",[p("ul",o),p("div.tab_content",a)]))}else for(let i of Object.values(n))s.push(p.context({device:t.value[0],deviceQuery:t},G(i.type,null),i));return[p("h1",e.attrs.deviceId),s]}});var Ea=()=>({view:function(e){return document.title="Error! - GenieACS",p("p.error",e.attrs.error)}});var Bs={};nt(Bs,{component:()=>mc,init:()=>fc});var qs=ue.ui.pageSize||10,oc=V(he),ac=V(JSON.parse),Zr=[{id:"device",label:"Device"},{id:"channel",label:"Channel"},{id:"code",label:"Code"},{id:"message",label:"Message"},{id:"detail",label:"Detail"},{id:"retries",label:"Retries"},{id:"timestamp",label:"Timestamp"}],lc=V(e=>{let t={};for(let n of Zr)t[n.label]=n.id==="timestamp"?`DATE_STRING(${n.id})`:n.id;return`api/faults.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(t)})}`}),uc=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("faults",t[2],t[3]):t));async function cc(e){let t=new Map;for(let n of e){let r=n.split(":",1)[0],s=t.get(r);s==null?s=ae("faults",n):s=s.then(()=>ae("faults",n)),t.set(r,s)}await Promise.all(t.values())}function fc(e){if(!window.authorizer.hasAccess("faults",2))return Promise.reject(new Error("You are not authorized to view this page"));let t=e.hasOwnProperty("sort")?""+e.sort:"",n=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:n,sort:t})}var mc=()=>({view:e=>{document.title="Faults - GenieACS";function t(){e.state.showCount=(e.state.showCount||qs)+qs,p.redraw()}function n(c){let m={filter:c};e.attrs.sort&&(m.sort=e.attrs.sort),p.route.set("/faults",m)}let r=e.attrs.sort?ac(e.attrs.sort):{},s={};for(let c=0;c<Zr.length;c++){let m=Zr[c];m.id!=="detail"&&(s[c]=r[m.id]||0)}function i(c){let m={};for(let E of c)m[Zr[Math.abs(E)-1].id]=Math.sign(E);let y={sort:JSON.stringify(m)};e.attrs.filter&&(y.filter=e.attrs.filter),p.route.set("/faults",y)}let o=e.attrs.filter?oc(e.attrs.filter):!0;o=uc(o);let a=pe("faults",o,{limit:e.state.showCount||qs,sort:r}),l=Re("faults",o),f=lc(o),h=(c,m)=>{if(c.id==="device"){let y=`#!/devices/${encodeURIComponent(m.device)}`;return p("a",{href:y},m.device)}return c.id==="message"?p("long-text",{text:m.message}):c.id==="detail"?p("long-text",{text:Nn(m.detail)}):c.id==="timestamp"?new Date(m.timestamp).toLocaleString():m[c.id]},g={};g.attributes=Zr,g.data=a.value,g.valueCallback=h,g.total=l.value,g.showMoreCallback=t,g.sortAttributes=s,g.onSortChange=i,g.downloadUrl=f,window.authorizer.hasAccess("faults",3)&&(g.actionsCallback=c=>p("button.primary",{disabled:c.size===0,title:"Delete selected faults",onclick:m=>{if(m.redraw=!1,m.target.disabled=!0,!confirm(`Deleting ${c.size} faults. Are you sure?`))return;let y=c.size;cc(c).then(()=>{I("success",`${y} faults deleted`),j(Date.now())}).catch(E=>{I("error",E.message),j(Date.now())})}},"Delete"));let u={resource:"faults",filter:e.attrs.filter,onChange:n};return[p("h1","Listing faults"),p(Qe,u),p("loading",{queries:[a,l]},p(Fe,g))]}});var Fs={};nt(Fs,{component:()=>vc,init:()=>wc});var qn,Xr,Aa;function xa(){Aa||(Aa=I("error","Error loading JS resource, please reload the page",{Reload:()=>{window.location.reload()}}))}function vr(){return qn?Promise.resolve():new Promise((e,t)=>{let n=[import("./codemirror-7ZC5WRRP.js"),import("./javascript-WJCVEMHZ.js"),import("./yaml-NFU4FGBY.js")];Promise.all(n).then(r=>{qn=r[0].default,e()}).catch(r=>{xa(),t(r)})})}function Sa(){return Xr?Promise.resolve():new Promise((e,t)=>{import("./yaml-M3OCVU6P.js").then(n=>{Xr=n.default,e()}).catch(n=>{xa(),t(n)})})}var pc=()=>({view:e=>p("textarea",{name:e.attrs.id,value:e.attrs.value,oncreate:t=>{let n=qn.fromTextArea(t.dom,{mode:e.attrs.mode,lineNumbers:!0,readOnly:e.attrs.readOnly,extraKeys:{"Ctrl-Enter":()=>{e.attrs.onSubmit&&e.attrs.onSubmit(t.dom)},"Cmd-Enter":()=>{e.attrs.onSubmit&&e.attrs.onSubmit(t.dom)}}});e.attrs.onChange&&n.on("change",r=>{e.attrs.onChange(r.getValue())}),e.attrs.focus&&n.focus(),e.attrs.onReady&&e.attrs.onReady(n)}})}),Bn=pc;var Pa={presets:"preset",provisions:"provision",virtualParameters:"virtual parameter",files:"file",users:"user",permissions:"permission"};function hc(e,t,n){if(t.type==="combo"){let s="",i=t.options;e.object[t.id]!=null&&(i.includes(e.object[t.id])||(i=i.concat([e.object[t.id]])),s=e.object[t.id]);let o=[p("option",{value:""},"")];for(let a of i)o.push(p("option",{value:a},a));return p("select",{name:t.id,value:s,oncreate:n?a=>{a.dom.focus()}:null,onchange:a=>{e.object[t.id]=a.target.value,e.modified=!0,a.redraw=!1}},o)}else if(t.type==="multi"){let s=Array.from(new Set(t.options.concat(e.object[t.id]||[]))),i=new Set(e.object[t.id]),o=s.map(a=>{let f={type:"checkbox",id:`${t.id}-${a}`,value:a,oncreate:h=>{n&&!o.length&&h.dom.focus(),i.has(a)&&(h.dom.checked=!0)},onchange:h=>{h.target.checked?i.add(a):i.delete(a),e.object[t.id]=Array.from(i),e.modified=!0,h.redraw=!1}};return p("tr",[p("td",p("input",f)),p("td",a)])});return p("table",o)}else if(t.type==="code"){let s={id:t.id,value:e.object[t.id],mode:"javascript",onSubmit:i=>{i.form.querySelector("button[type=submit]").click()},onChange:i=>{e.object[t.id]=i,e.modified=!0}};return p(Bn,s)}else{if(t.type==="file")return p("input",{type:"file",name:t.id,oncreate:n?s=>{s.dom.focus()}:null,onchange:s=>{e.object[t.id]=s.target.files,e.modified=!0,s.redraw=!1}});if(t.type==="textarea")return p("textarea",{name:t.id,value:e.object[t.id],readonly:t.id==="_id"&&!e.isNew,cols:t.cols||80,rows:t.rows||4,style:"resize: none;",oncreate:n?s=>{let i=s.dom;i.focus(),i.setSelectionRange(i.value.length,i.value.length)}:null,oninput:s=>{e.object[t.id]=s.target.value,e.modified=!0,s.redraw=!1},onkeypress:s=>(s.redraw=!1,s.which===13&&!s.shiftKey?(s.target.form.querySelector("button[type=submit]").click(),!1):!0)})}let r=null;return t.options&&(r=Bo(t.options)),p("input",{type:t.type==="password"?"password":"text",name:t.id,list:r,autocomplete:r?"off":null,disabled:t.id==="_id"&&!e.isNew,value:e.object[t.id],oncreate:n?s=>{s.dom.focus()}:null,oninput:s=>{e.object[t.id]=s.target.value,e.modified=!0,s.redraw=!1}})}var dc=()=>({view:e=>{let t=e.attrs.actionHandler,n=e.attrs.attributes,r=e.attrs.resource,s=e.attrs.base||{};e.state.current||(e.state.current={isNew:!s._id,object:Object.assign({},s),modified:!1});let i=e.state.current,o=[],a=!1;for(let g of n){let u=!1;!a&&(i.isNew||g.id!=="_id")&&(u=a=!0),o.push(p("p",p("label",{for:g.id},g.label||g.id),p("br"),hc(i,g,u)))}let l=p("button.primary",{type:"submit"},"Save"),f=[l];i.isNew||f.push(p("button.primary",{type:"button",title:`Delete ${Pa[r]||r}`,onclick:g=>{g.redraw=!1,g.target.disabled=!0,t("delete",i.object).finally(()=>{g.target.disabled=!1})}},"Delete")),o.push(p(".actions-bar",f));let h=[p("h1",`${i.isNew?"New":"Editing"} ${Pa[r]||r}`),p("form",{onsubmit:g=>{g.redraw=!1,g.preventDefault(),l.dom.disabled=!0,t("save",i.object).finally(()=>{l.dom.disabled=!1})}},o)];return p("div.put-form",h)}}),Pe=dc;var Vs=ue.ui.pageSize||10,Ta=V(he),gc=V(JSON.parse),Xt=[{id:"_id",label:"Name"},{id:"channel",label:"Channel"},{id:"weight",label:"Weight"},{id:"schedule",label:"Schedule"},{id:"events",label:"Events"},{id:"precondition",label:"Precondition",type:"textarea"},{id:"provision",label:"Provision",type:"combo"},{id:"provisionArgs",label:"Arguments",type:"textarea"}],bc=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("presets",t[2],t[3]):t));function ka(e,t,n){return new Promise((r,s)=>{let i=Object.assign({},t);if(e==="save"){let o=i._id;delete i._id;let a={};if(o||(a._id="ID can not be empty"),i.provision||(a.provision="Provision not selected"),Object.keys(a).length)return void r(a);if(i.precondition)try{i.precondition=J(Ta(i.precondition))}catch{return void r({precondition:"Precondition must be valid expression"})}Ge("presets",o).then(l=>{if(l&&n)return j(Date.now()),void r({_id:"Preset already exists"});if(!l&&!n)return j(Date.now()),void r({_id:"Preset does not exist"});Je("presets",o,i).then(()=>{I("success",`Preset ${l?"updated":"created"}`),j(Date.now()),r(null)}).catch(s)}).catch(s)}else e==="delete"?ae("presets",i._id).then(()=>{I("success","Preset deleted"),j(Date.now()),r(null)}).catch(o=>{s(o),j(Date.now())}):s(new Error("Undefined action"))})}var Ia={resource:"presets",attributes:Xt},yc=V(e=>{let t={};for(let n of Xt)t[n.label]=n.id;return`api/presets.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(t)})}`});function wc(e){if(!window.authorizer.hasAccess("presets",2))return Promise.reject(new Error("You are not authorized to view this page"));let t=e.hasOwnProperty("sort")?""+e.sort:"",n=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:n,sort:t})}var vc=()=>({view:e=>{document.title="Presets - GenieACS";function t(){e.state.showCount=(e.state.showCount||Vs)+Vs,p.redraw()}function n(C){let x={filter:C};e.attrs.sort&&(x.sort=e.attrs.sort),p.route.set("/admin/presets",x)}let r=e.attrs.sort?gc(e.attrs.sort):{},s={};for(let C=0;C<Xt.length;C++){let x=Xt[C];x.id==="events"||x.id==="precondition"||x.id==="provision"||x.id==="provisionArgs"||(s[C]=r[x.id]||0)}function i(C){let x={};for(let T of C)x[Xt[Math.abs(T)-1].id]=Math.sign(T);let P={sort:JSON.stringify(x)};e.attrs.filter&&(P.filter=e.attrs.filter),p.route.set("/admin/presets",P)}let o=e.attrs.filter?Ta(e.attrs.filter):!0;o=bc(o);let a=pe("presets",o,{limit:e.state.showCount||Vs,sort:r}),l=Re("presets",o),f=new Set,h=new Set(["refresh","value","tag","reboot","reset","download","instances"]),g=pe("provisions",!0);if(g.fulfilled)for(let C of g.value)f.add(C._id),h.add(C._id);let u=Xt.find(C=>C.id==="provision");u.options=Array.from(h);let c=yc(o),m=(C,x)=>{if(C.id==="precondition"){let P="#!/devices";return x.precondition.length&&(P+=`?${p.buildQueryString({filter:x.precondition})}`),p("a",{href:P,title:x.precondition},x.precondition)}else return C.id==="provision"&&f.has(x[C.id])?p("a",{href:`#!/admin/provisions?${p.buildQueryString({filter:`Q("ID", "${x.provision}")`})}`},x.provision):x[C.id]},y={};y.attributes=Xt,y.data=a.value,y.total=l.value,y.showMoreCallback=t,y.sortAttributes=s,y.onSortChange=i,y.downloadUrl=c,y.valueCallback=m,y.recordActionsCallback=C=>[p("a",{onclick:()=>{let x=null,P=p(Pe,Object.assign({base:C,actionHandler:(T,R)=>new Promise(L=>{ka(T,R,!1).then(U=>{let F=U?Object.values(U):[];if(F.length)for(let W of F)I("error",W);else le(x);L()}).catch(U=>{I("error",U.message),L()})})},Ia));x=()=>C.provision?P:p("div",{style:"margin:20px"},"This UI only supports presets with a single 'provision' configuration. If this preset was originally created from the old UI (genieacs-gui), you must edit it there."),ge(x,()=>!P.state?.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"Show")],window.authorizer.hasAccess("presets",3)&&(y.actionsCallback=C=>[p("button.primary",{title:"Create new preset",onclick:()=>{let x=null,P=p(Pe,Object.assign({actionHandler:(T,R)=>new Promise(L=>{ka(T,R,!0).then(U=>{let F=U?Object.values(U):[];if(F.length)for(let W of F)I("error",W);else le(x);L()}).catch(U=>{I("error",U.message),L()})})},Ia));x=()=>P,ge(x,()=>!P.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"New"),p("button.primary",{title:"Delete selected presets",disabled:!C.size,onclick:x=>{confirm(`Deleting ${C.size} presets. Are you sure?`)&&(x.redraw=!1,x.target.disabled=!0,Promise.all(Array.from(C).map(P=>ae("presets",P))).then(P=>{I("success",`${P.length} presets deleted`),j(Date.now())}).catch(P=>{I("error",P.message),j(Date.now())}))}},"Delete")]);let E={resource:"presets",filter:e.attrs.filter,onChange:n};return[p("h1","Listing presets"),p(Qe,E),p("loading",{queries:[a,l]},p(Fe,y))]}});var Ws={};nt(Ws,{component:()=>Pc,init:()=>Sc});var Qs=ue.ui.pageSize||10,Cc=V(he),Ec=V(JSON.parse),Cr=[{id:"_id",label:"Name"},{id:"script",label:"Script",type:"code"}],Ac=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("provisions",t[2],t[3]):t));function Ma(e,t,n){return new Promise((r,s)=>{let i=Object.assign({},t);if(e==="save"){let o=i._id;if(delete i._id,!o)return void r({_id:"ID can not be empty"});Ge("provisions",o).then(a=>{if(a&&n)return j(Date.now()),void r({_id:"Provision already exists"});if(!a&&!n)return j(Date.now()),void r({_id:"Provision does not exist"});Je("provisions",o,i).then(()=>{I("success",`Provision ${a?"updated":"created"}`),j(Date.now()),r(null)}).catch(l=>{if(l.code===400&&l.response){s(new Error(l.response));return}s(l)})}).catch(s)}else e==="delete"?ae("provisions",i._id).then(()=>{I("success","Provision deleted"),j(Date.now()),r(null)}).catch(o=>{j(Date.now()),s(o)}):s(new Error("Undefined action"))})}var Oa={resource:"provisions",attributes:Cr},xc=V(e=>{let t={};for(let n of Cr)t[n.label]=n.id;return`api/provisions.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(t)})}`});function Sc(e){if(!window.authorizer.hasAccess("provisions",2))return Promise.reject(new Error("You are not authorized to view this page"));let t=e.hasOwnProperty("sort")?""+e.sort:"",n=e.hasOwnProperty("filter")?""+e.filter:"";return new Promise((r,s)=>{vr().then(()=>{r({filter:n,sort:t})}).catch(s)})}var Pc=()=>({view:e=>{document.title="Provisions - GenieACS";function t(){e.state.showCount=(e.state.showCount||Qs)+Qs,p.redraw()}function n(u){let c={filter:u};e.attrs.sort&&(c.sort=e.attrs.sort),p.route.set("/admin/provisions",c)}let r=e.attrs.sort?Ec(e.attrs.sort):{},s={};for(let u=0;u<Cr.length;u++)s[u]=r[Cr[u].id]||0;function i(u){let c={};for(let y of u)c[Cr[Math.abs(y)-1].id]=Math.sign(y);let m={sort:JSON.stringify(c)};e.attrs.filter&&(m.filter=e.attrs.filter),p.route.set("/admin/provisions",m)}let o=e.attrs.filter?Cc(e.attrs.filter):!0;o=Ac(o);let a=pe("provisions",o,{limit:e.state.showCount||Qs,sort:r}),l=Re("provisions",o),f=xc(o),h={};h.attributes=Cr,h.data=a.value,h.total=l.value,h.showMoreCallback=t,h.sortAttributes=s,h.onSortChange=i,h.downloadUrl=f,h.recordActionsCallback=u=>[p("a",{onclick:()=>{let c=null,m=p(Pe,Object.assign({base:u,actionHandler:(y,E)=>new Promise(C=>{Ma(y,E,!1).then(x=>{let P=x?Object.values(x):[];if(P.length)for(let T of P)I("error",T);else le(c);C()}).catch(x=>{I("error",x.message),C()})})},Oa));c=()=>m,ge(c,()=>!m.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"Show")],window.authorizer.hasAccess("provisions",3)&&(h.actionsCallback=u=>[p("button.primary",{title:"Create new provision",onclick:()=>{let c=null,m=p(Pe,Object.assign({actionHandler:(y,E)=>new Promise(C=>{Ma(y,E,!0).then(x=>{let P=x?Object.values(x):[];if(P.length)for(let T of P)I("error",T);else le(c);C()}).catch(x=>{I("error",x.message),C()})})},Oa));c=()=>m,ge(c,()=>!m.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"New"),p("button.primary",{title:"Delete selected provisions",disabled:!u.size,onclick:c=>{confirm(`Deleting ${u.size} provisions. Are you sure?`)&&(c.redraw=!1,c.target.disabled=!0,Promise.all(Array.from(u).map(m=>ae("provisions",m))).then(m=>{I("success",`${m.length} provisions deleted`),j(Date.now())}).catch(m=>{I("error",m.message),j(Date.now())}))}},"Delete")]);let g={resource:"provisions",filter:e.attrs.filter,onChange:n};return[p("h1","Listing provisions"),p(Qe,g),p("loading",{queries:[a,l]},p(Fe,h))]}});var Ks={};nt(Ks,{component:()=>Dc,init:()=>Oc});var Hs=ue.ui.pageSize||10,kc=V(he),Ic=V(JSON.parse),Er=[{id:"_id",label:"Name"},{id:"script",label:"Script",type:"code"}],Tc=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("virtualParameters",t[2],t[3]):t));function Da(e,t,n){return new Promise((r,s)=>{let i=Object.assign({},t);if(e==="save"){let o=i._id;if(delete i._id,!o)return void r({_id:"ID can not be empty"});Ge("virtualParameters",o).then(a=>{if(a&&n)return j(Date.now()),void r({_id:"Virtual parameter already exists"});if(!a&&!n)return j(Date.now()),void r({_id:"Virtual parameter does not exist"});Je("virtualParameters",o,i).then(()=>{I("success",`Virtual parameter ${a?"updated":"created"}`),j(Date.now()),r(null)}).catch(l=>{if(l.code===400&&l.response){s(new Error(l.response));return}s(l)})}).catch(s)}else e==="delete"?ae("virtualParameters",i._id).then(()=>{I("success","Virtual parameter deleted"),j(Date.now()),r(null)}).catch(o=>{j(Date.now()),s(o)}):s(new Error("Undefined action"))})}var Na={resource:"virtualParameters",attributes:Er},Mc=V(e=>{let t={};for(let n of Er)t[n.label]=n.id;return`api/virtualParameters.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(t)})}`});function Oc(e){if(!window.authorizer.hasAccess("virtualParameters",2))return Promise.reject(new Error("You are not authorized to view this page"));let t=e.hasOwnProperty("sort")?""+e.sort:"",n=e.hasOwnProperty("filter")?""+e.filter:"";return new Promise((r,s)=>{vr().then(()=>{r({filter:n,sort:t})}).catch(s)})}var Dc=()=>({view:e=>{document.title="Virtual Parameters - GenieACS";function t(){e.state.showCount=(e.state.showCount||Hs)+Hs,p.redraw()}function n(u){let c={filter:u};e.attrs.sort&&(c.sort=e.attrs.sort),p.route.set("/admin/virtualParameters",c)}let r=e.attrs.sort?Ic(e.attrs.sort):{},s={};for(let u=0;u<Er.length;u++)s[u]=r[Er[u].id]||0;function i(u){let c={};for(let y of u)c[Er[Math.abs(y)-1].id]=Math.sign(y);let m={sort:JSON.stringify(c)};e.attrs.filter&&(m.filter=e.attrs.filter),p.route.set("/admin/virtualParameters",m)}let o=e.attrs.filter?kc(e.attrs.filter):!0;o=Tc(o);let a=pe("virtualParameters",o,{limit:e.state.showCount||Hs,sort:r}),l=Re("virtualParameters",o),f=Mc(o),h={};h.attributes=Er,h.data=a.value,h.total=l.value,h.showMoreCallback=t,h.sortAttributes=s,h.onSortChange=i,h.downloadUrl=f,h.recordActionsCallback=u=>[p("a",{onclick:()=>{let c=null,m=p(Pe,Object.assign({base:u,actionHandler:(y,E)=>new Promise(C=>{Da(y,E,!1).then(x=>{let P=x?Object.values(x):[];if(P.length)for(let T of P)I("error",T);else le(c);C()}).catch(x=>{I("error",x.message),C()})})},Na));c=()=>m,ge(c,()=>!m.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"Show")],window.authorizer.hasAccess("virtualParameters",3)&&(h.actionsCallback=u=>[p("button.primary",{title:"Create new virtual parameter",onclick:()=>{let c=null,m=p(Pe,Object.assign({actionHandler:(y,E)=>new Promise(C=>{Da(y,E,!0).then(x=>{let P=x?Object.values(x):[];if(P.length)for(let T of P)I("error",T);else le(c);C()}).catch(x=>{I("error",x.message),C()})})},Na));c=()=>m,ge(c,()=>!m.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"New"),p("button.primary",{title:"Delete selected virtual parameters",disabled:!u.size,onclick:c=>{confirm(`Deleting ${u.size} virtual parameters. Are you sure?`)&&(c.redraw=!1,c.target.disabled=!0,Promise.all(Array.from(u).map(m=>ae("virtualParameters",m))).then(m=>{I("success",`${m.length} virtual parameters deleted`),j(Date.now())}).catch(m=>{I("error",m.message),j(Date.now())}))}},"Delete")]);let g={resource:"virtualParameters",filter:e.attrs.filter,onChange:n};return[p("h1","Listing virtual parameters"),p(Qe,g),p("loading",{queries:[a,l]},p(Fe,h))]}});var Gs={};nt(Gs,{component:()=>Uc,init:()=>jc});var Js=ue.ui.pageSize||10,Nc=V(he),Rc=V(JSON.parse),Ar=[{id:"_id",label:"Name"},{id:"metadata.fileType",label:"Type",options:["1 Firmware Upgrade Image","2 Web Content","3 Vendor Configuration File","4 Tone File","5 Ringer File"]},{id:"metadata.oui",label:"OUI"},{id:"metadata.productClass",label:"Product Class"},{id:"metadata.version",label:"Version"}],$c={resource:"files",attributes:Ar.slice(1).concat([{id:"file",label:"File",type:"file"}])},Lc=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("files",t[2],t[3]):t));function _c(e,t,n,r){return t=Object.assign({"Content-Type":"application/octet-stream"},t),Ke({method:"PUT",headers:t,url:`api/files/${encodeURIComponent(e.name)}`,serialize:s=>s,body:e,config:s=>{r&&s.upload.addEventListener("progress",r),n&&(n.aborted&&s.abort(),n.addEventListener("abort",()=>s.abort()))}})}var zc=V(e=>{let t={};for(let n of Ar)t[n.label]=n.id;return`api/files.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(t)})}`});function jc(e){if(!window.authorizer.hasAccess("files",2))return Promise.reject(new Error("You are not authorized to view this page"));let t=e.hasOwnProperty("sort")?""+e.sort:"",n=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:n,sort:t})}var Uc=()=>({view:e=>{document.title="Files - GenieACS";function t(){e.state.showCount=(e.state.showCount||Js)+Js,p.redraw()}function n(u){let c={filter:u};e.attrs.sort&&(c.sort=e.attrs.sort),p.route.set("/admin/files",c)}let r=e.attrs.sort?Rc(e.attrs.sort):{},s={};for(let u=0;u<Ar.length;u++)s[u]=r[Ar[u].id]||0;function i(u){let c={};for(let y of u)c[Ar[Math.abs(y)-1].id]=Math.sign(y);let m={sort:JSON.stringify(c)};e.attrs.filter&&(m.filter=e.attrs.filter),p.route.set("/admin/files",m)}let o=e.attrs.filter?Nc(e.attrs.filter):!0;o=Lc(o);let a=pe("files",o,{limit:e.state.showCount||Js,sort:r}),l=Re("files",o),f=zc(o),h={};h.attributes=Ar,h.data=a.value,h.total=l.value,h.showMoreCallback=t,h.sortAttributes=s,h.onSortChange=i,h.downloadUrl=f,h.recordActionsCallback=u=>[p("a",{href:"api/blob/files/"+u._id},"Download")],window.authorizer.hasAccess("files",3)&&(h.actionsCallback=u=>[p("button.primary",{title:"Create new file",onclick:()=>{let c=null,m=new AbortController,y=-1,E=p(Pe,Object.assign({actionHandler:async(C,x)=>{if(C!=="save")throw new Error("Undefined action");let P=x.file?.[0],T={"metadata-fileType":x["metadata.fileType"]||"","metadata-oui":x["metadata.oui"]||"","metadata-productclass":x["metadata.productClass"]||"","metadata-version":x["metadata.version"]||""};if(!P){I("error","File not selected");return}if(await Ge("files",P.name)){j(Date.now()),I("error","File already exists");return}let R=L=>{y=L.loaded/L.total,p.redraw()};y=0;try{await _c(P,T,m.signal,R),j(Date.now()),I("success","File created"),le(c)}catch(L){I("error",L.message)}y=-1}},$c));c=()=>y<0?[null,E]:[p("div.progress",p("div.progress-bar",{style:`width: ${Math.trunc(y*100)}%`})),E],ge(c,()=>E.state.current.modified&&!confirm("You have unsaved changes. Close anyway?")?!1:(m.abort(),!0))}},"New"),p("button.primary",{title:"Delete selected files",disabled:!u.size,onclick:c=>{confirm(`Deleting ${u.size} files. Are you sure?`)&&(c.redraw=!1,c.target.disabled=!0,Promise.all(Array.from(u).map(m=>ae("files",m))).then(m=>{I("success",`${m.length} files deleted`),j(Date.now())}).catch(m=>{I("error",m.message),j(Date.now())}))}},"Delete")]);let g={resource:"files",filter:e.attrs.filter,onChange:n};return[p("h1","Listing files"),p(Qe,g),p("loading",{queries:[a,l]},p(Fe,h))]}});var Xs={};nt(Xs,{component:()=>Kc,init:()=>Wc});function Ra(e){let t={},n=(r,s)=>{for(let[i,o]of Object.entries(r)){let a=s?`${s}.${i}`:i;o!==void 0&&(o===null||typeof o!="object"?t[a]=o:n(o,a))}};return e!==null&&typeof e=="object"&&n(e,""),t}function Ys(e){let t=1;if(e==null||typeof e!="object")return t;if(Array.isArray(e)){for(let r of e)t+=Ys(r);return t}let n=Object.entries(e).map(([r,s])=>[r,Ys(s)]);n.sort((r,s)=>r[1]!==s[1]?r[1]-s[1]:s[0]>r[0]?-1:1);for(let[r,s]of n){t+=s;let i=e[r];delete e[r],e[r]=i}return t}function $a(e){e.sort((s,i)=>s._id>i._id?1:s._id<i._id?-1:0);let t={};for(let s of e){let i=s._id.split("."),o=t;for(;i.length>1;){let a=i.shift();(o[a]==null||typeof o[a]!="object")&&(o[a]={}),o=o[a]}o[i[0]]=s.value}let n=function(s){if(s==null||typeof s!="object")return s;if(Object.keys(s).length<=300){let a=[];for(let f of Object.keys(s)){let h=Math.floor(+f);if(h>=0&&h<300&&String(h)===f){let g=Math.floor(h/30);a[g]||(a[g]=0),a[g]|=1<<h%30}else{a=[];break}}let l=0;for(;a.length&&(l=a.shift())===1073741823;);if(l&&(~l&l+1)===l+1){let f=[];for(let h=0;h<Object.keys(s).length;h++)f[h]=s[h];s=f}}for(let[a,l]of Object.entries(s))s[a]=n(l);return s},r=n(t);return Ys(r),r}function La(e,t){let n={add:[],remove:[]};for(let[r,s]of Object.entries(t))s&&e[r]!==s&&n.add.push({_id:r,value:s});for(let r of Object.keys(e))t[r]||n.remove.push(r);return n}function Bc(e,t){return new Promise((n,r)=>{try{let s=Xr.parse(t,{schema:"failsafe"});if(s){let i={},o=i;e.forEach((a,l)=>{l<e.length-1?(o[a]={},o=o[a]):o[a]=s}),s=Ra(i)}else s={};for(let i of Object.values(s))he(i);ko(`${e.join(".")}.%`).then(i=>{let o={};for(let f of i)o[f._id]=f.value;let a=La(o,s);if(!a.add.length&&!a.remove.length)return void n(null);let l=[];for(let f of a.add)l.push(Je("config",f._id,f));for(let f of a.remove)l.push(ae("config",f));Promise.all(l).then(()=>{n(null)}).catch(r)}).catch(r)}catch(s){n({config:s.message})}})}var Vc=()=>({view:e=>{let t=e.attrs.prefix.split("."),n=e.attrs.name,r=e.attrs.data;t[t.length-1]===""&&t.pop();let s;if(r.length){s=$a(r);for(let f of t)s=s[f]}let i=s&&Object.values(s).length?Xr.stringify(s,{schema:"failsafe"}):"",o={id:`${n}-ui-config`,value:i,mode:"yaml",focus:!0,onSubmit:f=>{f.form.querySelector("button[type=submit]").click()},onChange:f=>{e.state.updatedYaml=f,e.state.modified=!0}},a=p(Bn,o),l=p("button.primary",{type:"submit"},"Save");return p("div.put-form",[p("h1",`Editing ${n}`),p("form",{onsubmit:f=>{f.redraw=!1,f.preventDefault(),e.state.updatedYaml==null&&(e.state.updatedYaml=i),Bc(t,e.state.updatedYaml).then(e.attrs.onUpdate).catch(e.attrs.onError)}},[a,p(".actions-bar",[l])])])}}),_a=Vc;var Fc=[{id:"_id",label:"Key"},{id:"value",label:"Value",type:"textarea"}];function Zs(e,t,n){return new Promise((r,s)=>{let i=Object.assign({},t);if(e==="save"){let o=i._id||"";delete i._id;let a=/^[0-9a-zA-Z_.-]+$/;if(o=o.trim(),!o.match(a))return void r({_id:"Invalid ID"});try{i.value=J(he(i.value||""))}catch{return void r({value:"Config value must be valid expression"})}Ge("config",o).then(l=>{if(l&&n)return j(Date.now()),void r({_id:"Config already exists"});if(!l&&!n)return j(Date.now()),void r({_id:"Config does not exist"});Je("config",o,i).then(()=>{I("success",`Config ${l?"updated":"created"}`),j(Date.now()),r(null)}).catch(s)}).catch(s)}else e==="delete"?ae("config",i._id).then(()=>{I("success","Config deleted"),j(Date.now()),r(null)}).catch(o=>{j(Date.now()),s(o)}):s(new Error("Undefined action"))})}var za={resource:"config",attributes:Fc};function Qc(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function Wc(){return window.authorizer.hasAccess("config",2)?new Promise((e,t)=>{Promise.all([vr(),Sa()]).then(()=>{e({})}).catch(t)}):Promise.reject(new Error("You are not authorized to view this page"))}function Hc(e,t){let n=e.value.sort((i,o)=>i._id<o._id?-1:1),r;if(t){let i=t.split(" ").filter(o=>o);i.length&&(r=new RegExp(i.map(o=>Qc(o)).join(".*"),"i"))}let s=[];for(let i of n){let o={};r&&!r.test(i._id)&&!r.test(i.value)&&(o.style="display: none;");let a=p("button",{title:"Edit config value",onclick:()=>{let f=null,h=p(Pe,Object.assign({base:i,actionHandler:(g,u)=>new Promise(c=>{Zs(g,u,!1).then(m=>{let y=m?Object.values(m):[];if(y.length)for(let E of y)I("error",E);else le(f);c()}).catch(m=>{I("error",m.message),c()})})},za));f=()=>h,ge(f,()=>!h.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},ve("edit")),l=p("button",{title:"Delete config",onclick:()=>{confirm(`Deleting ${i._id} config. Are you sure?`)&&Zs("delete",i).catch(f=>{throw f})}},ve("remove"));s.push(p("tr",o,p("td.left",p("long-text",{text:i._id})),p("td.right",p("span",[p("long-text",{text:`${i.value}`}),a,l]))))}return s.length||s.push(p("tr.empty",p("td",{colspan:2},"No config"))),p("table",p("tbody",s))}var Kc=()=>({view:e=>{document.title="Config - GenieACS";let t=p("input",{type:"text",placeholder:"Search config",oninput:i=>{e.state.searchString=i.target.value,i.redraw=!1,clearTimeout(e.state.timeout),e.state.timeout=setTimeout(p.redraw,250)}}),n=pe("config",!0),r,s=[];if(window.authorizer.hasAccess("config",3)){r=p("button.primary",{title:"Create new config",onclick:()=>{let o=null,a=p(Pe,Object.assign({actionHandler:(l,f)=>new Promise(h=>{Zs(l,f,!0).then(g=>{let u=g?Object.values(g):[];if(u.length)for(let c of u)I("error",c);else le(o);h(null)}).catch(g=>{I("error",g.message),h()})})},za));o=()=>a,ge(o,()=>!a.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"New config");let i=[{name:"overview",prefix:"ui.overview.groups.",data:[]},{name:"charts",prefix:"ui.overview.charts.",data:[]},{name:"filters",prefix:"ui.filters.",data:[]},{name:"index page",prefix:"ui.index.",data:[]},{name:"device page",prefix:"ui.device.",data:[]},{name:"multi tab page",prefix:"ui.multiTabs.",data:[]}];if(n.fulfilled){for(let o of n.value)for(let a of i)if(o._id.startsWith(a.prefix)){a.data.push(o);break}}for(let o of i){let a={prefix:o.prefix,name:o.name,data:o.data};s.push(p("button",{onclick:()=>{let l=null,f=p(_a,Object.assign({onUpdate:h=>{let g=h?Object.values(h):[];if(g.length)for(let u of g)I("error",u);else I("success",`${o.name.replace(/^[a-z]/,o.name[0].toUpperCase())} config updated`),le(l);j(Date.now())},onError:h=>{I("error",h.message),j(Date.now()),le(l)}},a));l=()=>f,ge(l,()=>!f.state.modified||confirm("You have unsaved changes. Close anyway?"))}},`Edit ${o.name}`))}}return[p("h1","Listing config"),p("loading",{queries:[n]},p(".all-parameters",t,p(".parameter-list",{style:"height: 400px"},Hc(n,e.state.searchString)),p(".actions-bar",[r].concat(s))))]}});var ri={};nt(ri,{component:()=>Xc,init:()=>Zc});var ei=ue.ui.pageSize||10,ti=V(he),Jc=V(JSON.parse),xr=[{id:"role",label:"Role"},{id:"resource",label:"Resource",type:"combo",options:["config","devices","faults","files","permissions","users","presets","provisions","virtualParameters"]},{id:"filter",label:"Filter",type:"textarea"},{id:"access",label:"Access",type:"combo",options:["1: count","2: read","3: write"]},{id:"validate",label:"Validate",type:"textarea"}],Gc=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("permissions",t[2],t[3]):t));function ja(e,t,n){return new Promise((r,s)=>{let i=Object.assign({},t);if(e==="save"){if(!i.role)return void r({role:"Role can not be empty"});if(!i.resource)return void r({resource:"Resource can not be empty"});if(!i.access)return void r({access:"Access can not be empty"});if(i.access==="3: write")i.access=3;else if(i.access==="2: read")i.access=2;else if(i.access==="1: count")i.access=1;else return void r({access:"Invalid access level"});if(i.filter)try{i.filter=J(ti(i.filter))}catch{return void r({filter:"Filter must be valid expression"})}if(i.validate)try{i.validate=J(ti(i.validate))}catch{return void r({validate:"Validate must be valid expression"})}let o=`${i.role}:${i.resource}:${i.access}`;Ge("permissions",o).then(a=>{if(a&&n)return j(Date.now()),void r({_id:"Permission already exists"});if(!a&&!n)return j(Date.now()),void r({_id:"Permission does not exist"});Je("permissions",o,i).then(()=>{I("success",`Permission ${a?"updated":"created"}`),j(Date.now()),r(null)}).catch(s)}).catch(s)}else e==="delete"?ae("permissions",i._id).then(()=>{I("success","Permission deleted"),j(Date.now()),r(null)}).catch(o=>{j(Date.now()),s(o)}):s(new Error("Undefined action"))})}var Ua={resource:"permissions",attributes:xr},Yc=V(e=>{let t={};for(let n of xr)t[n.label]=n.id;return`api/permissions.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(t)})}`});function Zc(e){if(!window.authorizer.hasAccess("permissions",2))return Promise.reject(new Error("You are not authorized to view this page"));let t=e.hasOwnProperty("sort")?""+e.sort:"",n=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:n,sort:t})}var Xc=()=>({view:e=>{document.title="Permissions - GenieACS";function t(){e.state.showCount=(e.state.showCount||ei)+ei,p.redraw()}function n(c){let m={filter:c};e.attrs.sort&&(m.sort=e.attrs.sort),p.route.set("/admin/permissions",m)}let r=e.attrs.sort?Jc(e.attrs.sort):{},s={};for(let c=0;c<xr.length;c++){let m=xr[c];m.id==="filter"||m.id==="validate"||(s[c]=r[m.id]||0)}function i(c){let m={};for(let E of c)m[xr[Math.abs(E)-1].id]=Math.sign(E);let y={sort:JSON.stringify(m)};e.attrs.filter&&(y.filter=e.attrs.filter),p.route.set("/admin/permissions",y)}let o=e.attrs.filter?ti(e.attrs.filter):!0;o=Gc(o);let a=pe("permissions",o,{limit:e.state.showCount||ei,sort:r}),l=Re("permissions",o),f=Yc(o),h=(c,m)=>{if(c.id==="access"){let y=m.access;return y===1?"1: count":y===2?"2: read":y===3?"3: write":y}return m[c.id]},g={};g.attributes=xr,g.data=a.value,g.total=l.value,g.valueCallback=h,g.showMoreCallback=t,g.sortAttributes=s,g.onSortChange=i,g.downloadUrl=f,window.authorizer.hasAccess("permissions",3)&&(g.recordActionsCallback=c=>{let m=c.access;return m===1&&(c.access="1: count"),m===2&&(c.access="2: read"),m===3&&(c.access="3: write"),[p("a",{onclick:()=>{let y=null,E=p(Pe,Object.assign({base:c,oncreate:C=>{C.dom.querySelector("input[name='role']").disabled=!0,C.dom.querySelector("select[name='access']").disabled=!0,C.dom.querySelector("select[name='resource']").disabled=!0},actionHandler:(C,x)=>new Promise(P=>{ja(C,x,!1).then(T=>{let R=T?Object.values(T):[];if(R.length)for(let L of R)I("error",L);else le(y);P()}).catch(T=>{I("error",T.message),P()})})},Ua));y=()=>E,ge(y,()=>!E.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"Show")]},g.actionsCallback=c=>[p("button.primary",{title:"Create new permission",onclick:()=>{let m=null,y=p(Pe,Object.assign({actionHandler:(E,C)=>new Promise(x=>{ja(E,C,!0).then(P=>{let T=P?Object.values(P):[];if(T.length)for(let R of T)I("error",R);else le(m);x()}).catch(P=>{I("error",P.message),x()})})},Ua));m=()=>y,ge(m,()=>!y.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"New"),p("button.primary",{title:"Delete selected permissions",disabled:!c.size,onclick:m=>{confirm(`Deleting ${c.size} permissions. Are you sure?`)&&(m.redraw=!1,m.target.disabled=!0,Promise.all(Array.from(c).map(y=>ae("permissions",y))).then(y=>{I("success",`${y.length} permissions deleted`),j(Date.now())}).catch(y=>{I("error",y.message),j(Date.now())}))}},"Delete")]);let u={resource:"permissions",filter:e.attrs.filter,onChange:n};return[p("h1","Listing permissions"),p(Qe,u),p("loading",{queries:[a,l]},p(Fe,g))]}});var si={};nt(si,{component:()=>of,init:()=>sf});var ni=ue.ui.pageSize||10,ef=V(he),tf=V(JSON.parse),Ct=[{id:"_id",label:"Username"},{id:"roles",label:"Roles",type:"multi",options:[]}],rf=V(e=>ne(e,t=>Array.isArray(t)&&t[0]==="FUNC"&&t[1]==="Q"?$e("users",t[2],t[3]):t));function qa(e,t,n){return new Promise((r,s)=>{let i=Object.assign({},t);if(e==="save"){let o=i._id,a=i.password,l=i.confirm;if(delete i._id,delete i.password,delete i.confirm,!o)return void r({_id:"ID can not be empty"});if(n)if(a){if(a!==l)return void r({confirm:"Confirm password doesn't match password"})}else return void r({password:"Password can not be empty"});if(!Array.isArray(i.roles)||!i.roles.length)return void r({roles:"Role(s) must be selected"});i.roles=i.roles.join(","),Ge("users",o).then(f=>{if(f&&n)return j(Date.now()),void r({_id:"User already exists"});if(!f&&!n)return j(Date.now()),void r({_id:"User does not exist"});Je("users",o,i).then(()=>{n?In(o,a).then(()=>{I("success","User created"),j(Date.now()),r(null)}).catch(s):(I("success","User updated"),j(Date.now()),r(null))}).catch(s)}).catch(s)}else e==="delete"?ae("users",i._id).then(()=>{I("success","User deleted"),j(Date.now()),r(null)}).catch(o=>{j(Date.now()),s(o)}):s(new Error("Undefined action"))})}var nf=V(e=>{let t={};for(let n of Ct)t[n.label]=n.id;return`api/users.csv?${p.buildQueryString({filter:J(e),columns:JSON.stringify(t)})}`});function sf(e){if(!window.authorizer.hasAccess("users",2))return Promise.reject(new Error("You are not authorized to view this page"));let t=e.hasOwnProperty("sort")?""+e.sort:"",n=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:n,sort:t})}var of=()=>({view:e=>{document.title="Users - GenieACS";function t(){e.state.showCount=(e.state.showCount||ni)+ni,p.redraw()}function n(m){let y={filter:m};e.attrs.sort&&(y.sort=e.attrs.sort),p.route.set("/admin/users",y)}let r=e.attrs.sort?tf(e.attrs.sort):{},s={};for(let m=0;m<Ct.length;m++)Ct[m].id!=="roles"&&(s[m]=r[Ct[m].id]||0);function i(m){let y={};for(let C of m)y[Ct[Math.abs(C)-1].id]=Math.sign(C);let E={sort:JSON.stringify(y)};e.attrs.filter&&(E.filter=e.attrs.filter),p.route.set("/admin/users",E)}let o=e.attrs.filter?ef(e.attrs.filter):!0;o=rf(o);let a=pe("users",o,{limit:e.state.showCount||ni,sort:r}),l=Re("users",o),f=pe("permissions",!0);if(f.fulfilled)for(let m of Ct)m.id==="roles"&&(m.options=[...new Set(f.value.map(y=>y.role))]);let h=nf(o),g=window.authorizer.hasAccess("users",3),u={};if(u.attributes=Ct,u.data=a.value,u.total=l.value,u.showMoreCallback=t,u.sortAttributes=s,u.onSortChange=i,u.downloadUrl=h,u.recordActionsCallback=m=>[p("a",{onclick:()=>{let y=null,E=p(Pe,Object.assign({base:{_id:m._id,roles:m.roles.split(",")},actionHandler:(C,x)=>new Promise(P=>{qa(C,x,!1).then(T=>{let R=T?Object.values(T):[];if(R.length)for(let L of R)I("error",L);else le(y);P()}).catch(T=>{I("error",T.message),P()})})},{resource:"users",attributes:Ct}));y=()=>{let C=[E];if(g){C.push(p("hr"));let x={noAuth:!0,username:m._id,onPasswordChange:()=>{le(y),p.redraw()}};C.push(p(_n,x))}return C},ge(y,()=>!E.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"Show")],g){let m={resource:"users",attributes:[Ct[0],{id:"password",label:"Password",type:"password"},{id:"confirm",label:"Confirm password",type:"password"},Ct[1]]};u.actionsCallback=y=>[p("button.primary",{title:"Create new user",onclick:()=>{let E=null,C=p(Pe,Object.assign({actionHandler:(x,P)=>new Promise(T=>{qa(x,P,!0).then(R=>{let L=R?Object.values(R):[];if(L.length)for(let U of L)I("error",U);else le(E);T()}).catch(R=>{I("error",R.message),T()})})},m));E=()=>C,ge(E,()=>!C.state.current.modified||confirm("You have unsaved changes. Close anyway?"))}},"New"),p("button.primary",{title:"Delete selected users",disabled:!y.size,onclick:E=>{confirm(`Deleting ${y.size} users. Are you sure?`)&&(E.redraw=!1,E.target.disabled=!0,Promise.all(Array.from(y).map(C=>ae("users",C))).then(C=>{I("success",`${C.length} users deleted`),j(Date.now())}).catch(C=>{I("error",C.message),j(Date.now())}))}},"Delete")]}let c={resource:"users",filter:e.attrs.filter,onChange:n};return[p("h1","Listing users"),p(Qe,c),p("loading",{queries:[a,l]},p(Fe,u))]}});var en=class{constructor(t){this.permissionSets=t,this.validatorCache=new WeakMap,this.hasAccessCache=new Map,this.getFilterCache=new Map}hasAccess(t,n){let r=`${t}-${n}`;if(this.hasAccessCache.has(r))return this.hasAccessCache.get(r);let s=!1;for(let i of this.permissionSets)for(let o of i)if(o[t]&&o[t].access>=n){s=!0;break}return this.hasAccessCache.set(r,s),s}getFilter(t,n){let r=`${t}-${n}`;if(this.getFilterCache.has(r))return this.getFilterCache.get(r);let s=null;for(let i of this.permissionSets)for(let o of i)o[t]&&o[t].access>=n&&(s=gt(s,o[t].filter));return this.getFilterCache.set(r,s),s}getValidator(t,n){if(this.validatorCache.has(n))return this.validatorCache.get(n);let r=[];for(let i of this.permissionSets)for(let o of i)o[t]&&o[t].access>=3&&o[t].validate&&r.push(o[t].validate);let s=(i,o,a)=>{if(!r.length)return!1;let l={mutationType:i,mutation:o,resourceType:t,object:n,options:a},f=g=>{let u=g.split(".",1)[0];g=g.slice(u.length+1);let c=null;if(["mutation","options"].includes(u)){c=l[u];for(let m of g.split(".")){if(c==null)break;typeof c!="object"?c=null:c=c[m]}}else l[u]&&(g?c=l[u][g]:c=l[u]);return c},h=dt(r.length>1?["OR",r]:r[0],f,Date.now());return!Array.isArray(h)&&!!h};return this.validatorCache.set(n,s),s}getPermissionSets(){return this.permissionSets}};window.authorizer=new en(window.permissionSets);var af=["presets","provisions","virtualParameters","files","config","users","permissions"],Sr;function Ze(e,t){let n={render:()=>{let r=Date.now(),s;Sr?.error?s=(0,jt.default)(Ea,Sr):s=(0,jt.default)(Ln(t.component),Sr);let i={};return i.page=e,i.oncreate=i.onupdate=()=>{So(r)},(0,jt.default)(Fo,i,s)},onmatch:null};return n.onmatch=(r,s)=>(j(Date.now()),t.init?new Promise(i=>{t.init(r).then(o=>{if(!o)return void jt.default.route.set("/");Sr=o,i()}).catch(o=>{!window.username&&o.message.indexOf("authorized")>=0&&(I("error",o.message),jt.default.route.set("/login",{continue:s})),Sr={error:o.message},i()})}):(Sr=null,null)),n}function lf(){return{onmatch:()=>{for(let t of af)if(window.authorizer.hasAccess(t,2))return jt.default.route.set(`/admin/${t}`),null;return null}}}jt.default.route(document.body,"/overview",{"/wizard":Ze("wizard",Ts),"/login":Ze("login",Rs),"/overview":Ze("overview",$s),"/devices":Ze("devices",Us),"/devices/:id":Ze("devices",Un),"/devices/:id/:tab":Ze("devices",Un),"/faults":Ze("faults",Bs),"/admin":lf(),"/admin/presets":Ze("presets",Fs),"/admin/provisions":Ze("provisions",Ws),"/admin/virtualParameters":Ze("virtualParameters",Ks),"/admin/files":Ze("files",Gs),"/admin/config":Ze("config",Xs),"/admin/users":Ze("users",si),"/admin/permissions":Ze("permissions",ri)});
//# sourceMappingURL=app.js.map
